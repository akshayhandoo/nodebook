<!DOCTYPE html>
<!-- saved from url=(0102)https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" "="" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="1573407" data-user-uuid="29525685-85c9-45c7-9eda-3c178d86398e" data-username="raviguru0007" data-account-type="Trial" data-activated-trial-date="04/17/2017" data-archive="9781430260585" data-publishers="Apress" data-htmlfile-name="9781430260585_Ch06.xhtml" data-epub-title="Node.js Recipes: A Problem-Solution Approach" data-debug="0" data-testing="0"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781430260585"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><script type="text/javascript" src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/510f1a6865"></script><script src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/nr-spa-1026.min.js"></script><script type="text/javascript" async="" src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/linkid.js"></script><script async="" src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/analytics.js"></script><script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={xpid:"VQQDUVVVGwACU1RUAQA="};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(t){try{c.console&&console.log(t)}catch(e){}}var o,i=t("ee"),a=t(19),c={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(c.console=!0,o.indexOf("dev")!==-1&&(c.dev=!0),o.indexOf("nr_dev")!==-1&&(c.nrDev=!0))}catch(s){}c.nrDev&&i.on("internal-error",function(t){r(t.stack)}),c.dev&&i.on("fn-err",function(t,e,n){r(n.stack)}),c.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(c,function(t,e){return t}).join(", ")))},{}],2:[function(t,e,n){function r(t,e,n,r,o){try{d?d-=1:i("err",[o||new UncaughtException(t,e,n)])}catch(c){try{i("ierr",[c,s.now(),!0])}catch(u){}}return"function"==typeof f&&f.apply(this,a(arguments))}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function o(t){i("err",[t,s.now()])}var i=t("handle"),a=t(20),c=t("ee"),s=t("loader"),f=window.onerror,u=!1,d=0;s.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(p){"stack"in p&&(t(12),t(11),"addEventListener"in window&&t(6),s.xhrWrappable&&t(13),u=!0)}c.on("fn-start",function(t,e,n){u&&(d+=1)}),c.on("fn-err",function(t,e,n){u&&(this.thrown=!0,o(n))}),c.on("fn-end",function(){u&&!this.thrown&&d>0&&(d-=1)}),c.on("internal-error",function(t){i("ierr",[t,s.now(),!0])})},{}],3:[function(t,e,n){t("loader").features.ins=!0},{}],4:[function(t,e,n){function r(){C++,N=y.hash,this[u]=M.now()}function o(){C--,y.hash!==N&&i(0,!0);var t=M.now();this[l]=~~this[l]+t-this[u],this[d]=t}function i(t,e){x.emit("newURL",[""+y,e])}function a(t,e){t.on(e,function(){this[e]=M.now()})}var c="-start",s="-end",f="-body",u="fn"+c,d="fn"+s,p="cb"+c,h="cb"+s,l="jsTime",m="fetch",v="addEventListener",w=window,y=w.location;if(w[v]){var b=t(9),g=t(10),x=t(8),E=t(6),O=t(12),R=t(7),P=t(13),T=t("ee"),S=T.get("tracer");t(14);var M=t("loader");M.features.spa=!0;var N,j=w[v],C=0;T.on(u,r),T.on(p,r),T.on(d,o),T.on(h,o),T.buffer([u,d,"xhr-done","xhr-resolved"]),E.buffer([u]),O.buffer(["setTimeout"+s,"clearTimeout"+c,u]),P.buffer([u,"new-xhr","send-xhr"+c]),R.buffer([m+c,m+"-done",m+f+c,m+f+s]),x.buffer(["newURL"]),b.buffer([u]),g.buffer(["propagate",p,h,"executor-err","resolve"+c]),S.buffer([u,"no-"+u]),a(P,"send-xhr"+c),a(T,"xhr-resolved"),a(T,"xhr-done"),a(R,m+c),a(R,m+"-done"),x.on("pushState-end",i),x.on("replaceState-end",i),j("hashchange",i,!0),j("load",i,!0),j("popstate",function(){i(0,C>1)},!0)}},{}],5:[function(t,e,n){function r(t){}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(12),c=t(11),s="learResourceTimings",f="addEventListener",u="resourcetimingbufferfull",d="bstResource",p="resource",h="-start",l="-end",m="fn"+h,v="fn"+l,w="bstTimer",y="pushState",b=t("loader");b.features.stn=!0,t(8);var g=NREUM.o.EV;o.on(m,function(t,e){var n=t[0];n instanceof g&&(this.bstStart=b.now())}),o.on(v,function(t,e){var n=t[0];n instanceof g&&i("bst",[n,e,this.bstStart,b.now()])}),a.on(m,function(t,e,n){this.bstStart=b.now(),this.bstType=n}),a.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),this.bstType])}),c.on(m,function(){this.bstStart=b.now()}),c.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),"requestAnimationFrame"])}),o.on(y+h,function(t){this.time=b.now(),this.startPath=location.pathname+location.hash}),o.on(y+l,function(t){i("bstHist",[location.pathname+location.hash,this.startPath,this.time])}),f in window.performance&&(window.performance["c"+s]?window.performance[f](u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["c"+s]()},!1):window.performance[f]("webkit"+u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["webkitC"+s]()},!1)),document[f]("scroll",r,{passive:!0}),document[f]("keypress",r,!1),document[f]("click",r,!1)}},{}],6:[function(t,e,n){function r(t){for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)}function o(t){c.inPlace(t,[u,d],"-",i)}function i(t,e){return t[1]}var a=t("ee").get("events"),c=t(22)(a,!0),s=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){var n=t[1],r=s(n,"nr@wrapped",function(){function t(){if("function"==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)}var e={object:t,"function":n}[typeof n];return e?c(e,"fn-",null,e.name||"anonymous"):n});this.wrapped=t[1]=r}),a.on(d+"-start",function(t){t[1]=this.wrapped||t[1]})},{}],7:[function(t,e,n){function r(t,e,n){var r=t[e];"function"==typeof r&&(t[e]=function(){var t=r.apply(this,arguments);return o.emit(n+"start",arguments,t),t.then(function(e){return o.emit(n+"end",[null,e],t),e},function(e){throw o.emit(n+"end",[e],t),e})})}var o=t("ee").get("fetch"),i=t(19);e.exports=o;var a=window,c="fetch-",s=c+"body-",f=["arrayBuffer","blob","json","text","formData"],u=a.Request,d=a.Response,p=a.fetch,h="prototype";u&&d&&p&&(i(f,function(t,e){r(u[h],e,s),r(d[h],e,s)}),r(a,"fetch",c),o.on(c+"end",function(t,e){var n=this;e?e.clone().arrayBuffer().then(function(t){n.rxSize=t.byteLength,o.emit(c+"done",[null,e],n)}):o.emit(c+"done",[t],n)}))},{}],8:[function(t,e,n){var r=t("ee").get("history"),o=t(22)(r);e.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")},{}],9:[function(t,e,n){var r=t("ee").get("mutation"),o=t(22)(r),i=NREUM.o.MO;e.exports=r,i&&(window.MutationObserver=function(t){return this instanceof i?new i(o(t,"fn-")):i.apply(this,arguments)},MutationObserver.prototype=i.prototype)},{}],10:[function(t,e,n){function r(t){var e=a.context(),n=c(t,"executor-",e),r=new f(n);return a.context(r).getCtx=function(){return e},a.emit("new-promise",[r,e],e),r}function o(t,e){return e}var i=t(22),a=t("ee").get("promise"),c=i(a),s=t(19),f=NREUM.o.PR;e.exports=a,f&&(window.Promise=r,["all","race"].forEach(function(t){var e=f[t];f[t]=function(n){function r(t){return function(){a.emit("propagate",[null,!o],i),o=o||!t}}var o=!1;s(n,function(e,n){Promise.resolve(n).then(r("all"===t),r(!1))});var i=e.apply(f,arguments),c=f.resolve(i);return c}}),["resolve","reject"].forEach(function(t){var e=f[t];f[t]=function(t){var n=e.apply(f,arguments);return t!==n&&a.emit("propagate",[t,!0],n),n}}),f.prototype["catch"]=function(t){return this.then(null,t)},f.prototype=Object.create(f.prototype,{constructor:{value:r}}),s(Object.getOwnPropertyNames(f),function(t,e){try{r[e]=f[e]}catch(n){}}),a.on("executor-start",function(t){t[0]=c(t[0],"resolve-",this),t[1]=c(t[1],"resolve-",this)}),a.on("executor-err",function(t,e,n){t[1](n)}),c.inPlace(f.prototype,["then"],"then-",o),a.on("then-start",function(t,e){this.promise=e,t[0]=c(t[0],"cb-",this),t[1]=c(t[1],"cb-",this)}),a.on("then-end",function(t,e,n){this.nextPromise=n;var r=this.promise;a.emit("propagate",[r,!0],n)}),a.on("cb-end",function(t,e,n){a.emit("propagate",[n,!0],this.nextPromise)}),a.on("propagate",function(t,e,n){this.getCtx&&!e||(this.getCtx=function(){if(t instanceof Promise)var e=a.context(t);return e&&e.getCtx?e.getCtx():this})}),r.toString=function(){return""+f})},{}],11:[function(t,e,n){var r=t("ee").get("raf"),o=t(22)(r),i="equestAnimationFrame";e.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],12:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],"fn-",null,n)}function o(t,e,n){this.method=n,this.timerDuration="number"==typeof t[1]?t[1]:0,t[0]=a(t[0],"fn-",this,n)}var i=t("ee").get("timer"),a=t(22)(i),c="setTimeout",s="setInterval",f="clearTimeout",u="-start",d="-";e.exports=i,a.inPlace(window,[c,"setImmediate"],c+d),a.inPlace(window,[s],s+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(s+u,r),i.on(c+u,o)},{}],13:[function(t,e,n){function r(t,e){d.inPlace(e,["onreadystatechange"],"fn-",c)}function o(){var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,v,"fn-",c)}function i(t){w.push(t),l&&(b=-b,g.data=b)}function a(){for(var t=0;t<w.length;t++)r([],w[t]);w.length&&(w=[])}function c(t,e){return e}function s(t,e){for(var n in t)e[n]=t[n];return e}t(6);var f=t("ee"),u=f.get("xhr"),d=t(22)(u),p=NREUM.o,h=p.XHR,l=p.MO,m="readystatechange",v=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],w=[];e.exports=u;var y=window.XMLHttpRequest=function(t){var e=new h(t);try{u.emit("new-xhr",[e],e),e.addEventListener(m,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e};if(s(h,y),y.prototype=h.prototype,d.inPlace(y.prototype,["open","send"],"-xhr-",c),u.on("send-xhr-start",function(t,e){r(t,e),i(e)}),u.on("open-xhr-start",r),l){var b=1,g=document.createTextNode(b);new l(a).observe(g,{characterData:!0})}else f.on("fn-end",function(t){t[0]&&t[0].type===m||a()})},{}],14:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=a.now()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var s=t.getResponseHeader("X-NewRelic-App-Data");s&&(e.cat=s.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return l(r)}function i(t,e){var n=s(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var a=t("loader");if(a.xhrWrappable){var c=t("handle"),s=t(15),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,p=t("id"),h=t(18),l=t(17),m=window.XMLHttpRequest;a.features.xhr=!0,t(13),f.on("new-xhr",function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,h&&(h>34||h<10)||window.opera||t.addEventListener("progress",function(t){e.lastSize=t.loaded},!1)}),f.on("open-xhr-start",function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),f.on("send-xhr-start",function(t,e){var n=this.metrics,r=t[0],o=this;if(n&&r){var i=l(r);i&&(n.txSize=i)}this.startTime=a.now(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{f.emit("internal-error",[n])}catch(r){}}};for(var c=0;c<d;c++)e.addEventListener(u[c],this.listener,!1)}),f.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),f.on("xhr-load-added",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),f.on("xhr-load-removed",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),f.on("addEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],e)}),f.on("removeEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],e)}),f.on("fn-start",function(t,e,n){e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=a.now()))}),f.on("fn-end",function(t,e){this.xhrCbStart&&f.emit("xhr-cb-time",[a.now()-this.xhrCbStart,this.onload,e],e)})}},{}],15:[function(t,e,n){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r}},{}],16:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[f.now()].concat(c(arguments)),e?null:this,n),e?void 0:this}}var i=t("handle"),a=t(19),c=t(20),s=t("ee").get("tracer"),f=t("loader"),u=NREUM;"undefined"==typeof window.newrelic&&(newrelic=u);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],p="api-",h=p+"ixn-";a(d,function(t,e){u[e]=o(p+e,!0,"api")}),u.addPageAction=o(p+"addPageAction",!0),u.setCurrentRouteName=o(p+"routeName",!0),e.exports=newrelic,u.interaction=function(){return(new r).get()};var l=r.prototype={createTracer:function(t,e){var n={},r=this,o="function"==typeof e;return i(h+"tracer",[f.now(),t,n],r),function(){if(s.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return e.apply(this,arguments)}finally{s.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){l[e]=o(h+e)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,f.now()])}},{}],17:[function(t,e,n){e.exports=function(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}}},{}],18:[function(t,e,n){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),e.exports=r},{}],19:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],20:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],21:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],22:[function(t,e,n){function r(t){return!(t&&t instanceof Function&&t.apply&&!t[a])}var o=t("ee"),i=t(20),a="nr@original",c=Object.prototype.hasOwnProperty,s=!1;e.exports=function(t,e){function n(t,e,n,o){function nrWrapper(){var r,a,c,s;try{a=this,r=i(arguments),c="function"==typeof n?n(r,a):n||{}}catch(f){p([f,"",[r,a,o],c])}u(e+"start",[r,a,o],c);try{return s=t.apply(a,r)}catch(d){throw u(e+"err",[r,a,d],c),d}finally{u(e+"end",[r,a,s],c)}}return r(t)?t:(e||(e=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)}function f(t,e,o,i){o||(o="");var a,c,s,f="-"===o.charAt(0);for(s=0;s<e.length;s++)c=e[s],a=t[c],r(a)||(t[c]=n(a,f?c+o:o,i,c))}function u(n,r,o){if(!s||e){var i=s;s=!0;try{t.emit(n,r,o,e)}catch(a){p([a,n,r,o])}s=i}}function d(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){p([r])}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return e}function p(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=o),n.inPlace=f,n.flag=a,n}},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?s(t,c,i):i()}function n(n,r,o,i){if(!p.aborted||i){t&&t(n,r,o);for(var a=e(o),c=l(n),s=c.length,f=0;f<s;f++)c[f].apply(a,r);var d=u[y[n]];return d&&d.push([b,n,r,a]),a}}function h(t,e){w[t]=l(t).concat(e)}function l(t){return w[t]||[]}function m(t){return d[t]=d[t]||o(n)}function v(t,e){f(t,function(t,n){e=e||"feature",y[n]=e,e in u||(u[e]=[])})}var w={},y={},b={on:h,emit:n,get:m,listeners:l,context:e,buffer:v,abort:a,aborted:!1};return b}function i(){return new r}function a(){(u.api||u.feature)&&(p.aborted=!0,u=p.backlog={})}var c="nr@context",s=t("gos"),f=t(19),u={},d={},p=e.exports=o();p.backlog=u},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!x++){var t=g.info=NREUM.info,e=p.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(y,function(e,n){t[e]||(t[e]=n)}),s("mark",["onload",a()+g.offset],null,"api");var n=p.createElement("script");n.src="https://"+t.agent,e.parentNode.insertBefore(n,e)}}function o(){"complete"===p.readyState&&i()}function i(){s("mark",["domContent",a()+g.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(c=Math.max((new Date).getTime(),c))-g.offset}var c=(new Date).getTime(),s=t("handle"),f=t(19),u=t("ee"),d=window,p=d.document,h="addEventListener",l="attachEvent",m=d.XMLHttpRequest,v=m&&m.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:m,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var w=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-spa-1026.min.js"},b=m&&v&&v[h]&&!/CriOS/.test(navigator.userAgent),g=e.exports={offset:c,now:a,origin:w,features:{},xhrWrappable:b};t(16),p[h]?(p[h]("DOMContentLoaded",i,!1),d[h]("load",r,!1)):(p[l]("onreadystatechange",o),d[l]("onload",r)),s("mark",["firstbyte",c],null,"api");var x=0,E=t(21)},{}]},{},["loader",2,14,5,3,4]);</script><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.8cc2fd27400e.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/css" rel="stylesheet" type="text/css"><title>CHAPTER 6: Implementing Security and Cryptography - Node.js Recipes: A Problem-Solution Approach</title><link rel="stylesheet" href="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/74741d96e0ae.css" type="text/css"><link rel="stylesheet" type="text/css" href="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/annotator.e34eec1a0d5a.css"><link rel="stylesheet" href="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/font-awesome.min.css"><style type="text/css" title="ibis-book">
    #sbo-rt-content div{margin:1em 1em 1em 1em}#sbo-rt-content a{text-decoration:none}#sbo-rt-content img{max-width:100%;margin-top:10pt}#sbo-rt-content p.booktitle{font-weight:bold;font-size:2.5em;margin-top:2em;margin-bottom:8em;text-align:center}#sbo-rt-content p.bookauthor{font-weight:bold;font-size:1.7em;margin-top:0;margin-right:2em;margin-bottom:0;text-align:left}#sbo-rt-content p.booksubtitle{font-weight:bold;font-size:1.7em;margin-top:0;margin-bottom:7em;text-align:center;color:#8A8A8A}#sbo-rt-content .bookimage{font-size:1.2em;margin-top:0;margin-bottom:1em;text-align:left}#sbo-rt-content .fmpara{font-size:.9em;text-indent:0;margin-top:.5em;margin-bottom:.3em;text-align:justify}#sbo-rt-content .fmpara1{font-size:.9em;text-indent:0;margin-top:.4em;margin-bottom:.3em;text-align:right}#sbo-rt-content .inpara{text-indent:0;margin-top:.4em;margin-left:3em;margin-bottom:.3em}#sbo-rt-content .pub{margin-top:10em;margin-bottom:1em;text-align:right;margin-right:5em}#sbo-rt-content .copyright{font-size:.9em;margin-top:.4em;margin-bottom:.4em;margin-left:1.2em;margin-right:1.2em;text-align:left}#sbo-rt-content .copyright1{font-size:.9em;margin-top:.1em;margin-bottom:.1em;margin-left:4em;margin-right:3.3em;text-align:left;text-indent:-1.6em}#sbo-rt-content .copyright2{font-size:.9em;margin-top:.1em;margin-bottom:.1em;margin-left:4.2em}#sbo-rt-content .dedication{font-size:1.2em;margin-bottom:0;margin-top:3.5em;text-align:center;margin-right:1em;font-style:italic}#sbo-rt-content .dedication1{font-size:1.2em;margin-bottom:0;margin-top:.5em;text-align:center;margin-right:1em;font-style:normal}#sbo-rt-content .dedication2{font-size:1.2em;margin-bottom:0;margin-top:1.5em;text-align:center;margin-right:1em;font-style:italic}#sbo-rt-content .content-title{font-size:1.6em;margin-top:3em;margin-bottom:.1em;text-align:left;font-weight:bold}#sbo-rt-content .fmtitle{font-size:2.5em;margin-top:1em;margin-bottom:1em;text-align:left;font-weight:bold;border-bottom:1.1px solid black;padding-bottom:.8em}#sbo-rt-content .right{text-indent:0;margin-top:1em;margin-right:1.5em;margin-bottom:.3em;text-align:right}#sbo-rt-content .right1{text-indent:0;margin-top:0;margin-right:1.5em;margin-bottom:.2em;text-align:right}#sbo-rt-content .chapimage{margin-left:.2em;margin-top:1.5em;margin-bottom:1.5em;text-align:left}#sbo-rt-content p.ChapterNumber{font-weight:bold;font-size:1.7em;margin-top:10px;margin-left:0;margin-bottom:5px;text-align:left}#sbo-rt-content p.ChapterTitle{font-weight:bold;font-size:2.5em;margin-top:0;margin-bottom:1em;margin-left:0;text-align:left;border-bottom:1.1px solid black;padding-bottom:.8em}#sbo-rt-content p.PartNumber{font-weight:bold;font-size:1.7em;margin-top:10px;margin-left:0;margin-bottom:5px;text-align:left;padding-bottom:.8em}#sbo-rt-content p.partTitle{font-weight:bold;font-size:2.5em;margin-top:1em;margin-bottom:1em;margin-left:0;text-align:left}#sbo-rt-content .paraaftertitle{font-size:100%;text-indent:0;margin-top:0;margin-left:0;margin-bottom:0}#sbo-rt-content p.noindent{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:0;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.noindent1{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:1em}#sbo-rt-content p.noindent2{font-size:100%;text-indent:0;margin-top:1.5em;margin-bottom:1em}#sbo-rt-content p.noindent3{font-size:100%;text-indent:0;margin-top:.8em;margin-bottom:.2em;margin-left:0;margin-right:0;text-align:center}#sbo-rt-content p.noindent4{font-size:100%;text-indent:0;margin-top:.8em;margin-bottom:.2em;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content span.listing{font-weight:bold}#sbo-rt-content p.indent{font-size:100%;text-indent:1.2em;margin-top:.1em;margin-bottom:.1em;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.indent1{font-size:100%;text-indent:1.2em;margin-top:0;margin-bottom:0;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.indent1a{font-size:100%;text-indent:1.5em;margin-top:0;margin-bottom:0;margin-left:0;margin-right:4.5em;text-align:right}#sbo-rt-content p.indent2{font-size:100%;margin-top:.8em;margin-bottom:.8em;margin-left:2.4em;margin-right:2.4em;text-align:justify;font-style:italic}#sbo-rt-content p.indent3{font-size:100%;text-indent:1em;margin-top:.8em;margin-bottom:.8em;margin-left:1.8em;margin-right:1.8em;text-align:left}#sbo-rt-content p.indent4{font-size:100%;text-indent:1.3em;margin-top:.5em;margin-bottom:.5em;margin-left:2em;margin-right:0;text-align:left}#sbo-rt-content .blockquote{font-size:100%;text-indent:.2em;margin-top:1em;margin-left:3em;margin-right:2em;margin-bottom:1em;font-style:italic}#sbo-rt-content .blockquote1{font-size:100%;text-indent:.2em;margin-top:1em;margin-left:3em;margin-bottom:0;font-style:italic}#sbo-rt-content p.Heading1{font-weight:bold;font-size:2em;text-indent:0;margin-top:1.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2{font-size:1.6em;text-indent:0;margin-top:1.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2_2{font-size:1.6em;text-indent:0;margin-top:.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2a{font-size:1.5em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;font-weight:bold}#sbo-rt-content p.Heading3{font-weight:bold;font-size:1.45em;text-indent:0;margin-top:1.2em;margin-bottom:.1em}#sbo-rt-content p.Heading3a{font-weight:normal;font-size:1.25em;text-indent:0;margin-top:1.2em;margin-bottom:.1em}#sbo-rt-content p.Heading4{font-size:1.3em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;text-align:left}#sbo-rt-content .img{max-width:100%;margin-top:10pt}#sbo-rt-content .img1{text-align:left}#sbo-rt-content .img1a{text-align:right;margin-right:5em;margin-top:5em}#sbo-rt-content .img2{text-align:left}#sbo-rt-content div.Figure{font-size:small;margin-top:1.5em;margin-bottom:1.5em}#sbo-rt-content .para-1{font-size:100%;margin-top:1em;text-indent:1.5em;margin-bottom:0;text-align:left}#sbo-rt-content .para-2{font-size:.9em;text-indent:-1.4em;margin-left:2.4em;margin-top:.5em;margin-bottom:0}#sbo-rt-content .figurecaption{font-size:small;margin-top:0;margin-bottom:0;text-align:justify}#sbo-rt-content .image{text-align:center}#sbo-rt-content .codecaption{font-size:100%;margin-top:.6em;margin-bottom:.6em;text-align:justify;font-style:italic}#sbo-rt-content .PCode{font-size:small;margin-top:1em;margin-bottom:1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-1{font-size:small;margin-top:1em;margin-bottom:.1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-2{font-size:small;margin-top:0;margin-bottom:0;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-3{font-size:small;margin-top:0;margin-bottom:1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content div.singlethin{border-bottom:solid 3px;margin-left:1em;margin-right:1em;margin-bottom:1em}#sbo-rt-content div.singlethin1{margin-left:2em;margin-right:2em}#sbo-rt-content .inlinecode{font-family:monospace}#sbo-rt-content div.notepara{font-size:110%;text-indent:0;margin-top:1em;border-top:solid 1px;border-bottom:solid 1px;margin-bottom:1em;text-align:justify}#sbo-rt-content span.pink-box{font-weight:bold;padding-left:1.3em;padding-right:1.3em;border:1.1px solid black;font-size:1.5em;margin-top:.5em;margin-bottom:.5em;text-indent:0;text-align:justify}#sbo-rt-content span.courier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%}#sbo-rt-content div.courier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%;margin-top:1em;margin-bottom:1em}#sbo-rt-content div.boxcourier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%;margin-top:1em;margin-bottom:1em;margin-left:1.5em;margin-right:1.5em;text-align:left}#sbo-rt-content span.courier1{font-family:Courier New;font-weight:normal;font-style:normal;font-size:95%}#sbo-rt-content .boxhead{font-size:1.25em;font-weight:bold;padding-left:.1em;padding-bottom:.1em;padding-top:.1em;margin-top:0;text-indent:0;text-align:center;border:3px solid black}#sbo-rt-content div.box{margin-top:1em;margin-bottom:1em}#sbo-rt-content .boxpara{font-size:110%;text-indent:0;margin-left:1.5em;margin-right:1.5em;margin-top:.5em;margin-bottom:.5em;text-align:left}#sbo-rt-content .alpha{font-size:1.2em;font-weight:bold;margin-left:.2em;margin-top:1em;margin-bottom:.3em;text-align:left}#sbo-rt-content .index{font-size:small;margin-left:.2em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .index1{font-size:small;margin-left:1em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .index2{font-size:small;margin-left:2em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .cover{text-align:center}#sbo-rt-content .top{border-top:1.1px solid black;border-bottom:2px solid black}#sbo-rt-content .bot{border-bottom:2px solid black}#sbo-rt-content table.bodytable,#sbo-rt-content table{border-collapse:collapse;margin-bottom:8px;font-size:small;margin-top:10pt;width:95%;border-top:0 solid black;border-bottom:0 solid black}#sbo-rt-content table.fmtable{margin-bottom:1em;font-size:1em;margin-left:4em;border-top:0 solid #FFF;border-bottom:0 solid #FFF}#sbo-rt-content table{margin-bottom:1em;border-top:1.1px solid black;border-bottom:1.1px solid black;border-collapse:collapse}#sbo-rt-content th{border-top:1px solid black;border-bottom:1px solid black;padding-right:1.5em}#sbo-rt-content td{font-size:small;vertical-align:top;padding-right:1.5em;margin-top:0;margin-bottom:1em}#sbo-rt-content .tablepara{font-size:small;text-indent:0;margin-top:0;margin-bottom:.5em;padding-right:1.5em}#sbo-rt-content .tablepara1{font-size:small;margin-left:2em;margin-top:0;margin-bottom:0;padding-right:1.5em}#sbo-rt-content .header{border-bottom:1.1px solid black;text-indent:0;text-align:left}#sbo-rt-content .TabCapt{font-style:italic;margin-left:0;text-indent:0}#sbo-rt-content .FigCapt{font-style:italic;font-size:.9em}#sbo-rt-content .CaptNr{font-weight:bold}#sbo-rt-content .ttitle{font-style:Italic;margin-bottom:1em}#sbo-rt-content p.paraaftertitle1{font-size:.9em;text-indent:0;margin-top:.5em;margin-bottom:.8em;text-align:left}#sbo-rt-content p.para{font-size:small;text-indent:20px;margin-top:0;margin-bottom:0;text-align:justify}#sbo-rt-content p.quote{font-style:italic;font-size:100%;margin-top:1.5em;margin-left:2.5em;margin-right:2.5em;margin-bottom:0}#sbo-rt-content p.quotesource{font-size:small;text-indent:0;margin-top:1em;margin-bottom:1em;text-align:right}#sbo-rt-content p.chaptersubtitle{font-size:x-large;text-indent:0;margin-top:0;margin-left:0;margin-bottom:0;text-align:left}#sbo-rt-content p.line{margin-top:.3em;border-bottom:1px solid black}#sbo-rt-content p.line1{margin-top:.3em;margin-bottom:1.5em;border-bottom:1px solid black}#sbo-rt-content p.line2{margin-top:5em;margin-bottom:5em;border-bottom:1px solid black;text-align:center;margin-left:15em;margin-right:15em}#sbo-rt-content li{margin-bottom:.5em;margin-top:.5em}#sbo-rt-content p.alpha{font-size:1.2em;font-weight:bold;margin-left:.2em;margin-top:1em;margin-bottom:.3em;text-align:left}#sbo-rt-content ul.bulleted{font-size:100%;text-align:justify;margin-left:2.5em;margin-right:3em;margin-top:1em;margin-bottom:1em;text-indent:0}#sbo-rt-content ol.OrderedList{font-size:100%;text-align:left;margin-left:2.5em;margin-right:3em;margin-top:1em;margin-bottom:1em}#sbo-rt-content ul.bulleted1{font-size:100%;text-align:left;margin-left:1em;margin-right:5em;margin-top:1em;margin-bottom:1em;list-style-type:none}#sbo-rt-content ul.bulleted1_a{font-size:100%;text-align:justify;margin-left:0;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0;list-style-type:none}#sbo-rt-content ul.bulleted2{font-size:100%;text-align:justify;margin-left:2.3em;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0}#sbo-rt-content ul.bulleted4{font-size:100%;text-align:center;margin-left:1.3em;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0;list-style-type:none}#sbo-rt-content .numbered{font-size:small;text-align:justify;margin-left:2em;margin-right:2em;margin-top:.5em;margin-bottom:.5em;text-indent:1em}#sbo-rt-content .bulletedin{font-size:100%;text-align:justify;margin-left:4em;margin-right:4em;margin-top:.5em;margin-bottom:.5em}#sbo-rt-content ul.None{font-size:.9em;text-align:justify;margin-left:3em;margin-right:2em;margin-top:.5em;margin-bottom:.5em;list-style-type:none}#sbo-rt-content .Listing{font-size:small;margin-bottom:0}#sbo-rt-content .PCode1{font-size:small;margin-top:.7em;margin-bottom:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode2{font-size:small;margin-top:1em;margin-bottom:.1em;margin-left:2.2em;text-align:left;font-family:monospace}#sbo-rt-content .PCode3{font-size:small;margin-top:0;margin-left:2.2em;margin-bottom:.1em;text-align:left;font-family:monospace}#sbo-rt-content .NoteCaption{font-size:small;margin-top:1.3em;margin-left:5em;margin-right:5em;border:1.1px solid black;padding:.5em;margin-bottom:1.3em}#sbo-rt-content .Table{font-size:100%;margin-bottom:1em;margin-left:0}#sbo-rt-content .toc{font-size:1.1em;margin-top:.2em;margin-bottom:.2em;text-align:left;font-weight:bold}#sbo-rt-content .toca{font-size:1.1em;margin-top:.8em;margin-bottom:.4em;text-align:left;font-weight:bold}#sbo-rt-content .toc1{font-size:1.1em;margin-top:.4em;margin-bottom:.3em;text-align:left;text-indent:1.4em;font-weight:normal}#sbo-rt-content .toc2{font-size:1.2em;margin-top:.4em;margin-bottom:.3em;text-align:left;font-weight:bold}#sbo-rt-content .toc3{font-size:.9em;margin-top:.4em;margin-bottom:.3em;text-align:left;text-indent:3.5em;font-weight:normal}#sbo-rt-content .toc4{font-size:1.1em;margin-top:.2em;margin-bottom:.5em;text-align:left;font-weight:bold}#sbo-rt-content .tocch{font-size:1.3em;margin-top:.7em;margin-bottom:.7em;text-align:left;font-weight:bold}#sbo-rt-content .noborder{margin-bottom:1em;border-top:0 solid #FFF;border-bottom:0 solid #FFF}#sbo-rt-content .authurright{text-align:right;margin-top:0;margin-bottom:0}#sbo-rt-content .FormalPara{font-size:small;margin-bottom:.7em}#sbo-rt-content .FontName1{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content span.FontName2{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content span.FontName3{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content .rightarrow{margin-top:0}#sbo-rt-content div.thinline{margin-top:1em;margin-bottom:1em;border-top:solid 4px #AFAFB0;border-bottom:solid 4px #AFAFB0}#sbo-rt-content span.line{text-decoration:underline}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content div.box{border-top:solid 2px;border-bottom:solid 2px}#sbo-rt-content .app{font-size:150%;margin-left:.8em}#sbo-rt-content .page{text-decoration:none;color:#000}#sbo-rt-content .cXXX{text-decoration:none;color:#000}#sbo-rt-content .textindent{margin-left:1.7em;margin-top:1em;margin-bottom:1em;font-size:100%}#sbo-rt-content .textindent1{margin-left:1.7em;margin-top:0;margin-bottom:0;font-size:100%}#sbo-rt-content .textindent2{margin-left:1.7em;margin-top:0;margin-bottom:0;font-size:100%;text-indent:1em}#sbo-rt-content p.FootNote{margin-top:.8em;margin-bottom:0;font-size:85%;text-indent:0;text-align:left;margin-left:1.1em;margin-right:1.1em}#sbo-rt-content pre{margin-left:0;font-family:monospace;white-space:pre-wrap}#sbo-rt-content p.Heading4a{font-size:1.15em;font-weight:bold;text-indent:1em;margin-top:1.3em;margin-bottom:.3em;border-top:3px solid #4d4d4c;border-left:solid 3px #4d4d4c;border-right:solid 3px #4d4d4c;border-bottom:solid 3px #4d4d4c;text-align:center}#sbo-rt-content p.noindent8{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:1em;text-align:center;font-weight:bold;color:#8A8A8A}#sbo-rt-content .tocb{font-size:1.4em;margin-top:.5em;margin-bottom:.2em;text-align:left;font-weight:bold}#sbo-rt-content .part{font-weight:normal;font-size:1em;margin-bottom:5px;text-align:left;padding-left:1.3em;padding-bottom:10em;padding-right:1.3em;border:1.1px solid black}#sbo-rt-content p.Heading5{font-size:1em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;text-align:center}#sbo-rt-content p.noindent5s{font-size:100%;text-indent:0;margin-top:.1em;margin-bottom:.1em;margin-left:0;margin-right:0;text-align:right}#sbo-rt-content span.strike{text-decoration:line-through}
    </style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781430260585/chapter/9781430260585_Ch06.xhtml",
          "book_id": "9781430260585",
          "chapter_uri": "9781430260585_Ch06.xhtml",
          "position": 0,
          "user_uuid": "29525685-85c9-45c7-9eda-3c178d86398e",
          "next_chapter_uri": "/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch07.xhtml"
        
      },
      title: "Node.js Recipes: A Problem\u002DSolution Approach",
      author_list: "Cory Gackenheimer",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false,
      show_ios_app_teaser: false
    };
    // ]]></script><script src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/modernizr.js"></script><script>
    
      
        

        

        
          
            window.PUBLIC_ANNOTATIONS = true;
          
        

      

      
        window.MOBILE_PUBLIC_ANNOTATIONS = false;
      

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

    
      window.PRIVACY_CONTROL_SWITCH = true;
    

    
      window.PUBLISHER_PAGES = true;
    

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "https://www.safaribooksonline.com/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://www.safaribooksonline.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml"><meta name="description" content="CHAPTER 6 Implementing Security and Cryptography In this chapter you will investigate a critical part to any application, regardless of the framework you choose to use to develop it: security ... "><meta property="og:title" content="CHAPTER 6: Implementing Security and Cryptography"><meta itemprop="isPartOf" content="/library/view/nodejs-recipes-a/9781430260585/"><meta itemprop="name" content="CHAPTER 6: Implementing Security and Cryptography"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781430260585/"><meta property="og:description" itemprop="description" content="CHAPTER 6 Implementing Security and Cryptography In this chapter you will investigate a critical part to any application, regardless of the framework you choose to use to develop it: security ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Apress"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781430260585"><meta property="og:book:author" itemprop="author" content="Cory Gackenheimer"><meta property="og:book:tag" itemprop="about" content="JavaScript"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript>&lt;meta http-equiv="refresh" content="0; url=/library/no-js/" /&gt;</noscript><script type="text/javascript">
  (function(i,s,o,g,r,a,m) {
    i['GoogleAnalyticsObject']=r;
    i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
    a=s.createElement(o),m=s.getElementsByTagName(o)[0];
    a.async=1;
    a.src=g;
    m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

  if (matches && matches.length === 2) {
    user_uuid = matches[1];
  }


  ga('create', 'UA-39299553-7', {'userId': '29525685-85c9-45c7-9eda-3c178d86398e' });


ga('set', 'dimension1', 'Trial');
ga('set', 'dimension6', user_uuid);


  ga('set', 'dimension2', '29525685-85c9-45c7-9eda-3c178d86398e');
  






  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
</script><script defer="" src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/vendor.34024413b1d4.js"></script><script defer="" src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/reader.a05323b190d3.js"></script><script async="" src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/MathJax.js"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts subscribe-panel library">

    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/s/" class="t-queue-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>
              
                Queue
              
            </span></a></li><li class="search"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"></path></g></svg><span>Offers &amp; Deals</span></a><ul class="flyout"><li><a href="https://www.safaribooksonline.com/oreilly-newsletters/" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/001o00000169U9HAAU/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://www.safaribooksonline.com/public/support" class="l1 no-icon">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a><span class="l2 t-nag-notification" id="nav-nag"><strong class="trial-green">10</strong> days left in your trial.
  
  

  
    
      

<a class="" href="https://www.safaribooksonline.com/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.safaribooksonline.com/public/support" class="l2">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Node.js Recipes: A Problem-Solution Approach
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781430260585/chapter/9781430260585_Ch06.xhtml" data-for-analytics="9781430260585:9781430260585_Ch06.xhtml"><span>Add to Queue</span></button></li><li class="js-font-control-panel font-control-activator"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml&amp;text=Node.js%20Recipes%3A%20A%20Problem-Solution%20Approach&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%20CHAPTER%206%3A%20Implementing%20Security%20and%20Cryptography&amp;body=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml%0D%0Afrom%20Node.js%20Recipes%3A%20A%20Problem-Solution%20Approach%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
        
        



 <!--[if lt IE 9]>
  
<![endif]-->



  <script defer="" src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/djangoMessagesPage.845b17d78025.js"></script>


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch05.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">CHAPTER 5: Using Events and Child Processes</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch07.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">CHAPTER 7: Discovering Other Node.js Modules</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content" style="transform: none;"><div class="annotator-wrapper"><p class="ChapterNumber"><a id="Chap_6"></a>CHAPTER 6</p>
<p class="chapimage"><img src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/frontdot.jpg" alt="image" width="82" height="25" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/frontdot.jpg"></p>
<p class="ChapterTitle">Implementing Security and Cryptography</p>
<div>
<p class="noindent">In this chapter you will investigate a critical part to any application, regardless of the framework you choose to use to develop it: security. However, not only will you investigate how to incorporate security features into your application, you will also get a unique perspective on how Node.js handles security and cryptography within its core and through third-party implementations.</p>
<p class="indent">You will examine various types of hashing algorithms that are available in Node.js, analyzing how they work and also for which applications they might be better suited than others. You will see solutions to verifying file integrity with hash algorithms<a id="cXXX.133i"></a>. Hash algorithms are common when you build applications as they are designed to take an arbitrary amount of data and convert it into a manageable fixed-length representation of that data, like a signature for the original data. These are common in applications and used for scenarios such as password storage where you should store a reference that can be utilized to verify the text, not the actual text of the password. Hash algorithms are also integral to building. You will utilize hash-based message authentication code (HMAC) to verify and authenticate messages for your application. Aside from hash algorithms are encryption algorithms, which are used to actually retrieve the original data after it has been encrypted. This difference with hashing algorithms is that hash algorithms are limited to one-way hashing, meaning that you do not plan to unhash a hashed message.</p>
<p class="indent">Next you will also examine the OpenSSL cyphers that are available to encrypt your data and keep it secure. You will then build on that to examine how to use the Node.js Transport Layer Security (TLS) module to secure your servers. Finally, an examination of encrypting credentials with the crypto module as well as using a third-party authentication module will complete your journey through the Node.js security landscape.</p>
<p id="Sec1" class="Heading1">6-1. Analyzing Types of Hash Algorithms</p>
<div>
<p id="Sec2" class="Heading2_2">Problem</p>
<p class="noindent">You have a command-line interface for which you have access to all of the hash algorithms available to a Node.js user to create a hash of their data. Before you distribute this application, you want a better understanding of each of the algorithms.</p>
</div>
<div>
<p id="Sec3" class="Heading2">Solution</p>
<p class="noindent">The solution for this is actually quite simple. You are going to build a list of the available hash algorithms that are currently present in Node.js. You will then see a breakdown of how many of these hashes are designed and what their common uses are in the How It Works section. First, you will build a list of the hashes, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list1" id="_list1">Listing 6-1</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list1" id="list1">Listing 6-1</a></i></b>.&nbsp;&nbsp;Building a List of Hashes Available in Node.js</p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* Hashes</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var crypto = require('crypto'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">hashes = crypto.getHashes();</span><br>&nbsp;<br><span class="FontName1">console.log(hashes.join(', '));</span></pre>
<p class="indent">You now run this code to get the full list of available hashes for Node.js.</p>
<p class="noindent2"><b><i>Listing 6-2</i></b>.&nbsp;&nbsp;Available Hashes<a id="cXXX.343"></a> in Node.js</p>
<pre><span class="FontName1">$ node 6-1-1.js</span><br><span class="FontName1">DSA-SHA1-old, dsa, dsa-sha, dsa-sha1, dsaEncryption, dsaWithSHA, dsaWithSHA1, dss1, ecdsa-with-SHA1, md4, md4WithRSAEncryption, md5, md5WithRSAEncryption, mdc2, mdc2WithRSA, ripemd, ripemd160, ripemd160WithRSA, rmd160, rsa-md4, rsa-md5, rsa-mdc2, rsa-ripemd160, rsa-sha, rsa-sha1, rsa-sha1-2, rsa-sha224, rsa-sha256, rsa-sha384, rsa-sha512, sha, sha1, sha1WithRSAEncryption, sha224, sha224WithRSAEncryption, sha256, sha256WithRSAEncryption, sha384, sha384WithRSAEncryption, sha512, sha512WithRSAEncryption, shaWithRSAEncryption, ssl2-md5, ssl3-md5, ssl3-sha1, whirlpool</span></pre>
<p class="indent">Some of these are deprecated (for example ‘DSA-SHA1-old’) or are not truly cryptographic hash functions but rather other cryptographically useful implementations. That is to say, an RSA encryption is not truly a hash function, but it can be utilized in a way that leverages a hash. In this section you will focus on the Digital Signature Algorithm (DSA), Message Digest (MD4, MD5, etc.), Secure Hash Algorithm (SHA), and WHIRLPOOL hash functions, their uses, and potential vulnerabilities.</p>
</div>
<div>
<p id="Sec4" class="Heading2">How It Works</p>
<p class="noindent">This works by utilizing the Node.js crypto module. This module is built to provide a robust implementation of many of the cryptographic needs you might encounter when building your Node.js application. The <span class="FontName1">getHashes</span> method<a id="cXXX.344"></a> is a shortcut to list all the available hashes, which is a list of the OpenSSL hashes that are available on the platform that is running Node.js.</p>
<p class="indent">Before you begin using these hashes in your application, it is important to note how they work and what they are good for; the following subsections will break down the most common algorithms and their features. In general a cryptographic hash is a way to encrypt data, or a message, into a fixed-length digest, known as the hash. This fixed-length digest will serve as a signature or fingerprint representing the original data that hashed, without divulging the contents of the original data. What follows is a listing of the common algorithms and their functions.</p>
<div>
<p id="Sec5" class="Heading3">DSA</p>
<p class="noindent">This type of encryption can encode data that were originally proposed by the National Institute for Standards and Technology for the DSS<a id="cXXX.345"></a> (Digital Signature Standard<a id="cXXX.346"></a>). Because of this, these two abbreviations are sometimes used interchangeably. It should be noted that the DSA is not directly a hash but utilizes a hash function to generate the encrypted value. This hash function was originally designed to utilize SHA-1, but SHA-2 has also been used; you will read more about these hash functions later.</p>
</div>
<div>
<p id="Sec6" class="Heading3">MD4</p>
<p class="noindent">The MD4 hash is still used, but in many cases it has been supplanted by MD5 and other more advanced hashing algorithms. It has been designated as obsolete. MD4 was designed to execute fast. What it does is to accept a message and encrypt it into a 128-bit digest.</p>
<p class="indent">The MD4<a id="cXXX.347"></a> is not strong on security. Shortly after its creation<a id="cXXX.135t"></a>, it was found to be highly probable that there would be hash collision. This means that even though slight variances in the original messages usually create a unique hash, there are several proofs and methods in which creating the same hash from multiple messages can occur. Because of this, the algorithm was improved in the MD5 specification.</p>
</div>
<div>
<p id="Sec7" class="Heading3">MD5</p>
<p class="noindent">The MD5 is the progression of MD4, in order to improve the security of the hash. It again produces a 128-bit hash, but it sacrifices the speed of the algorithm, albeit slightly. The main difference you will see from MD4 is that MD5 introduces a fourth auxiliary function that is used to process the intermediate steps of the hashing. These functions also contain some additional constants and slight variances from MD4 in order to make the hash more secure.</p>
<p class="indent">All of that said, the MD5<a id="cXXX.348"></a> hash is still not secure because it is still prone to collision and thus collision attacks. However, it is still very popular for validating file integrity, or checking for changes in files. There are various other uses for MD5, including the universally unique identifier (UUID version 3) and CRAM-MD5 (a challenge-response authentication), among others. As stated, it is still a sound hashing algorithm but because of its security vulnerabilities it should be avoided for hardened security applications, or actions like securing an SSL connection.</p>
</div>
<div>
<p id="Sec8" class="Heading3">RIPEMD</p>
<p class="noindent">There are several variants of the RIPEMD<a id="cXXX.349"></a> message digest that are based on the MD4 algorithm in its initial design. The most common RIPEMD implementation is RIPEMD-160. A later generation variant of the original 128-bit hash, it creates a 160-bit hash just like SHA-1. RIPEMD-160 does not currently have any cases of collision vulnerability as it is also expected to remain secure for perhaps another decade. RIPEMD-160 is slightly slower than SHA-1, which may be one reason why it is not as widely utilized. It is however used in Pretty Good Privacy (PGP) encryption. Another reason why RIPEMD is not widely used is that it is not marketed as the de facto standard like SHA-1 is by the National Institute for Standards and Technology.</p>
</div>
<div>
<p id="Sec9" class="Heading3">SHA</p>
<p class="noindent">SHA is available in several variants, most of which are available in Node.js.</p>
<p class="indent">The original SHA algorithm, now known as SHA-0 and available as sha in the Node.js <span class="FontName1">getHashes</span> function, is a 160-bit hash that is known to have collisions possible. For this reason it has fallen out of popularity to be replaced by the later versions of the algorithm.</p>
<p class="indent">After SHA-0 came SHA-1<a id="cXXX.350"></a><a id="cXXX.351"></a>, which is still one of the most widely utilized cryptographic hash functions in computing today. Like SHA-0 before it, SHA-1 also creates a 160-bit digest. SHA-1 is used in nearly all of the most popular secure software protocols today. It is used in Secure Sockets Layer (SSL), Secure Shell (SSH), TLS, and IP Security (IPsec) protocols, among thousands of other implementations that include hashing files in the Git version control systems. However, it has been theoretically shown that SHA-1 has collision vulnerabilities, so there have been efforts to create an even more secure hashing algorithm based on SHA-1.</p>
<p class="indent">SHA-2 is an envelope name for SHA-256 (256-bit digest), SHA-224 (224-bit digest), SHA-384 (384-bit digest), and SHA-512 (512-bit digest) all of which are available for use in Node.js. These represent evolutions from the SHA-1 algorithm. The 224-bit variety is a truncation of the 256; likewise, the 384 is a truncation of the 512.</p>
<p class="indent">The SHA-2 hash is already implemented in many of the same places that SHA-1 is, including SSL, TLS, PGP, and SSH. It is also a part of the bitcoin hashing methods as well as next-generation password hashing on many platforms.</p>
<div>
<p id="Sec10" class="Heading4">WHIRLPOOL</p>
<p class="noindent">The WHIRLPOOL algorithm<a id="cXXX.352"></a><a id="cXXX.353"></a> is another hashing algorithm available to you in Node.js. This algorithm produces a 512-bit hash and is not known to have collision vulnerabilities at this time. It has been adopted by the International Organization for Standards as a standard, but it does not have as much support as the MD5 and SHA families.</p>
<p class="indent">There are various hashing algorithms available to you when you are writing your Node.js application, each with its own cryptographic algorithm and potential vulnerabilities. You should consider each of these hashes carefully when securing your application, and be sure to scrutinize everything when it comes to evaluating cryptographic hashes.</p>
</div>
</div>
</div>
<p id="Sec11" class="Heading1">6-2. Hashing Data with createHash</p>
<div>
<p id="Sec12" class="Heading2_2">Problem</p>
<p class="noindent">You have examined the different types of hashes that are available in Node.js. You now want to implement a hash in order to secure a message.</p>
</div>
<div>
<p id="Sec13" class="Heading2">Solution</p>
<p class="noindent">In this solution you will examine the cryptographic hash functions that are available to Node.js by seeing how they hash two different forms of input: an empty string and a nonempty string<a id="cXXX.354"></a> (see <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list3" id="_list3">Listing 6-3</a>). <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list4" id="_list4">Listing 6-4</a> shows an example of the SHA-1 and MD5 hashing algorithms with their different encodings.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list3" id="list3">Listing 6-3</a></i></b>.&nbsp;&nbsp;Using Various Hashing Algorithms</p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* Analyzing types of data</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var crypto = require('crypto'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">hashes = crypto.getHashes();</span><br>&nbsp;<br><span class="FontName1">hashes.forEach(function(hash) {</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">['', 'The quick brown fox jumped over the lazy dog.'].forEach(function(txt) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var hashed;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">try {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">hashed =crypto.createHash(hash).update(txt).digest('hex');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} catch (ex) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (ex.message === 'Digest method not supported') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// not supported for this algo</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(ex, hash);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(hash, hashed);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span></pre>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list4" id="list4">Listing 6-4</a></i></b>.&nbsp;&nbsp;Hashing with Different Digest Encoding<a id="cXXX.355"></a></p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* Different Encodings</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var crypto = require('crypto'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">message = 'this is a message';</span><br>&nbsp;<br><span class="FontName1">console.log('sha1');</span><br><span class="FontName1">console.log(crypto.createHash('sha1').update(message).digest('hex'));</span><br><span class="FontName1">console.log(crypto.createHash('sha1').update(message).digest('base64'));</span><br><span class="FontName1">console.log(crypto.createHash('sha1').update(message).digest('binary'));</span><br>&nbsp;<br><span class="FontName1">console.log('md5');</span><br><span class="FontName1">console.log(crypto.createHash('md5').update(message).digest('hex'));</span><br><span class="FontName1">console.log(crypto.createHash('md5').update(message).digest('base64'));</span><br><span class="FontName1">console.log(crypto.createHash('md5').update(message).digest('binary'));</span></pre>
<p class="indent">The hashing varies greatly between algorithms. For example, the hash of the empty string with MD5 looks like <span class="FontName1">d41d8cd98f00b204e9800998ecf8427e</span> whereas the same string hashed with SHA-1 is <span class="FontName1">da39a3ee5e6b4b0d3255bfef95601890afd80709</span>. These, of course, have different appearances when utilizing different encodings, but the hashing is the same.</p>
</div>
<div>
<p id="Sec14" class="Heading2">How It Works</p>
<p class="noindent">To understand the hashing of these functions in Node.js, you must first examine the process of generating a hashed digest, and then you can look at the source code for the <span class="FontName1">createHash</span> method of the crypto module.</p>
<p class="indent">In the solutions above, you first saw how to implement the <span class="FontName1">createHash</span> method across a variety of hash algorithms available to you in Node.js. The <span class="FontName1">createHash</span> function accepts an algorithm, which must be an acceptable algorithm to create a hash. If, for example, you were to use the algorithm ‘cheese’, which does not exist, you will get the error “Digest method not supported”.</p>
<p class="indent">After you pass the algorithm to the <span class="FontName1">createHash</span> method, you now have an instance of the Node.js Hash class. This class is a stream that is readable and writable. Now you need to send a message that you want to have hashed to the <span class="FontName1">update()</span> method of the Hash class. The update function receives a message and (optionally) the encoding for that message. If not, input encoding is defined, which could be ‘<span class="FontName1">utf8</span>’ , ‘<span class="FontName1">ascii</span>’ , or ‘<span class="FontName1">binary</span>’ ; then the input is assumed to be a buffer. This means that as new data are read into the stream, this method could be called multiple times.</p>
<p class="indent">After you have called the update method on the hash stream you are now ready to create the digest, or the actual output of the hash. This function will accept an output encoding, again defaulting to a buffer if none is provided. The types of encoding that are available are ‘<span class="FontName1">hex</span>’ , ‘<span class="FontName1">binary</span>’ , and ‘<span class="FontName1">base64</span>’ . Typically in hashing algorithms, like checking the <span class="FontName1">shasum</span> (SHA-1 hash), as you will see in the next section, it is more typical to utilize ‘<span class="FontName1">hex</span>’ , but in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list4">Listing 6-4</a>, you saw an example of using multiple types of encoding for the output.</p>
<p class="indent">Now you can examine the source for the <span class="FontName1">createHash</span> method and the <span class="FontName1">hash</span> object in the Node.js source, shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list5" id="_list5">Listing 6-5</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list5" id="list5">Listing 6-5</a></i></b>.&nbsp;&nbsp;createHash Source<a id="cXXX.356"></a></p>
<pre><b>exports.createHash = exports.Hash = Hash;</b><br><span class="FontName1">function Hash(algorithm, options) {</span><br>&nbsp;&nbsp;<span class="FontName1">if (!(this instanceof Hash))</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return new Hash(algorithm, options);</span><br>&nbsp;&nbsp;<span class="FontName1">this._binding =</span> <b>new binding.Hash(algorithm);</b><br>&nbsp;&nbsp;<span class="FontName1">LazyTransform.call(this, options);</span><br><span class="FontName1">}</span><br>&nbsp;<br><span class="FontName1">util.inherits(Hash, LazyTransform);</span><br>&nbsp;<br><span class="FontName1">Hash.prototype._transform = function(chunk, encoding, callback) {</span><br>&nbsp;&nbsp;<span class="FontName1">this._binding.update(chunk, encoding);</span><br>&nbsp;&nbsp;<span class="FontName1">callback();</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">Hash.prototype._flush = function(callback) {</span><br>&nbsp;&nbsp;<span class="FontName1">var encoding = this._readableState.encoding || 'buffer';</span><br>&nbsp;&nbsp;<span class="FontName1">this.push(this._binding.digest(encoding), encoding);</span><br>&nbsp;&nbsp;<span class="FontName1">callback();</span><br><span class="FontName1">};</span><br>&nbsp;<br><b>Hash.prototype.update = function(data, encoding) {</b><br>&nbsp;&nbsp;<b>encoding = encoding || exports.DEFAULT_ENCODING;</b><br>&nbsp;&nbsp;<b>if (encoding === 'buffer'</b> <span class="FontName1">&amp;&amp;</span> <b>typeof data === 'string')</b><br>&nbsp;&nbsp;&nbsp;&nbsp;<b>encoding = 'binary';</b><br>&nbsp;&nbsp;<b>this._binding.update(data, encoding);</b><br>&nbsp;&nbsp;<b>return this;</b><br><b>};</b><br>&nbsp;<br><b>Hash.prototype.digest = function(outputEncoding) {</b><br>&nbsp;&nbsp;<b>outputEncoding = outputEncoding || exports.DEFAULT_ENCODING;</b><br>&nbsp;&nbsp;<b>return this._binding.digest(outputEncoding);</b><br><b>};</b></pre>
<p class="indent">You can note the <span class="FontName1">createHash</span>, update, and digest functions that were discussed above, but note especially the <span class="FontName1">binding.Hash(algorithm)</span> method. This is where the Node.js binds to the C++ that powers the Node.js core. This is actually where the OpenSSL hashes are processed and where things like the error that is thrown if your algorithm does not exist occurs. Aside from that, you see the hash stream checks the optional encoding values, sets them appropriately, then sends the request on the C++ binding methods respective to the caller.</p>
<p class="indent">You have now seen how to hash a message in Node.js, by selecting an algorithm, updating the hash with a message, and then creating the digest in the encoding of your choice. In the next section you will examine how to verify a file’s integrity by using common hashing functions.</p>
</div>
<p id="Sec15" class="Heading1">6-3. Verifying File Integrity<a id="cXXX.357"></a> with Hashes</p>
<div>
<p id="Sec16" class="Heading2_2">Problem</p>
<p class="noindent">You need to utilize a cryptographic hash algorithm to validate the integrity of files utilized in your Node.js application.</p>
</div>
<div>
<p id="Sec17" class="Heading2">Solution</p>
<p class="noindent">You may often encounter a situation where you need to check whether the content of your file or files that you access in your Node.js application has changed from a previous version. You can do this with the Node.js crypto module by generating a hash of the file’s content.</p>
<p class="indent">In this solution you will create an application that demonstrates the abilities of four hashing algorithms to handle the task of reading the content of a file. In <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list6" id="_list6">Listing 6-6</a>, you will pass in the file you wish to hash, and then your application will read the file stream, updating the message as the stream is read, then log the resultant hash for each algorithm.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list6" id="list6">Listing 6-6</a></i></b>.&nbsp;&nbsp;Checking File Integrity</p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* Checking File Integrity</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">args = process.argv.splice('2'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">crypto = require('crypto');</span><br><span class="FontName1">var algorithm = ['md5', 'sha1', 'sha256', 'sha512'];</span><br>&nbsp;<br><span class="FontName1">algorithm.forEach(function(algo) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var hash = crypto.createHash(algo);</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var fileStream = fs.ReadStream(args[0]);</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fileStream.on('data', function(data) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">hash.update(data);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fileStream.on('end', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(algo);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(hash.digest('hex'));</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span></pre>
<p class="indent">You can imagine building a deploy process in Node.js where you are sending or retrieving files from a remote server and you want to ensure that these files match the expected hash of the content from where they came.</p>
<p class="indent">You might also need to download a file. Once you download the file, you might need to check the integrity of this file to verify it against the value that you know to be accurate. In <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list7" id="_list7">Listing 6-7</a> you download the node executable for version 0.10.10 for Windows and check the <span class="FontName1">shasum</span> against the known value of this hash.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list7" id="list7">Listing 6-7</a></i></b>.&nbsp;&nbsp;Downloading a File and Checking shasum</p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* Verifying file integrity</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var http = require('http'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">crypto = require('crypto');</span><br>&nbsp;<br><span class="FontName1">var node_exe = fs.createWriteStream('node.exe');</span><br>&nbsp;<br><span class="FontName1">var req = http.get('</span><span class="FontName1"><a href="http://nodejs.org/dist/v0.10.10/node.exe">http://nodejs.org/dist/v0.10.10/node.exe</a></span><span class="FontName1">', function(res) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.pipe(node_exe);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.on('end', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var hash = crypto.createHash('sha1');</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">readr = fs.ReadStream('node.exe');</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">readr.on('data', function(data) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">hash.update(data);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">readr.on('end', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">// Should match 419fc85e5e16139260f7b2080ffbb66550fbe93f&nbsp;&nbsp;node.exe</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">// from</span> <span class="FontName1"><a href="http://nodejs.org/dist/v0.10.10/SHASUMS.txt">http://nodejs.org/dist/v0.10.10/SHASUMS.txt</a></span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">var dig = hash.digest('hex');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">if (dig === '419fc85e5e16139260f7b2080ffbb66550fbe93f') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('match');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('no match');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">console.log(dig);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span><br>&nbsp;<br>&nbsp;</pre>
</div>
<div>
<p id="Sec18" class="Heading2">How It Works</p>
<p class="noindent">The solution in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list6">Listing 6-6</a> begins by requiring the crypto and the file-system modules, both needed for this implementation. You then create an array of different algorithms to use for your hashing. As you saw in the previous sections, the two most commonly used are MD5 and SHA-1, but the variants of SHA-2 are gaining popularity as well.</p>
<p class="indent">As you loop through each of the algorithms, you then create a new hash by using <span class="FontName1">crypto.getHash</span>, passing the algorithm to use. You then create a file stream using <span class="FontName1">fs.ReadStream</span>, passing in a file name you provided as an argument on the command line. You could just as easily pass any file name to be read from your application. As the file is read by Node.js, the data event is emitted.</p>
<p class="indent">Within the callback to the data event listener, you begin to process the message portion of your hash. This is done by passing the data directly to the hash’s <span class="FontName1">update()</span> function. After the file is finished reading, the ‘end’ event is emitted. Within this callback you will actually generate the hash digest and log the result to the console.</p>
<p class="indent">When you are hashing files, it is easy to see how slight variations in content will result in a different hash. For example, a file that contains only the string ‘This is text.’ will generate an <span class="FontName1">shasum</span>, which is drastically independent from the <span class="FontName1">shasum</span> of a similar file containing the string ‘This is test.’</p>
<p class="indent">In the second example, <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list7">Listing 6-7</a>, you created a very practical solution that checks for the integrity of a file once it has been downloaded to your server using an <span class="FontName1">shasum</span>. To do this you need to import the http, file system, and crypto modules. This implementation begins by creating a file on your file system that is writable via <span class="FontName1">fs.createWriteStream</span>. Next you make an HTTP GET request to the file source; in this case you retrieve the Node.js executable for Windows, version 0.10.10. You know the correct <span class="FontName1">shasum</span> that the file should match because it is freely available from the download page for this version.</p>
<p class="indent">The response from this GET request is then piped into the file you created using <span class="FontName1">response.pipe(file)</span>. Once the response is complete, signified by the ‘end’ event, you are able to read the file from your file system. Just as in the previous example you create a hash with the given algorithm, which in this case is SHA-1, and update the message on the ‘data’ event of the file reader stream. Once the read is completed, you are able to generate the hash by calling the digest(‘hex’) method on the hash. You now have the shasum of the file you downloaded and you can compare this to the expected value to ensure that the download is complete and not corrupted.</p>
<p class="indent">Checking the integrity of the file on your system is critical, but if you just want to get the hash of a remote file, you are able to generate the shasum of the file by hashing the response stream directly, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list8" id="_list8">Listing 6-8</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list8" id="list8">Listing 6-8</a></i></b>.&nbsp;&nbsp;Hashing the HTTP Response Stream</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1"> * Verifying file integrity</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var http = require('http'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">crypto = require('crypto');</span><br>&nbsp;<br><span class="FontName1">var req = http.get('</span><span class="FontName1"><a href="http://nodejs.org/dist/v0.10.10/node.exe">http://nodejs.org/dist/v0.10.10/node.exe</a></span><span class="FontName1">', function(res) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var hash = crypto.createHash('sha1');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.on('data', function(data) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">hash.update(data);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.on('end', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(hash.digest('hex'));</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span></pre>
<p class="indent">This eliminates the file writing and simply updates the hash when the response stream emits the ‘data’ event, finally generating the digest when the response ends.</p>
</div>
<p id="Sec19" class="Heading1">6-4. Using an HMAC<a id="cXXX.358"></a> to Verify and Authenticate Messages</p>
<div>
<p id="Sec20" class="Heading2_2">Problem</p>
<p class="noindent">You need to authenticate a message in your Node.js application by using HMAC.</p>
</div>
<div>
<p id="Sec21" class="Heading2">Solution</p>
<p class="noindent">To generate an HMAC, you need to have a basic understanding of the cryptographic hash functions outlined in the earlier sections of this chapter. Node.js provides a method, similar to the <span class="FontName1">createHash</span> function, that will allow you to easily secure your messages with HMAC. <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list9" id="_list9">Listing 6-9</a> shows how to implement an SHA-1-based HMAC in Node.js and also compares that to the SHA-1 hashing method directly.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list9" id="list9">Listing 6-9</a></i></b>.&nbsp;&nbsp;Using HMAC</p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* Using Hash-Based Message Authentication</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var crypto = require('crypto')</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">secret = 'not gonna tell you';</span><br>&nbsp;<br><span class="FontName1">var hash = crypto.createHash('sha1').update('text to keep safe').digest('hex');</span><br><span class="FontName1">var hmac = crypto.createHmac('sha1', secret).update('text to keep safe').digest('hex');</span><br>&nbsp;<br><span class="FontName1">console.log(hash);</span><br><span class="FontName1">console.log(hmac);</span></pre>
<p class="indent">This will generate an output of two 160-bit encoded hashes, but even though they are encoding the same text, they are quite different because the HMAC utilizes the secret key to authenticate the hash.</p>
<p class="indent">SHA-1 Hash versus SHA-1 HMAC</p>
<pre><span class="FontName1">f59de5dd5f2d5c49e45e1317448031baa38ab7e9</span><br><span class="FontName1">c6b314dbebdd4ff17d0fc84e9ee0d5ab5821df5f</span></pre>
</div>
<div>
<p id="Sec22" class="Heading2">How It Works</p>
<p class="noindent">HMAC creates a way to validate the integrity of a message, like any cryptographic hash could, and it also, because of the integration of a secret key, allows you to validate the authenticity of a message. This may not be the Holy Grail of cryptographic functions, but it surpasses the security of simply hashing a message because it does provide an extra method for validation. This will help you to assert that your message has not been altered in transit, providing a level of assurance more than a higher level of cryptography.</p>
<p class="indent">You could theoretically produce a valid message with a key attached by concatenating a secret with a message when you are creating an SHA-1 hash of a message, but there still remains vulnerability in this structure. This is due to the fact that if an attacker is able to determine the message, he or she could programmatically extract the secret key and gain access to protected information on messages that he or she has yet to encounter. This is dangerous.</p>
<p class="indent">Basically an SHA-1 based HMAC is essentially running SHA-1 on the message twice. This automatically means that your hash is better but still is not authenticated. However, in HMAC the secret key is added to the message so that the HMAC then becomes an authenticable digest. You know that the sender of your HMAC is the actual sender because the secret key that is passed is automatically verified as authentic when you compare the digest of the HMAC. This is structured independently so that regardless of the messages you’ve encountered, and the secret keys that are passed, you will not be able to determine information for the secrets that are yet to come. This provides the extra level of assurance, as mentioned above, that your message has not been altered.</p>
<p class="indent">In your solution you create the HMAC by calling the <span class="FontName1">createHmac</span> function. This function accepts the type of hashing algorithm that you are going to use in your HMAC, and it also will take the secret key in the constructor arguments. After instantiation, the <span class="FontName1">crypto.Hmac</span> is created and processes with the same methods are attached to the prototype as the hash object. The difference is that the C++ binding is directed to the <span class="FontName1">HMAC</span> binding and not the hash, meaning that the processing implements the correct HMAC algorithms instead. The C++ then parses the arguments for the HMAC and then processes the HMAC by utilizing the OpenSSL HMAC implementation to generate the final result.</p>
<p class="noindent">Node.js HMAC implementation</p>
<pre><span class="FontName1">//hmac in crypto.js</span><br><span class="FontName1">exports.createHmac = exports.Hmac = Hmac;</span><br>&nbsp;<br><span class="FontName1">function Hmac(hmac, key, options) {</span><br>&nbsp;&nbsp;<span class="FontName1">if (!(this instanceof Hmac))</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return new Hmac(hmac, key, options);</span><br>&nbsp;&nbsp;<span class="FontName1">this._binding = new binding.Hmac();</span><br>&nbsp;&nbsp;<span class="FontName1">this._binding.init(hmac, toBuf(key));</span><br>&nbsp;&nbsp;<span class="FontName1">LazyTransform.call(this, options);</span><br><span class="FontName1">}</span><br>&nbsp;<br><span class="FontName1">util.inherits(Hmac, LazyTransform);</span><br>&nbsp;<br><span class="FontName1">Hmac.prototype.update = Hash.prototype.update;</span><br><span class="FontName1">Hmac.prototype.digest = Hash.prototype.digest;</span><br><span class="FontName1">Hmac.prototype._flush = Hash.prototype._flush;</span><br><span class="FontName1">Hmac.prototype._transform = Hash.prototype._transform;</span><br>&nbsp;<br><span class="FontName1">//hmac in node_crypto.cc</span><br><span class="FontName1">void Hmac::Initialize(v8::Handle&lt;v8::Object&gt; target) {</span><br>&nbsp;&nbsp;<span class="FontName1">HandleScope scope(node_isolate);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">Local&lt;FunctionTemplate&gt; t = FunctionTemplate::New(New);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">t-&gt;InstanceTemplate()-&gt;SetInternalFieldCount(1);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">NODE_SET_PROTOTYPE_METHOD(t, "init", HmacInit);</span><br>&nbsp;&nbsp;<span class="FontName1">NODE_SET_PROTOTYPE_METHOD(t, "update", HmacUpdate);</span><br>&nbsp;&nbsp;<span class="FontName1">NODE_SET_PROTOTYPE_METHOD(t, "digest", HmacDigest);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">target-&gt;Set(FIXED_ONE_BYTE_STRING(node_isolate, "Hmac"), t-&gt;GetFunction());</span><br><span class="FontName1">}</span><br>&nbsp;<br>&nbsp;<br><span class="FontName1">void Hmac::New(const FunctionCallbackInfo&lt;Value&gt;&amp; args) {</span><br>&nbsp;&nbsp;<span class="FontName1">HandleScope scope(node_isolate);</span><br>&nbsp;&nbsp;<span class="FontName1">Hmac* hmac = new Hmac();</span><br>&nbsp;&nbsp;<span class="FontName1">hmac-&gt;Wrap(args.This());</span><br><span class="FontName1">}</span><br>&nbsp;<br>&nbsp;<br><span class="FontName1">void Hmac::HmacInit(const char* hash_type, const char* key, int key_len) {</span><br>&nbsp;&nbsp;<span class="FontName1">HandleScope scope(node_isolate);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">assert(md_ == NULL);</span><br>&nbsp;&nbsp;<span class="FontName1">md_ = EVP_get_digestbyname(hash_type);</span><br>&nbsp;&nbsp;<span class="FontName1">if (md_ == NULL) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return ThrowError("Unknown message digest");</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;<span class="FontName1">HMAC_CTX_init(&amp;ctx_);</span><br>&nbsp;&nbsp;<span class="FontName1">if (key_len == 0) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">HMAC_Init(&amp;ctx_, "", 0, md_);</span><br>&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">HMAC_Init(&amp;ctx_, key, key_len, md_);</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;<span class="FontName1">initialised_ = true;</span><br><span class="FontName1">}</span><br>&nbsp;<br>&nbsp;<br><span class="FontName1">void Hmac::HmacInit(const FunctionCallbackInfo&lt;Value&gt;&amp; args) {</span><br>&nbsp;&nbsp;<span class="FontName1">HandleScope scope(node_isolate);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">Hmac* hmac = ObjectWrap::Unwrap&lt;Hmac&gt;(args.This());</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">if (args.Length() &lt; 2 || !args[0]-&gt;IsString()) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return ThrowError("Must give hashtype string, key as arguments");</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">ASSERT_IS_BUFFER(args[1]);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">const String::Utf8Value hash_type(args[0]);</span><br>&nbsp;&nbsp;<span class="FontName1">const char* buffer_data = Buffer::Data(args[1]);</span><br>&nbsp;&nbsp;<span class="FontName1">size_t buffer_length = Buffer::Length(args[1]);</span><br>&nbsp;&nbsp;<span class="FontName1">hmac-&gt;HmacInit(*hash_type, buffer_data, buffer_length);</span><br><span class="FontName1">}</span><br>&nbsp;<br>&nbsp;<br><span class="FontName1">bool Hmac::HmacUpdate(const char* data, int len) {</span><br>&nbsp;&nbsp;<span class="FontName1">if (!initialised_) return false;</span><br>&nbsp;&nbsp;<span class="FontName1">HMAC_Update(&amp;ctx_, reinterpret_cast&lt;const unsigned char*&gt;(data), len);</span><br>&nbsp;&nbsp;<span class="FontName1">return true;</span><br><span class="FontName1">}</span><br>&nbsp;<br>&nbsp;<br><span class="FontName1">void Hmac::HmacUpdate(const FunctionCallbackInfo&lt;Value&gt;&amp; args) {</span><br>&nbsp;&nbsp;<span class="FontName1">HandleScope scope(node_isolate);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">Hmac* hmac = ObjectWrap::Unwrap&lt;Hmac&gt;(args.This());</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">ASSERT_IS_STRING_OR_BUFFER(args[0]);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">// Only copy the data if we have to, because it's a string</span><br>&nbsp;&nbsp;<span class="FontName1">bool r;</span><br>&nbsp;&nbsp;<span class="FontName1">if (args[0]-&gt;IsString()) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">Local&lt;String&gt; string = args[0].As&lt;String&gt;();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">enum encoding encoding = ParseEncoding(args[1], BINARY);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!StringBytes::IsValidString(string, encoding))</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return ThrowTypeError("Bad input string");</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">size_t buflen = StringBytes::StorageSize(string, encoding);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">char* buf = new char[buflen];</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">size_t written = StringBytes::Write(buf, buflen, string, encoding);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">r = hmac-&gt;HmacUpdate(buf, written);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">delete[] buf;</span><br>&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">char* buf = Buffer::Data(args[0]);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">size_t buflen = Buffer::Length(args[0]);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">r = hmac-&gt;HmacUpdate(buf, buflen);</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">if (!r) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return ThrowTypeError("HmacUpdate fail");</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">}</span><br>&nbsp;<br>&nbsp;<br><span class="FontName1">bool Hmac::HmacDigest(unsigned char** md_value, unsigned int* md_len) {</span><br>&nbsp;&nbsp;<span class="FontName1">if (!initialised_) return false;</span><br>&nbsp;&nbsp;<span class="FontName1">*md_value = new unsigned char[EVP_MAX_MD_SIZE];</span><br>&nbsp;&nbsp;<span class="FontName1">HMAC_Final(&amp;ctx_, *md_value, md_len);</span><br>&nbsp;&nbsp;<span class="FontName1">HMAC_CTX_cleanup(&amp;ctx_);</span><br>&nbsp;&nbsp;<span class="FontName1">initialised_ = false;</span><br>&nbsp;&nbsp;<span class="FontName1">return true;</span><br><span class="FontName1">}</span><br>&nbsp;<br>&nbsp;<br><span class="FontName1">void Hmac::HmacDigest(const FunctionCallbackInfo&lt;Value&gt;&amp; args) {</span><br>&nbsp;&nbsp;<span class="FontName1">HandleScope scope(node_isolate);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">Hmac* hmac = ObjectWrap::Unwrap&lt;Hmac&gt;(args.This());</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">enum encoding encoding = BUFFER;</span><br>&nbsp;&nbsp;<span class="FontName1">if (args.Length() &gt;= 1) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">encoding = ParseEncoding(args[0]-&gt;ToString(), BUFFER);</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">unsigned char* md_value = NULL;</span><br>&nbsp;&nbsp;<span class="FontName1">unsigned int md_len = 0;</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">bool r = hmac-&gt;HmacDigest(&amp;md_value, &amp;md_len);</span><br>&nbsp;&nbsp;<span class="FontName1">if (!r) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">md_value = NULL;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">md_len = 0;</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">Local&lt;Value&gt; rc = StringBytes::Encode(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">reinterpret_cast&lt;const char*&gt;(md_value), md_len, encoding);</span><br>&nbsp;&nbsp;<span class="FontName1">delete[] md_value;</span><br>&nbsp;&nbsp;<span class="FontName1">args.GetReturnValue().Set(rc);</span><br><span class="FontName1">}</span></pre>
</div>
<p id="Sec23" class="Heading1">6-5. Reviewing OpenSSL Ciphers<a id="cXXX.146k"></a> and Security</p>
<div>
<p id="Sec24" class="Heading2_2">Problem</p>
<p class="noindent">You need a high-level understanding of the OpenSSL ciphers that are available to you as a Node.js developer.</p>
</div>
<div>
<p id="Sec25" class="Heading2">Solution</p>
<p class="noindent">Node.js provides a wrapper for the OpenSSL ciphers. Because of this, the ciphers that are available to you are those that are available via OpenSSL. To view these available ciphers, you can run a simple program (see <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list10" id="_list10">Listing 6-10</a>) that will output the various ciphers that are available in Node.js.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list10" id="list10">Listing 6-10</a></i></b>.&nbsp;&nbsp;Ciphers Available to Node.js</p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* Reviewing ciphers</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var crypto = require('crypto');</span><br>&nbsp;<br><span class="FontName1">var ciphers = crypto.getCiphers();</span><br><span class="FontName1">console.log(ciphers.join(', '));</span></pre>
<p class="indent">In <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list11" id="_list11">Listing 6-11</a>, you see the output of the <span class="FontName1">getCiphers()</span> function. These are all of the ciphers available, of which several will be discussed in the How It Works section.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list11" id="list11">Listing 6-11</a></i></b>.&nbsp;&nbsp;crypto.getCiphers()<a id="cXXX.359"></a></p>
<pre><span class="FontName1">[ 'CAST-cbc', 'aes-128-cbc', 'aes-128-cbc-hmac-sha1', 'aes-128-cfb', 'aes-128-cfb1', 'aes-128-cfb8', 'aes-128-ctr', 'aes-128-ecb', 'aes-128-gcm', 'aes-128-ofb', 'aes-128-xts', 'aes-192-cbc', 'aes-192-cfb', 'aes-192-cfb1', 'aes-192-cfb8', 'aes-192-ctr', 'aes-192-ecb', 'aes-192-gcm', 'aes-192-ofb', 'aes-256-cbc', 'aes-256-cbc-hmac-sha1', 'aes-256-cfb', 'aes-256-cfb1', 'aes-256-cfb8', 'aes-256-ctr', 'aes-256-ecb', 'aes-256-gcm', 'aes-256-ofb', 'aes-256-xts', 'aes128', 'aes192', 'aes256', 'bf', 'bf-cbc', 'bf-cfb', 'bf-ecb', 'bf-ofb', 'blowfish', 'camellia-128-cbc', 'camellia-128-cfb', 'camellia-128-cfb1', 'camellia-128-cfb8', 'camellia-128-ecb', 'camellia-128-ofb', 'camellia-192-cbc', 'camellia-192-cfb', 'camellia-192-cfb1', 'camellia-192-cfb8', 'camellia-192-ecb', 'camellia-192-ofb', 'camellia-256-cbc', 'camellia-256-cfb', 'camellia-256-cfb1', 'camellia-256-cfb8', 'camellia-256-ecb', 'camellia-256-ofb', 'camellia128', 'camellia192', 'camellia256', 'cast', 'cast-cbc', 'cast5-cbc', 'cast5-cfb', 'cast5-ecb', 'cast5-ofb', 'des', 'des-cbc', 'des-cfb', 'des-cfb1', 'des-cfb8', 'des-ecb', 'des-ede', 'des-ede-cbc', 'des-ede-cfb', 'des-ede-ofb', 'des-ede3', 'des-ede3-cbc', 'des-ede3-cfb', 'des-ede3-cfb1', 'des-ede3-cfb8', 'des-ede3-ofb', 'des-ofb', 'des3', 'desx', 'desx-cbc', 'id-aes128-GCM', 'id-aes192-GCM', 'id-aes256-GCM', 'idea', 'idea-cbc', 'idea-cfb', 'idea-ecb', 'idea-ofb', 'rc2', 'rc2-40-cbc', 'rc2-64-cbc', 'rc2-cbc', 'rc2-cfb', 'rc2-ecb', 'rc2-ofb', 'rc4', 'rc4-40', 'rc4-hmac-md5', 'seed', 'seed-cbc', 'seed-cfb', 'seed-ecb', 'seed-ofb' ]</span></pre>
</div>
<div>
<p id="Sec26" class="Heading2">How It Works</p>
<p class="noindent">Ciphers are a way to encrypt and decrypt data by using a set algorithm<a id="cXXX.360"></a>. There are many algorithms available to you as you saw in the solution to this section. Many of these are block ciphers, or ciphers that act on a fixed block of data, as opposed to a cipher that would act on a stream of data and turn the plaintext into an encrypted form, or ciphertext. Each cipher has its own implementation, which I will discuss in detail.</p>
<div class="notepara">
<p class="paraaftertitle1"><img src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/sq.jpg" alt="image" width="12" height="12" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/sq.jpg">&nbsp;<b>Note</b>&nbsp;&nbsp;This section discusses some relatively complex material concerning algorithms and implementations for various ciphers. Some terminology that is common when referring to cryptographic ciphers is defined here for your reference.</p>
<p class="noindent"><span class="underline">attack vector</span>: A set of malicious code that can target a security vulnerability.</p>
<p class="noindent"><span class="underline">block</span>: A group of bits of a specified size that is commonly used in a block cipher.</p>
<p class="noindent"><span class="underline">block cipher</span>: A type of cipher that operates within individual blocks, performing permutations on separate blocks until the final ciphertext is obtained.</p>
<p class="noindent"><span class="underline">ciphertext</span>: The end result of encrypting plaintext by using a cipher.</p>
<p class="noindent"><span class="underline">permutation</span>: A round of processing, or transformation, of the data.</p>
<p class="noindent"><span class="underline">related-key attack</span>: An attack vector that targets a cipher using multiple and mathematically related keys. The results of these ciphers can then be used to extrapolate the cipher and compromise encrypted values.</p>
</div>
<div>
<p id="Sec27" class="Heading3">DES</p>
<p class="noindent">DES<a id="cXXX.361"></a> stands for Data Encryption Standard<a id="cXXX.362"></a>, and it is a block cipher originally designed at IBM in the 1970s. DES utilizes a cipher block size of 64 bits, and also the key size is 64 bits. The algorithm will take a 64-bit block of plaintext, operate an initial permutation on the block, split the block into two 32-bit halves, and then process them in an alternating fashion by XORing them against a portion of the key. This process repeats for 16 rounds until a final permutation occurs. The result is the DES ciphertext.</p>
<p class="indent">DES is vulnerable to a brute-force attack, like other ciphers, where an attacker will be able to perform a check against all possible keys. Because the key length in DES is 56 bits (64 minus the last 8 bits for parity check), the key is relatively short and thus makes a brute-force attack feasible. Still, even though DES is vulnerable it was not until it had been present in the market for more than 20 years before an attack was successfully demonstrated.</p>
<p class="indent">Because of its vulnerabilities, DES is not favored for many applications; however, there is a superseding implementation that is still widely utilized: Triple DES.</p>
<p class="indent">Triple DES is a way to increase the key size of the DES algorithm by essentially running the process three times. The overall design is the same but chooses three keys. The first key is used to encrypt the plaintext. The second key is then used to decrypt the first encryption. Finally, a third key runs DES again in order to generate the ciphertext. These keys can be either all the same, one different, or all three different, and they vary in strength according to the differences in keys, because essentially you are determining the key length of the cipher. While there are still known attacks against Triple DES, it is a more secure option than DES by itself.</p>
</div>
<div>
<p id="Sec28" class="Heading3">RC2<a id="cXXX.363"></a></p>
<p class="noindent">RC2 (or Rivest Cipher 2), also a block cipher, was created by Ron Rivest of RSA fame in the late 1980s. The RC2 cipher is composed of 64-bit blocks, like DES, and it incorporates 18 rounds in the algorithm. There are 16 rounds of “mixing” and 2 rounds of “mashing.” The key size for the RC2 algorithm is variable from 8 to 128 bits, defaulting to 64. There is a known vulnerability for this cipher by a related-key attack.</p>
</div>
<div>
<p id="Sec29" class="Heading3">RC4</p>
<p class="noindent">RC4<a id="cXXX.364"></a> is a stream cipher also designed by Ron Rivest in the late 1980s. It is well known for its speed and simplicity. This cipher works by generating a stream of near random bits, which are used for the encryption. This happens in two steps: first, there is an array generation step, then a pseudo-random generation step. The output is generated by looping through the semirandom bytes of the array two at a time, swapping values of each in the array, then processing those modulo 256. The result is used to look up the sum of this operation in the bytes array.</p>
<p class="indent">RC4 has been widely used in many applications, such as TLS, Wired Equivalent Privacy (WEP), and Wi-Fi Protected Access (WPA). However, it is not impenetrable to attack vectors partially due to the pseudo-random values. Because of this, in 2001, WEP encryption of wireless networks was attacked, and this prompted a subsequent implementation for wireless encryption.</p>
</div>
<div>
<p id="Sec30" class="Heading3">CAST</p>
<p class="noindent">CAST<a id="cXXX.365"></a> is a block cipher. It is widely used in versions of PGP and GNU Privacy Guard (GPG) encryption. The algorithm itself utilizes key sizes from 40 to 128 bits and will run either 12 rounds or 16, though 12 only occurs if the key size is fewer than 80 bits. The underlying function consists of eight 32-bit substitution boxes that are based on other various algorithms, such as XOR, modular addition, bent functions, and rotations. There are three different round functions that are used in the CAST cipher. The first version of the round function is used in rounds 1, 4, 7, 10, 13, 16; the second on rounds 2, 5, 8, 11, 14; and the third with rounds 3, 6, 9, 12 and 15.</p>
</div>
<div>
<p id="Sec31" class="Heading3">CAMELLIA</p>
<p class="noindent">The Camellia cipher<a id="cXXX.366"></a><a id="cXXX.367"></a> is another 128-bit block cipher, and its block size is 16 bytes. The key size is variable between 128, 192, and 256 bits. Camellia is another Feistel cipher that will use 18 rounds if using 128-bit keys or 24 rounds when using the larger key sizes. Like CAST, Camellia uses substitution boxes. For Camellia these boxes are 8-bit by 8-bit boxes and four of them are utilized. There is a special transform applied to this cipher every six rounds.</p>
</div>
<div>
<p id="Sec32" class="Heading3">BLOWFISH</p>
<p class="noindent">The Blowfish cipher<a id="cXXX.368"></a><a id="cXXX.369"></a> is a block cipher designed by Bruce Scheiner. It is highly regarded, even though it is vulnerable to vectors, including a differential attack. The block size is 64 bits and the key can be anywhere from 32 to 448 bits. It utilizes 16 rounds and large S-boxes. The speed of this algorithm is 8.3 MB/s on a Pentium at 150 Hz.</p>
<p class="indent">There are several well-known password management products that utilize Blowfish. These include 1Password, Password Safe, and Password Wallet, among others. It is also utilized in GPG and many file and disk encryption softwares.</p>
</div>
<div>
<p id="Sec33" class="Heading3">AES</p>
<p class="noindent">AES<a id="cXXX.370"></a> (aka Rijndael), or Advanced Encryption Standard<a id="cXXX.371"></a>, is an encryption algorithm designed to supersede DES. AES has a block size of 128 bits, and key sizes can be 128, 192, or 256 bits. AES will operate in 10 rounds for the 128-bit keys, 12 rounds for 192-bit keys, or 14 rounds for 256-bit keys. The process of the AES cipher operations on a 4-byte by 4-byte matrix is called the “state.” The process first expands the key by using a Rijndael key schedule and then the rounds can begin.</p>
<p class="indent">The first round is known as “AddRoundKey,” which extracts a subkey, and a byte from the state is combined by using XOR.</p>
<p class="indent">This begins the remaining rounds with exclusion of a final round. The rounds start by executing a “SubBytes” step that replaces each byte in the “state” by way of an 8-bit substitution box. This is followed by a “ShiftRows” step, which will shift all the values of the rows by a set amount. This amount varies per row. The next step is the “MixColumns” step. In this step a column in the “state” is combined by using an invertible linear transform. Through this step, each column is essentially transposed by multiplication with a known polynomial or matrix to get the resultant mixed columns. Then there is another “AddRoundKey” step.</p>
<p class="indent">After the rounds complete, there is a final round that operates in the same way as the previous rounds except the “MixColumns” step is omitted. The result is the AES ciphertext.</p>
<p class="indent">AES is vulnerable to a related-key attack, distinguishing attack, and key-recovery attack. However, the complexity of these attacks is nontrivial and AES is still fundamentally secure. In fact it is arguably the most widely used encryption cipher in practice today.</p>
<p class="indent">It is used to encrypt file archives in instances of 7Zip, RAR, and WinZip. Other places where AES is used is a disk encryption technology like BitLocker. Also using forms of AES are GPG, IPsec, IronKey, OpenSSL (the wrapper from which Node.js’s crypto derives), Pidgin, and the Linux Kernel Crypto API. There are, of course, many more places where AES is being used today but these are just a handful.</p>
<p class="indent">There are various ciphers at your disposal when you build your Node.js application. You should choose the implementation that suits the particular needs of your solution and keep up to date on changing standards and new implementations.</p>
</div>
</div>
<p id="Sec34" class="Heading1">6-6. Using OpenSSL Ciphers to Encrypt Data<a id="cXXX.372"></a></p>
<div>
<p id="Sec35" class="Heading2_2">Problem</p>
<p class="noindent">You have gained some understanding of OpenSSL ciphers that are available in Node.js. Now you need to encrypt data by utilizing these ciphers.</p>
</div>
<div>
<p id="Sec36" class="Heading2">Solution</p>
<p class="noindent">It is important to understand how to implement a cipher in your code. To do this, you will build a solution that will take a key and a string of text and then utilize an AES-256 algorithm to create a ciphertext from your plaintext and decrypt it again, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list12" id="_list12">Listing 6-12</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list12" id="list12">Listing 6-12</a></i></b>.&nbsp;&nbsp;Creating Ciphertext from Plaintext</p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* encrypting data</span><br>&nbsp;<span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var crypto = require('crypto'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">algo = 'aes256',</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">key = 'cheese',</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">text = 'the itsy bitsy spider went up the water spout';</span><br>&nbsp;<br><span class="FontName1">var cipher = crypto.createCipher(algo, key);</span><br><span class="FontName1">var encrypted = cipher.update(text, 'utf8', 'hex') + cipher.final('hex');</span><br>&nbsp;<br><span class="FontName1">console.log(encrypted);</span><br>&nbsp;<br><span class="FontName1">var decipher = crypto.createDecipher(algo, key);</span><br><span class="FontName1">var decrypted = decipher.update(encrypted, 'hex', 'utf8') + decipher.final('utf8');</span><br>&nbsp;<br><span class="FontName1">if (decrypted === text) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('success!');</span><br><span class="FontName1">}</span></pre>
<p class="indent">Encrypting plaintext in your application is important, but there may be situations where you wish to encrypt the content of an entire file and then decipher that text later on. This solution requires the use of the file-system module so that you are capable of reading the file’s contents.</p>
<p class="noindent2"><b><i>Listing 6-13</i></b>.&nbsp;&nbsp;Encrypting the Contents of a File</p>
<pre><span class="FontName1">/**</span><br>&nbsp;<span class="FontName1">* using ciphers on files</span><br><span class="FontName1"> */</span><br>&nbsp;<br><span class="FontName1">var crypto = require('crypto'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">algo = 'aes256',</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">key = 'cheese';</span><br>&nbsp;<br><span class="FontName1">var text = fs.readFileSync('6-6-1.txt', { encoding: 'utf8' });</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br><span class="FontName1">var cipher = crypto.createCipher(algo, key);</span><br><span class="FontName1">var encrypted = cipher.update(text, 'utf8', 'hex') + cipher.final('hex');</span><br>&nbsp;<br><span class="FontName1">console.log(encrypted);</span><br>&nbsp;<br><span class="FontName1">var decipher = crypto.createDecipher(algo, key);</span><br><span class="FontName1">var decrypted = decipher.update(encrypted, 'hex', 'utf8') + decipher.final('utf8');</span><br>&nbsp;<br><span class="FontName1">if (decrypted === text) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('success!');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(text);</span><br><span class="FontName1">}</span></pre>
</div>
<div>
<p id="Sec37" class="Heading2">How It Works</p>
<p class="noindent">The <span class="FontName1">createCipher</span> function is essential when you use the crypto module in Node.js. The <span class="FontName1">createCipher</span> method will accept an algorithm and a password or key. The result of this method is to create a cipher object. The cipher object is a stream and has three methods.</p>
<p class="noindent"><i>Node.jscrypto.createCipher object</i></p>
<pre><span class="FontName1">exports.createCipher = exports.Cipher = Cipher;</span><br><span class="FontName1">function Cipher(cipher, password, options) {</span><br>&nbsp;&nbsp;<span class="FontName1">if (!(this instanceof Cipher))</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return new Cipher(cipher, password, options);</span><br>&nbsp;&nbsp;<span class="FontName1">this._binding = new binding.CipherBase(true);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this._binding.init(cipher, toBuf(password));</span><br>&nbsp;&nbsp;<span class="FontName1">this._decoder = null;</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">LazyTransform.call(this, options);</span><br><span class="FontName1">}</span><br>&nbsp;<br><span class="FontName1">util.inherits(Cipher, LazyTransform);</span><br>&nbsp;<br><span class="FontName1">Cipher.prototype._transform = function(chunk, encoding, callback) {</span><br>&nbsp;&nbsp;<span class="FontName1">this.push(this._binding.update(chunk, encoding));</span><br>&nbsp;&nbsp;<span class="FontName1">callback();</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">Cipher.prototype._flush = function(callback) {</span><br><br>&nbsp;&nbsp;<span class="FontName1">this.push(this._binding.final());</span>&nbsp;&nbsp;<span class="FontName1">callback();</span><br><span class="FontName1">};</span></pre>
<p class="indent">To encrypt a data, or a string of data as in the solutions in this section, you use the update function. The update method accepts the data you wish to encrypt, an input encoding, and an output encoding. The result of this method is the enciphered data, and, like the crypto hashes, it can be called multiple times on a cipher. Once you have completed the cipher you will then call the <span class="FontName1">cipher.final</span> function that accepts an output encoding, leaving you with the result of your cipher.</p>
<p class="noindent"><i>Cipher Update and Final Output</i></p>
<pre><span class="FontName1">Cipher.prototype.update = function(data, inputEncoding, outputEncoding) {</span><br>&nbsp;&nbsp;<span class="FontName1">inputEncoding = inputEncoding || exports.DEFAULT_ENCODING;</span><br>&nbsp;&nbsp;<span class="FontName1">outputEncoding = outputEncoding || exports.DEFAULT_ENCODING;</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">var ret = this._binding.update(data, inputEncoding);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">if (outputEncoding &amp;&amp; outputEncoding !== 'buffer') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this._decoder = getDecoder(this._decoder, outputEncoding);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">ret = this._decoder.write(ret);</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">return ret;</span><br><span class="FontName1">};</span><br>&nbsp;<br>&nbsp;<br><span class="FontName1">Cipher.prototype.final = function(outputEncoding) {</span><br>&nbsp;&nbsp;<span class="FontName1">outputEncoding = outputEncoding || exports.DEFAULT_ENCODING;</span><br>&nbsp;&nbsp;<span class="FontName1">var ret = this._binding.final();</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">if (outputEncoding &amp;&amp; outputEncoding !== 'buffer') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this._decoder = getDecoder(this._decoder, outputEncoding);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">ret = this._decoder.end(ret);</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">return ret;</span><br><span class="FontName1">};</span></pre>
<p class="indent">Lastly, you are able to override the padding on the cipher’s input data into block size by using the setAutoPadding(false) function. This needs to be called before .final().</p>
<pre><span class="FontName1">Cipher.prototype.setAutoPadding = function(ap) {</span><br>&nbsp;&nbsp;<span class="FontName1">this._binding.setAutoPadding(ap);</span><br>&nbsp;&nbsp;<span class="FontName1">return this;</span><br><span class="FontName1">};</span></pre>
<p class="indent">As you may already suspect, the <span class="FontName1">crypto.createDecipher</span> function, used to reverse the process of encryption, functions in a similar way to the <span class="FontName1">createCipher</span> function. It does indeed, as it creates a Decipher object during instantiation. Once it is created, you are given access to the same API that the cipher object has.</p>
<p class="noindent"><i>Node.js crypto.createDecipher</i></p>
<pre><span class="FontName1">exports.createDecipher = exports.Decipher = Decipher;</span><br><span class="FontName1">function Decipher(cipher, password, options) {</span><br>&nbsp;&nbsp;<span class="FontName1">if (!(this instanceof Decipher))</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return new Decipher(cipher, password, options);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this._binding = new binding.CipherBase(false);</span><br>&nbsp;&nbsp;<span class="FontName1">this._binding.init(cipher, toBuf(password));</span><br>&nbsp;&nbsp;<span class="FontName1">this._decoder = null;</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">LazyTransform.call(this, options);</span><br><span class="FontName1">}</span><br>&nbsp;<br><span class="FontName1">util.inherits(Decipher, LazyTransform);</span><br>&nbsp;<br><span class="FontName1">Decipher.prototype._transform = Cipher.prototype._transform;</span><br><span class="FontName1">Decipher.prototype._flush = Cipher.prototype._flush;</span><br><span class="FontName1">Decipher.prototype.update = Cipher.prototype.update;</span><br><span class="FontName1">Decipher.prototype.final = Cipher.prototype.final;</span><br><span class="FontName1">Decipher.prototype.finaltol = Cipher.prototype.final;</span><br><span class="FontName1">Decipher.prototype.setAutoPadding = Cipher.prototype.setAutoPadding;</span></pre>
<p class="indent">In your solution, you created two examples of a ciphertext and deciphered that text within the same application. For the case of the plaintext string in the file, this works by using the password key ‘cheese’ and using that in the <span class="FontName1">createCipher</span> method. This essentially is no different than the second example where you used the file system to read the contents of a file, encoded to UTF-8, and deciphered the resultant ciphertext to find the expected result. In this example you utilized the AES-256 cipher algorithm, but any of the acceptable OpenSSL algorithms would work. For example, you could easily replace aes256 with ‘cast’ or 'camellia256’, provided that you are consistent between enciphering and deciphering the data.</p>
</div>
<p id="Sec38" class="Heading1">6-7. <a id="cXXX.373"></a>Using Node.js’s TLS Module for Securing Your Server</p>
<div>
<p id="Sec39" class="Heading2_2">Problem</p>
<p class="noindent">You have a Node.js server that is transmitting information and you want to ensure the security of that transmission by utilizing Node.js’s TLS module.</p>
</div>
<div>
<p id="Sec40" class="Heading2">Solution</p>
<p class="noindent">Building a TLS server in Node.js will look familiar. It is similar to the HTTPS server that you created in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch04.xhtml">Chapter 4</a>. This is because the underlying architecture of the HTTP server object is inherited from the TLS module.</p>
<p class="indent">To create a TLS server you need to start with the TLS module itself. Then you will build a reference to your server key and certificate files and pass them as options, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list14" id="_list14">Listing 6-14</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list14" id="list14">Listing 6-14</a></i></b>.&nbsp;&nbsp;Create a TLS Server</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1"> * using TLS</span><br><span class="FontName1"> */</span><br>&nbsp;<br><span class="FontName1">var tls = require('tls'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs = require('fs');</span><br>&nbsp;<br><span class="FontName1">var options = {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">key: fs.readFileSync('srv-key.pem'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">cert: fs.readFileSync('srv-cert.pem')</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">tls.createServer(options, function(s) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">s.write('yo');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">s.pipe(s);</span><br><span class="FontName1">}).listen(8888);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </pre>
<p class="indent">Once you have created your secure TLS server with a valid key and certificate, you need to create a client that is capable of connecting to it. This is a capability of Node.js as well. In fact, as <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list15" id="_list15">Listing 6-15</a> shows, it is nearly identical to the net module’s ability to create a connection; however, you need to be mindful to point to the certificate authority and credentialing for the secure transport to be authenticated.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list15" id="list15">Listing 6-15</a></i></b>.&nbsp;&nbsp;TLS Connection</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1"> * tls connection</span><br><span class="FontName1"> */</span><br>&nbsp;<br><span class="FontName1">var tls = require('tls'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs = require('fs');</span><br>&nbsp;<br><span class="FontName1">var options = {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">key: fs.readFileSync('privatekey.pem'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">cert: fs.readFileSync('certificate.pem'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">ca: fs.readFileSync('srv-cert.pem')</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">var connection = tls.connect(8888, options, function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (connection.authorized) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('authorized');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(':( not authorized');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">connection.on('data', function(data) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(data);</span><br><span class="FontName1">});</span></pre>
</div>
<div>
<p id="Sec41" class="Heading2">How It Works</p>
<p class="noindent">TLS is a way to encrypt data that are sent to and from a server. In this solution you created a server that utilized a key and certification, generated via OpenSSL commands in the terminal just as you saw in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch04.xhtml">Chapter 4</a>.</p>
<p class="noindent2"><b><i>Listing 6-16</i></b>.&nbsp;&nbsp;Generating OpenSSL Keys</p>
<pre><span class="FontName1">$ openssl genrsa -out srv-key.pem 1024</span><br><span class="FontName1">$ openssl req -new –key srv-key.pem -out src-crt-request.csr</span><br><span class="FontName1">$ openssl x509 -req -in srv-crt-request.csr -signkey srv-key.pem -out srv-cert.pem</span></pre>
<p class="indent">Once you have the key and the certificate, you pass these into the options object when you call tls.createServer and tell it to listen on port 8888. The createServer function takes not only the options argument but also a callback. This callback is emitted on a connection to the server and passes along the secure stream with the function. In your solution, you write a string to the stream and then pipe that out.</p>
<p class="indent">There are many more options that are available when you create a server, such as setting a timeout for the handshake or rejecting unauthorized connections. All of these are taken into account to secure your server.</p>
<ul class="bulleted">
<li><span class="FontName1">ca</span>: An array of strings or buffers of trusted certificates.</li>
<li><span class="FontName1">cert</span>: A string or buffer containing the certificate key of the server in Privacy Enhanced Mail (PEM) format. (Required)</li>
<li><span class="FontName1">ciphers</span>: A string describing the ciphers to use or exclude.</li>
<li><span class="FontName1">crl</span> : A string or list of strings of PEM-encoded certificate revocation lists (CRLs)</li>
<li><span class="FontName1">handshakeTimeout</span>: Aborts the connection if the SSL/TLS handshake does not finish in a certain number of milliseconds. The default is 120 seconds.</li>
<li><span class="FontName1">honorCipherOrder</span>: When choosing a cipher, uses the server's preferences instead of the client preferences.</li>
<li><span class="FontName1">key</span>: A string or buffer containing the private key of the server in PEM format. (Required)</li>
<li><span class="FontName1">NPNProtocols</span>: An array or buffer of possible Next Protocol Negotiation (NPN) protocols. (Protocols should be ordered by their priority.)</li>
<li><span class="FontName1">passphrase</span>: A string or passphrase for the private key (or pfx).</li>
<li><span class="FontName1">pfx</span>: A string or buffer containing the private key, certificate, and certificate authority (CA) certificates of the server in PFX (or PKCS #12) format. (This is mutually exclusive with the <span class="FontName1">key</span>,&nbsp;&nbsp;<span class="FontName1">cert,</span> and <span class="FontName1">ca</span> options.)</li>
<li><span class="FontName1">rejectUnauthorized</span>: If true, the server will reject any connection that is not authorized with the list of supplied CAs. (This option only has an effect if the <span class="FontName1">requestCert</span> is true; the default is false.)</li>
<li><span class="FontName1">requestCert</span>: If true, the server will request a certificate from clients that connect and will attempt to verify that certificate. (The default is <span class="FontName1">false</span>.)</li>
<li><span class="FontName1">sessionIdContext</span>: A string containing an opaque identifier for session resumption.</li>
<li><span class="FontName1">SNICallback</span>: A function that will be called if the client supports the Server Name Identification (SNI) TLS extension.</li>
</ul>
<p class="indent">It is interesting to note that these values become part of the credentials that are created to identify your server. This is done by passing the relevant parameters into the <span class="FontName1">crypto.createCredentials</span> function.</p>
<p class="noindent2"><b><i>Listing 6-17</i></b>.&nbsp;&nbsp;createServer Methos Credentials</p>
<pre>&nbsp;<span class="FontName1">var sharedCreds = crypto.createCredentials({</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">pfx: self.pfx,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">key: self.key,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">passphrase: self.passphrase,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">cert: self.cert,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">ca: self.ca,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">ciphers: self.ciphers || DEFAULT_CIPHERS,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">secureProtocol: self.secureProtocol,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">secureOptions: self.secureOptions,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">crl: self.crl,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">sessionIdContext: self.sessionIdContext</span><br>&nbsp;&nbsp;<span class="FontName1">});</span></pre>
<p class="indent">Now you have a secure TLS server. You need to connect to it. To test the connection, simply open a terminal window and connect.</p>
<div class="notepara">
<p class="paraaftertitle1"><img src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/sq.jpg" alt="image" width="12" height="12" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/sq.jpg">&nbsp;<b>Note</b>&nbsp;&nbsp;On Windows, OpenSSL is not included by default. You can easily add it to your machine by downloading a binary at <span class="FontName1"><a href="http://openssl.org/related/binaries.html">http://openssl.org/related/binaries.html</a></span>. This will install to C:\OpenSSL-Win32 on your machine. You can then run OpenSSL from PowerShell from within the C:\OpenSSL-Win32\bin directory.</p></div>
<p class="noindent2"><b><i>Listing 6-18</i></b>.&nbsp;&nbsp;Connecting to a Secure Server</p>
<pre><span class="FontName1">$ openssl s_client –connect localhost:8888</span></pre>
<p class="indent">However, a more robust client, such as one built with Node.js, is possible. To build your client connection in your solution, you first create a connection with <span class="FontName1">tls.connect</span>. To this you pass the port (and optionally a URL). Then there is the options object, which you will notice looks quite similar to the options of the server, with the exception of the ‘ca’ option. This is the value of the CA of your server. Because the credentials for your server were self-signed, the only way to identify it is through itself. Once you have connected, you have access to the connection stream. This stream has a property that will tell you if you are actually authenticated to the server or not. From there, once you are authorized, you can perform the client-server interactions that you normally might in a networked application, but you now have the added security of TLS.</p>
</div>
<p id="Sec42" class="Heading1">6-8. Encrypting User Credentials with the Crypto Module<a id="cXXX.374"></a></p>
<div>
<p id="Sec43" class="Heading2_2">Problem</p>
<p class="noindent">You have a Node.js application that requires authentication to a server, which you need to ensure is encrypted.</p>
</div>
<div>
<p id="Sec44" class="Heading2">Solution</p>
<p class="noindent">If you are going to build any sort of secure application with Node.js, you are likely going to want a way to authenticate a user to your database. For example, imagine you have an online shopping cart for which you would like to have your users register an account for to make checkouts swifter, and also to send them promotions. You could easily implement a users table, or document, in your data store that will hold a username and a password, but storing a plaintext password is not a good idea. It is also completely unnecessary because, as you will see, it is easy to have added security when using the Node.js crypto module.</p>
<p class="indent">To build this solution, imagine that your user has just submitted a password to your site and now you want to store that as a hash. This is great because you don’t have to store the plaintext password at all, and with the use of a salt, you are able to verify subsequent logins with ease. <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list19" id="_list19">Listing 6-19</a> shows how you would go about creating a version of this implementation to store credentials.</p>
<p class="noindent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list19" id="list19">Listing 6-19</a>.&nbsp;&nbsp;Creating Secure Credentials</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1"> * user credentials</span><br><span class="FontName1"> */</span><br>&nbsp;<br><span class="FontName1">var crypto = require('crypto'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">password = 'MySuperSecretPassword';</span><br>&nbsp;<br><span class="FontName1">function getHmac(password, salt) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var out = crypto.createHmac('sha256', salt).update(password).digest('hex');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return out;</span><br><span class="FontName1">}</span><br><span class="FontName1">function getHash(password, salt) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var out = crypto.createHash('sha256').update(salt + password).digest('hex');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return out;</span><br><span class="FontName1">}</span><br>&nbsp;<br><span class="FontName1">function getSalt() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return crypto.randomBytes(32).toString('hex');</span><br><span class="FontName1">}</span><br><span class="FontName1">var salt = getSalt();</span><br><span class="FontName1">var hmac = getHmac(password, salt);</span><br><span class="FontName1">var hash = getHash(password, salt);</span><br><span class="FontName1">console.log('my pwd: ', password, ' salted: ', salt, ' and hashed: ', hash);</span><br><span class="FontName1">console.log('hmac: ' , hmac);</span></pre>
</div>
<div>
<p id="Sec45" class="Heading2">How It Works</p>
<p class="noindent">As you take a look at how this is working, you will notice there are basically only two parts to this solution. First, you generate a random salt that will be the key when you hash your password with <span class="FontName1">createHash</span> or <span class="FontName1">createHmac</span>; second, you hash your password.</p>
<p class="indent">There are differing opinions about the proper way to secure your passwords. Some people argue that something like <span class="FontName1">SHA-256 (SHA256[password])</span> is secure enough. However, most others will argue that you need to salt your hashes, as shown in this solution. Then the debate arises as to how large your hash should be, and whether it is necessary for it to be a cryptographically secure pseudo-random number or whether any collection of random bytes will work. For this solution, your code grabs a random set of 32 bytes.</p>
<p class="indent">You see this in the <span class="FontName1">getSalt</span> function. Here you access the crypto module and the <span class="FontName1">randomBytes</span> function, which is indeed a cryptographically secure pseudo-random collection of bytes. The <span class="FontName1">randomBytes</span> call in the Node.js source is a direct binding from the JavaScript to the C++ implementation.</p>
<p class="indent">Now that you have the salt, you can use that to securely hash your password. This is demonstrated in two ways in this solution. One is by the <span class="FontName1">getHmac</span> function. This function will use the salt that you generated to create your SHA-256-based HMAC. You then update the password with that HMAC, and generate the digest as Hex encoded.</p>
<p class="indent">The alternative to using the <span class="FontName1">Hmac</span> method is to append the salt to the password, and then SHA-256 has that result, as shown in the <span class="FontName1">getHash</span> function.</p>
<p class="indent">The important thing for both of these methods is to not use the same salt for each user. If you were to utilize the same salt, you would be vulnerable to a dictionary reverse-lookup attack. This means that if you and your friend use the same password, their hashes would be identical because the salt remains the same. A crafty malevolent source would be able to determine these patterns and eventually extract the secure data. However, using different salts, you will not run into this case; because the salts generated are cryptographically sound, the likelihood that they will ever collide on the same salt and password hash is minimized to a near insignificant degree.</p>
</div>
<p id="Sec46" class="Heading1">6-9. Using a Third-Party Authentication Module<a id="cXXX.375"></a></p>
<div>
<p id="Sec47" class="Heading2_2">Problem</p>
<p class="noindent">You need to authenticate your users in Node.js. To do this you want to utilize an appropriate third-party module for authentication.</p>
</div>
<div>
<p id="Sec48" class="Heading2">Solution</p>
<p class="noindent">You can imagine that you have the Node.js-based shopping cart that was discussed in the previous section. You know that you need a secure way to store user login and authentication data, but you may not be willing to roll your own authentication module. To mitigate this, you do a lot of research on the subject and find a couple of solutions. One is similar in approach to rolling your own, but it comes packaged in the npm as a module called ‘<span class="FontName1">bcrypt</span>’ . This module will allow for random salt generation, hashing of your passwords, and access to those values so you are able to store them securely on your data store. This implementation is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list20" id="_list20">Listing 6-20</a>. This implementation is a snippet from what you can imagine is a larger-scale application. This snippet is an example of a registration route in an application that will fetch user data, and if no users are found, it will utilize bcrypt to generate a salt and hash for a user, saving that to the data store.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list20" id="list20">Listing 6-20</a></i></b>.&nbsp;&nbsp;Using bcrypt to Hash Passwords</p>
<pre><span class="FontName1">app.post("/register", function(req, res) {</span><br>&nbsp;&nbsp;<span class="FontName1">var usrnm = req.body.name;</span><br>&nbsp;&nbsp;<span class="FontName1">User.findOne({username: usrnm}, function(err, usrData) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (usrData === null) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//create</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">bcrypt.genSalt(10, function(err, salt) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">bcrypt.hash(req.body.pwd, salt, function(err, hash) {</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var newUser = new User({ username: usrnm, email: req.body.email, pwHash: hash });</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">newUser.save(function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.send({name: usrnm, message: "failure", error: err});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">res.send({name: usrnm, message: "success"});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//emit to client</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.send({name: usrnm, message: "failure", error: "User already exists"});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span></pre>
<p class="indent">An alternative that you then are able to uncover is one that is built on the express.js framework. But this is an extension of the Mozilla Persona identity provider.</p>
<div class="notepara">
<p class="paraaftertitle1"><img src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/sq.jpg" alt="image" width="12" height="12" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/sq.jpg">&nbsp;<b>Note</b>&nbsp;&nbsp;Express.js is a highly popular framework for building web applications, which you will read about in more detail later in the book. Mozilla Persona is a way to utilize your e-mail address as your identity provider, eliminating the need for your users to have specific passwords for your site.</p></div>
<p class="indent">You do this by installing a module that works with Express.js, ‘express-persona’, and you implement it as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#list21" id="_list21">Listing 6-21</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#_list21" id="list21">Listing 6-21</a></i></b>.&nbsp;&nbsp;Using Persona for Authentication</p>
<pre><span class="FontName1">require('express-persona')(app, {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">audience: '</span><span class="FontName1"><a href="http://localhost:3000/">http://localhost:3000</a></span><span class="FontName1">', // Must match your browser's address bar</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">verifyResponse: function(error, req, res, email) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var out;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (error) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">out = { status: 'failure', reason: error };</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">res.json(out);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">models.user.findOrCreate(email, function(result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (result.status === 'okay' ) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">out = { status: 'okay', user: result.user };</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">out = { status: 'failure', reason: 'mongodb failed to find or create user' };</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">res.json(out);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">});</span><br>&nbsp;<br>You have seen two possible implementations of third-party authentication modules, but there is a seemingly limitless supply if you examine the npm registry. It is important to scrutinize all security implementations that you will utilize on your server or in your Node.js application.</pre>
</div>
<div>
<p id="Sec49" class="Heading2">How It Works</p>
<p class="noindent">You first implemented a solution that utilized the <span class="FontName1">bcrypt</span> module. This is installed by using the command <span class="FontName1">npm install bcrypt</span>, and then requiring the module within your code. <span class="FontName1">bcrypt</span> sets out to solve any underlying vulnerabilities in hashing passwords that are vulnerable to dictionary attacks.</p>
<p class="indent">The <span class="FontName1">bcrypt</span> solution is derived from Blowfish. It implements the key schedule from that particular cipher. It goes beyond normal salting and hashing after that by creating an adaptive hashing algorithm that is slow. It is good to be slow, because it causes an attacker to be unable to perform as many operations, increasing the time it takes to subsequently crack a password by orders of magnitude.</p>
<p class="indent">The essential implementation in this Node.js module requires only creating a salt, and then passing that to a hashing function, giving you a hashed password.</p>
<p class="noindent2"><b><i>Listing 6-22</i></b>.&nbsp;&nbsp;Generating a Salt and Hash with bcrypt</p>
<pre><span class="FontName1">bcrypt.genSalt(10, function(err, salt) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">bcrypt.hash(req.body.pwd, salt, function(err, hash) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//store password</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span></pre>
<p class="indent">The <span class="FontName1">genSalt</span> function accepts a number of rounds (which defaults to 10), a seed length (defaults to 20), and a callback, which is required. The callback will provide an error if one occurs, as well as the salt value. From this salt you should create the hash, using the <span class="FontName1">bcrypt.hash</span> function. This takes the plaintext password you wish to encrypt, the salt, and a callback. The callback will produce the hash of the password, which you can then store in your data store.</p>
<p class="indent">To decrypt a password at login and compare it to the values in your data store, you can call the <span class="FontName1">bcrypt.compare</span> method. This accepts the password to validate as a first argument, then the hashed value from your database. This will return a result which is a boolean value—true if it matches, false if not.</p>
<p class="indent">In the second part of the solution you saw how to implement Mozilla Persona for user authentication. This was by using ‘express-persona’, which fits into an Express.js application. There are other implementations of Mozilla Persona, including persona-id, which is not tied to a particular framework, or you could roll your own implementation.</p>
<p class="indent">You see that in your solution, you require the module and then pass to it your express.js application and an object. This object contains the target audience, which is the URL of your application. It also contains a verifyResponse function that will generate a route on success or failure of verification, allowing you the opportunity to store the user information in your database. The complement to this Node.js implementation is the client side.</p>
<p class="indent">For the client to communicate with the server, you need to include the login.persona.org/include.js script in your source. You then need to register events for <span class="FontName1">navigator.id.login()</span> and <span class="FontName1">logout</span>() events.</p>
<p class="noindent2"><b><i>Listing 6-23</i></b>.&nbsp;&nbsp;Binding to a Persona Login and Logout</p>
<pre><span class="FontName1">document.querySelector("#login").addEventListener("click", function() {</span><br>&nbsp;&nbsp;<span class="FontName1">navigator.id.request();</span><br><span class="FontName1">}, false);</span><br>&nbsp;<br><span class="FontName1">document.querySelector("#logout").addEventListener("click", function() {</span><br>&nbsp;&nbsp;<span class="FontName1">navigator.id.logout();</span><br><span class="FontName1">}, false);</span></pre>
<p class="indent">Persona also needs you to implement a watch function that will listen for these events. When one is detected, it will send an XMLHttpRequest to the /persona/verify or /persona/logout routes in your Express.js application.</p>
<p class="noindent2"><b><i>Listing 6-24</i></b>.&nbsp;&nbsp;Persona Navigator watch Method</p>
<pre><span class="FontName1">navigator.id.watch({</span><br>&nbsp;&nbsp;<span class="FontName1">onlogin: function(assertion) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var xhr = new XMLHttpRequest();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">xhr.open("POST", "/persona/verify", true);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">xhr.setRequestHeader("Content-Type", "application/json");</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">xhr.addEventListener("loadend", function(e) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var data = JSON.parse(this.responseText);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (data &amp;&amp; data.status === "okay") {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log("You have been logged in as: " + data.email);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}, false);</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">xhr.send(JSON.stringify({</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">assertion: assertion</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}));</span><br>&nbsp;&nbsp;<span class="FontName1">},</span><br>&nbsp;&nbsp;<span class="FontName1">onlogout: function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var xhr = new XMLHttpRequest();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">xhr.open("POST", "/persona/logout", true);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">xhr.addEventListener("loadend", function(e) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log("You have been logged out");</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">xhr.send();</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">});</span></pre>
<p class="indent">As mentioned above, there are many third-party modules for user identification. These should all be implemented with scrutiny to ensure that you are properly securing your user’s login credentials. You can, of course, roll your own implementation of the security principles involved in any of these modules.</p>
</div>
<div>
<p id="Sec50" class="Heading2">Summary</p>
<p class="noindent">Node.js is fully capable of creating applications that are just as secure as any other framework. The crypto module, which is a wrapping of the OpenSSL hashes, ciphers, and encryption capabilities, provides top-tier support for generating secure hashes and ciphertexts and for keeping your data safe.</p>
<p class="indent">Node.js also presents a framework for keeping server communication secure with the TLS module. This allows you to create safe connections between a client and server, as well as encrypting your HTTP traffic over HTTPS.</p>
<p class="indent">You also saw how it is possible to build a user authentication module to store user credentials in a more secure way. And, lastly, you saw how to build on existing frameworks to create a secure method for authentication via third-party modules.</p>
<p class="indent">Securing applications is not a trivial task, and it takes time and research to get the right solution and implementation. You also need to remain current and mindful of changes to best practices, how they affect your application, and how you can strengthen your security mechanisms through Node.js crypto modules.</p>
</div>
</div>
<div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#">Add Highlight</a></li>
		<li class="add-note"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#">
			
				Add Note
			
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch05.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">CHAPTER 5: Using Events and Child Processes</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch07.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">CHAPTER 7: Discovering Other Node.js Modules</div>
        </a>
    
  
  </div>


        
    </section>
    <div class="reading-controls-bottom">
      <ul class="interface-controls js-bitlist">
        <li class="queue-control">
            <button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781430260585/chapter/9781430260585_Ch06.xhtml" data-for-analytics="9781430260585:9781430260585_Ch06.xhtml">
      <span>Add to Queue</span>
  </button>
        </li>
      </ul>
    </div>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  





    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel  collapsed slideUp">
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" class="js-toggle-nag ss-navigateup" title="Toggle open or close footer"></a>
        <div class="sample-message">
          <p class="usage-data t-collapsed-text">Enjoy Safari?
            <a class="ga-active-trial-subscribe-nag" href="https://www.safaribooksonline.com/subscribe/">
              Subscribe Today
              
            </a>
          </p>
          

        <div class="expanded">
          <h2>You have 10 days left in your trial, Raviguru0007. </h2>
          <p class="t-expanded-text">Safari is your trusted guide for building a remarkable career. We hope you've been enjoying your trial—ready to join?</p>
          <a href="https://www.safaribooksonline.com/subscribe/" class="button-primary">
            Subscribe Today
            
          </a>
          
          <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" class="icon-up" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/contact/">Contact Us</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
    </ul>
    <span class="copyright">© 2017 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/membership-agreement/">Membership Agreement</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>

        </div>
      </div>
    </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" class="icon-up" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li><a class="t-queue-footer" href="https://www.safaribooksonline.com/s/">Queue</a></li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2017 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"licenseKey":"510f1a6865","applicationID":"3275661","errorBeacon":"bam.nr-data.net","transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","beacon":"bam.nr-data.net","applicationTime":833,"queueTime":0,"agent":""}</script>


    

    <script src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/saved_resource" charset="utf-8"></script>
    <script src="./CHAPTER 6_ Implementing Security and Cryptography - Node.js Recipes_ A Problem-Solution Approach_files/saved_resource(1)" charset="utf-8"></script>
  

<div class="annotator-notice">Sorry we could not read the annotations from the store</div><div class="font-flyout" style="top: 200.013px; left: 1217px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch06.xhtml#">Reset</a>
</div>
</div></body></html>