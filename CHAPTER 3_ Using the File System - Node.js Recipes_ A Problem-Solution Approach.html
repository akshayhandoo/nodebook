<!DOCTYPE html>
<!-- saved from url=(0102)https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" "="" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="1573407" data-user-uuid="29525685-85c9-45c7-9eda-3c178d86398e" data-username="raviguru0007" data-account-type="Trial" data-activated-trial-date="04/17/2017" data-archive="9781430260585" data-publishers="Apress" data-htmlfile-name="9781430260585_Ch03.xhtml" data-epub-title="Node.js Recipes: A Problem-Solution Approach" data-debug="0" data-testing="0"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781430260585"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><script type="text/javascript" src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/510f1a6865"></script><script src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/nr-spa-1026.min.js"></script><script type="text/javascript" async="" src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/linkid.js"></script><script async="" src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/analytics.js"></script><script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={xpid:"VQQDUVVVGwACU1RUAQA="};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(t){try{c.console&&console.log(t)}catch(e){}}var o,i=t("ee"),a=t(19),c={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(c.console=!0,o.indexOf("dev")!==-1&&(c.dev=!0),o.indexOf("nr_dev")!==-1&&(c.nrDev=!0))}catch(s){}c.nrDev&&i.on("internal-error",function(t){r(t.stack)}),c.dev&&i.on("fn-err",function(t,e,n){r(n.stack)}),c.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(c,function(t,e){return t}).join(", ")))},{}],2:[function(t,e,n){function r(t,e,n,r,o){try{d?d-=1:i("err",[o||new UncaughtException(t,e,n)])}catch(c){try{i("ierr",[c,s.now(),!0])}catch(u){}}return"function"==typeof f&&f.apply(this,a(arguments))}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function o(t){i("err",[t,s.now()])}var i=t("handle"),a=t(20),c=t("ee"),s=t("loader"),f=window.onerror,u=!1,d=0;s.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(p){"stack"in p&&(t(12),t(11),"addEventListener"in window&&t(6),s.xhrWrappable&&t(13),u=!0)}c.on("fn-start",function(t,e,n){u&&(d+=1)}),c.on("fn-err",function(t,e,n){u&&(this.thrown=!0,o(n))}),c.on("fn-end",function(){u&&!this.thrown&&d>0&&(d-=1)}),c.on("internal-error",function(t){i("ierr",[t,s.now(),!0])})},{}],3:[function(t,e,n){t("loader").features.ins=!0},{}],4:[function(t,e,n){function r(){C++,N=y.hash,this[u]=M.now()}function o(){C--,y.hash!==N&&i(0,!0);var t=M.now();this[l]=~~this[l]+t-this[u],this[d]=t}function i(t,e){x.emit("newURL",[""+y,e])}function a(t,e){t.on(e,function(){this[e]=M.now()})}var c="-start",s="-end",f="-body",u="fn"+c,d="fn"+s,p="cb"+c,h="cb"+s,l="jsTime",m="fetch",v="addEventListener",w=window,y=w.location;if(w[v]){var b=t(9),g=t(10),x=t(8),E=t(6),O=t(12),R=t(7),P=t(13),T=t("ee"),S=T.get("tracer");t(14);var M=t("loader");M.features.spa=!0;var N,j=w[v],C=0;T.on(u,r),T.on(p,r),T.on(d,o),T.on(h,o),T.buffer([u,d,"xhr-done","xhr-resolved"]),E.buffer([u]),O.buffer(["setTimeout"+s,"clearTimeout"+c,u]),P.buffer([u,"new-xhr","send-xhr"+c]),R.buffer([m+c,m+"-done",m+f+c,m+f+s]),x.buffer(["newURL"]),b.buffer([u]),g.buffer(["propagate",p,h,"executor-err","resolve"+c]),S.buffer([u,"no-"+u]),a(P,"send-xhr"+c),a(T,"xhr-resolved"),a(T,"xhr-done"),a(R,m+c),a(R,m+"-done"),x.on("pushState-end",i),x.on("replaceState-end",i),j("hashchange",i,!0),j("load",i,!0),j("popstate",function(){i(0,C>1)},!0)}},{}],5:[function(t,e,n){function r(t){}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(12),c=t(11),s="learResourceTimings",f="addEventListener",u="resourcetimingbufferfull",d="bstResource",p="resource",h="-start",l="-end",m="fn"+h,v="fn"+l,w="bstTimer",y="pushState",b=t("loader");b.features.stn=!0,t(8);var g=NREUM.o.EV;o.on(m,function(t,e){var n=t[0];n instanceof g&&(this.bstStart=b.now())}),o.on(v,function(t,e){var n=t[0];n instanceof g&&i("bst",[n,e,this.bstStart,b.now()])}),a.on(m,function(t,e,n){this.bstStart=b.now(),this.bstType=n}),a.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),this.bstType])}),c.on(m,function(){this.bstStart=b.now()}),c.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),"requestAnimationFrame"])}),o.on(y+h,function(t){this.time=b.now(),this.startPath=location.pathname+location.hash}),o.on(y+l,function(t){i("bstHist",[location.pathname+location.hash,this.startPath,this.time])}),f in window.performance&&(window.performance["c"+s]?window.performance[f](u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["c"+s]()},!1):window.performance[f]("webkit"+u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["webkitC"+s]()},!1)),document[f]("scroll",r,{passive:!0}),document[f]("keypress",r,!1),document[f]("click",r,!1)}},{}],6:[function(t,e,n){function r(t){for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)}function o(t){c.inPlace(t,[u,d],"-",i)}function i(t,e){return t[1]}var a=t("ee").get("events"),c=t(22)(a,!0),s=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){var n=t[1],r=s(n,"nr@wrapped",function(){function t(){if("function"==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)}var e={object:t,"function":n}[typeof n];return e?c(e,"fn-",null,e.name||"anonymous"):n});this.wrapped=t[1]=r}),a.on(d+"-start",function(t){t[1]=this.wrapped||t[1]})},{}],7:[function(t,e,n){function r(t,e,n){var r=t[e];"function"==typeof r&&(t[e]=function(){var t=r.apply(this,arguments);return o.emit(n+"start",arguments,t),t.then(function(e){return o.emit(n+"end",[null,e],t),e},function(e){throw o.emit(n+"end",[e],t),e})})}var o=t("ee").get("fetch"),i=t(19);e.exports=o;var a=window,c="fetch-",s=c+"body-",f=["arrayBuffer","blob","json","text","formData"],u=a.Request,d=a.Response,p=a.fetch,h="prototype";u&&d&&p&&(i(f,function(t,e){r(u[h],e,s),r(d[h],e,s)}),r(a,"fetch",c),o.on(c+"end",function(t,e){var n=this;e?e.clone().arrayBuffer().then(function(t){n.rxSize=t.byteLength,o.emit(c+"done",[null,e],n)}):o.emit(c+"done",[t],n)}))},{}],8:[function(t,e,n){var r=t("ee").get("history"),o=t(22)(r);e.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")},{}],9:[function(t,e,n){var r=t("ee").get("mutation"),o=t(22)(r),i=NREUM.o.MO;e.exports=r,i&&(window.MutationObserver=function(t){return this instanceof i?new i(o(t,"fn-")):i.apply(this,arguments)},MutationObserver.prototype=i.prototype)},{}],10:[function(t,e,n){function r(t){var e=a.context(),n=c(t,"executor-",e),r=new f(n);return a.context(r).getCtx=function(){return e},a.emit("new-promise",[r,e],e),r}function o(t,e){return e}var i=t(22),a=t("ee").get("promise"),c=i(a),s=t(19),f=NREUM.o.PR;e.exports=a,f&&(window.Promise=r,["all","race"].forEach(function(t){var e=f[t];f[t]=function(n){function r(t){return function(){a.emit("propagate",[null,!o],i),o=o||!t}}var o=!1;s(n,function(e,n){Promise.resolve(n).then(r("all"===t),r(!1))});var i=e.apply(f,arguments),c=f.resolve(i);return c}}),["resolve","reject"].forEach(function(t){var e=f[t];f[t]=function(t){var n=e.apply(f,arguments);return t!==n&&a.emit("propagate",[t,!0],n),n}}),f.prototype["catch"]=function(t){return this.then(null,t)},f.prototype=Object.create(f.prototype,{constructor:{value:r}}),s(Object.getOwnPropertyNames(f),function(t,e){try{r[e]=f[e]}catch(n){}}),a.on("executor-start",function(t){t[0]=c(t[0],"resolve-",this),t[1]=c(t[1],"resolve-",this)}),a.on("executor-err",function(t,e,n){t[1](n)}),c.inPlace(f.prototype,["then"],"then-",o),a.on("then-start",function(t,e){this.promise=e,t[0]=c(t[0],"cb-",this),t[1]=c(t[1],"cb-",this)}),a.on("then-end",function(t,e,n){this.nextPromise=n;var r=this.promise;a.emit("propagate",[r,!0],n)}),a.on("cb-end",function(t,e,n){a.emit("propagate",[n,!0],this.nextPromise)}),a.on("propagate",function(t,e,n){this.getCtx&&!e||(this.getCtx=function(){if(t instanceof Promise)var e=a.context(t);return e&&e.getCtx?e.getCtx():this})}),r.toString=function(){return""+f})},{}],11:[function(t,e,n){var r=t("ee").get("raf"),o=t(22)(r),i="equestAnimationFrame";e.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],12:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],"fn-",null,n)}function o(t,e,n){this.method=n,this.timerDuration="number"==typeof t[1]?t[1]:0,t[0]=a(t[0],"fn-",this,n)}var i=t("ee").get("timer"),a=t(22)(i),c="setTimeout",s="setInterval",f="clearTimeout",u="-start",d="-";e.exports=i,a.inPlace(window,[c,"setImmediate"],c+d),a.inPlace(window,[s],s+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(s+u,r),i.on(c+u,o)},{}],13:[function(t,e,n){function r(t,e){d.inPlace(e,["onreadystatechange"],"fn-",c)}function o(){var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,v,"fn-",c)}function i(t){w.push(t),l&&(b=-b,g.data=b)}function a(){for(var t=0;t<w.length;t++)r([],w[t]);w.length&&(w=[])}function c(t,e){return e}function s(t,e){for(var n in t)e[n]=t[n];return e}t(6);var f=t("ee"),u=f.get("xhr"),d=t(22)(u),p=NREUM.o,h=p.XHR,l=p.MO,m="readystatechange",v=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],w=[];e.exports=u;var y=window.XMLHttpRequest=function(t){var e=new h(t);try{u.emit("new-xhr",[e],e),e.addEventListener(m,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e};if(s(h,y),y.prototype=h.prototype,d.inPlace(y.prototype,["open","send"],"-xhr-",c),u.on("send-xhr-start",function(t,e){r(t,e),i(e)}),u.on("open-xhr-start",r),l){var b=1,g=document.createTextNode(b);new l(a).observe(g,{characterData:!0})}else f.on("fn-end",function(t){t[0]&&t[0].type===m||a()})},{}],14:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=a.now()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var s=t.getResponseHeader("X-NewRelic-App-Data");s&&(e.cat=s.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return l(r)}function i(t,e){var n=s(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var a=t("loader");if(a.xhrWrappable){var c=t("handle"),s=t(15),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,p=t("id"),h=t(18),l=t(17),m=window.XMLHttpRequest;a.features.xhr=!0,t(13),f.on("new-xhr",function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,h&&(h>34||h<10)||window.opera||t.addEventListener("progress",function(t){e.lastSize=t.loaded},!1)}),f.on("open-xhr-start",function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),f.on("send-xhr-start",function(t,e){var n=this.metrics,r=t[0],o=this;if(n&&r){var i=l(r);i&&(n.txSize=i)}this.startTime=a.now(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{f.emit("internal-error",[n])}catch(r){}}};for(var c=0;c<d;c++)e.addEventListener(u[c],this.listener,!1)}),f.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),f.on("xhr-load-added",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),f.on("xhr-load-removed",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),f.on("addEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],e)}),f.on("removeEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],e)}),f.on("fn-start",function(t,e,n){e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=a.now()))}),f.on("fn-end",function(t,e){this.xhrCbStart&&f.emit("xhr-cb-time",[a.now()-this.xhrCbStart,this.onload,e],e)})}},{}],15:[function(t,e,n){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r}},{}],16:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[f.now()].concat(c(arguments)),e?null:this,n),e?void 0:this}}var i=t("handle"),a=t(19),c=t(20),s=t("ee").get("tracer"),f=t("loader"),u=NREUM;"undefined"==typeof window.newrelic&&(newrelic=u);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],p="api-",h=p+"ixn-";a(d,function(t,e){u[e]=o(p+e,!0,"api")}),u.addPageAction=o(p+"addPageAction",!0),u.setCurrentRouteName=o(p+"routeName",!0),e.exports=newrelic,u.interaction=function(){return(new r).get()};var l=r.prototype={createTracer:function(t,e){var n={},r=this,o="function"==typeof e;return i(h+"tracer",[f.now(),t,n],r),function(){if(s.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return e.apply(this,arguments)}finally{s.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){l[e]=o(h+e)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,f.now()])}},{}],17:[function(t,e,n){e.exports=function(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}}},{}],18:[function(t,e,n){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),e.exports=r},{}],19:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],20:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],21:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],22:[function(t,e,n){function r(t){return!(t&&t instanceof Function&&t.apply&&!t[a])}var o=t("ee"),i=t(20),a="nr@original",c=Object.prototype.hasOwnProperty,s=!1;e.exports=function(t,e){function n(t,e,n,o){function nrWrapper(){var r,a,c,s;try{a=this,r=i(arguments),c="function"==typeof n?n(r,a):n||{}}catch(f){p([f,"",[r,a,o],c])}u(e+"start",[r,a,o],c);try{return s=t.apply(a,r)}catch(d){throw u(e+"err",[r,a,d],c),d}finally{u(e+"end",[r,a,s],c)}}return r(t)?t:(e||(e=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)}function f(t,e,o,i){o||(o="");var a,c,s,f="-"===o.charAt(0);for(s=0;s<e.length;s++)c=e[s],a=t[c],r(a)||(t[c]=n(a,f?c+o:o,i,c))}function u(n,r,o){if(!s||e){var i=s;s=!0;try{t.emit(n,r,o,e)}catch(a){p([a,n,r,o])}s=i}}function d(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){p([r])}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return e}function p(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=o),n.inPlace=f,n.flag=a,n}},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?s(t,c,i):i()}function n(n,r,o,i){if(!p.aborted||i){t&&t(n,r,o);for(var a=e(o),c=l(n),s=c.length,f=0;f<s;f++)c[f].apply(a,r);var d=u[y[n]];return d&&d.push([b,n,r,a]),a}}function h(t,e){w[t]=l(t).concat(e)}function l(t){return w[t]||[]}function m(t){return d[t]=d[t]||o(n)}function v(t,e){f(t,function(t,n){e=e||"feature",y[n]=e,e in u||(u[e]=[])})}var w={},y={},b={on:h,emit:n,get:m,listeners:l,context:e,buffer:v,abort:a,aborted:!1};return b}function i(){return new r}function a(){(u.api||u.feature)&&(p.aborted=!0,u=p.backlog={})}var c="nr@context",s=t("gos"),f=t(19),u={},d={},p=e.exports=o();p.backlog=u},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!x++){var t=g.info=NREUM.info,e=p.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(y,function(e,n){t[e]||(t[e]=n)}),s("mark",["onload",a()+g.offset],null,"api");var n=p.createElement("script");n.src="https://"+t.agent,e.parentNode.insertBefore(n,e)}}function o(){"complete"===p.readyState&&i()}function i(){s("mark",["domContent",a()+g.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(c=Math.max((new Date).getTime(),c))-g.offset}var c=(new Date).getTime(),s=t("handle"),f=t(19),u=t("ee"),d=window,p=d.document,h="addEventListener",l="attachEvent",m=d.XMLHttpRequest,v=m&&m.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:m,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var w=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-spa-1026.min.js"},b=m&&v&&v[h]&&!/CriOS/.test(navigator.userAgent),g=e.exports={offset:c,now:a,origin:w,features:{},xhrWrappable:b};t(16),p[h]?(p[h]("DOMContentLoaded",i,!1),d[h]("load",r,!1)):(p[l]("onreadystatechange",o),d[l]("onload",r)),s("mark",["firstbyte",c],null,"api");var x=0,E=t(21)},{}]},{},["loader",2,14,5,3,4]);</script><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.8cc2fd27400e.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/css" rel="stylesheet" type="text/css"><title>CHAPTER 3: Using the File System - Node.js Recipes: A Problem-Solution Approach</title><link rel="stylesheet" href="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/74741d96e0ae.css" type="text/css"><link rel="stylesheet" type="text/css" href="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/annotator.e34eec1a0d5a.css"><link rel="stylesheet" href="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/font-awesome.min.css"><style type="text/css" title="ibis-book">
    #sbo-rt-content div{margin:1em 1em 1em 1em}#sbo-rt-content a{text-decoration:none}#sbo-rt-content img{max-width:100%;margin-top:10pt}#sbo-rt-content p.booktitle{font-weight:bold;font-size:2.5em;margin-top:2em;margin-bottom:8em;text-align:center}#sbo-rt-content p.bookauthor{font-weight:bold;font-size:1.7em;margin-top:0;margin-right:2em;margin-bottom:0;text-align:left}#sbo-rt-content p.booksubtitle{font-weight:bold;font-size:1.7em;margin-top:0;margin-bottom:7em;text-align:center;color:#8A8A8A}#sbo-rt-content .bookimage{font-size:1.2em;margin-top:0;margin-bottom:1em;text-align:left}#sbo-rt-content .fmpara{font-size:.9em;text-indent:0;margin-top:.5em;margin-bottom:.3em;text-align:justify}#sbo-rt-content .fmpara1{font-size:.9em;text-indent:0;margin-top:.4em;margin-bottom:.3em;text-align:right}#sbo-rt-content .inpara{text-indent:0;margin-top:.4em;margin-left:3em;margin-bottom:.3em}#sbo-rt-content .pub{margin-top:10em;margin-bottom:1em;text-align:right;margin-right:5em}#sbo-rt-content .copyright{font-size:.9em;margin-top:.4em;margin-bottom:.4em;margin-left:1.2em;margin-right:1.2em;text-align:left}#sbo-rt-content .copyright1{font-size:.9em;margin-top:.1em;margin-bottom:.1em;margin-left:4em;margin-right:3.3em;text-align:left;text-indent:-1.6em}#sbo-rt-content .copyright2{font-size:.9em;margin-top:.1em;margin-bottom:.1em;margin-left:4.2em}#sbo-rt-content .dedication{font-size:1.2em;margin-bottom:0;margin-top:3.5em;text-align:center;margin-right:1em;font-style:italic}#sbo-rt-content .dedication1{font-size:1.2em;margin-bottom:0;margin-top:.5em;text-align:center;margin-right:1em;font-style:normal}#sbo-rt-content .dedication2{font-size:1.2em;margin-bottom:0;margin-top:1.5em;text-align:center;margin-right:1em;font-style:italic}#sbo-rt-content .content-title{font-size:1.6em;margin-top:3em;margin-bottom:.1em;text-align:left;font-weight:bold}#sbo-rt-content .fmtitle{font-size:2.5em;margin-top:1em;margin-bottom:1em;text-align:left;font-weight:bold;border-bottom:1.1px solid black;padding-bottom:.8em}#sbo-rt-content .right{text-indent:0;margin-top:1em;margin-right:1.5em;margin-bottom:.3em;text-align:right}#sbo-rt-content .right1{text-indent:0;margin-top:0;margin-right:1.5em;margin-bottom:.2em;text-align:right}#sbo-rt-content .chapimage{margin-left:.2em;margin-top:1.5em;margin-bottom:1.5em;text-align:left}#sbo-rt-content p.ChapterNumber{font-weight:bold;font-size:1.7em;margin-top:10px;margin-left:0;margin-bottom:5px;text-align:left}#sbo-rt-content p.ChapterTitle{font-weight:bold;font-size:2.5em;margin-top:0;margin-bottom:1em;margin-left:0;text-align:left;border-bottom:1.1px solid black;padding-bottom:.8em}#sbo-rt-content p.PartNumber{font-weight:bold;font-size:1.7em;margin-top:10px;margin-left:0;margin-bottom:5px;text-align:left;padding-bottom:.8em}#sbo-rt-content p.partTitle{font-weight:bold;font-size:2.5em;margin-top:1em;margin-bottom:1em;margin-left:0;text-align:left}#sbo-rt-content .paraaftertitle{font-size:100%;text-indent:0;margin-top:0;margin-left:0;margin-bottom:0}#sbo-rt-content p.noindent{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:0;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.noindent1{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:1em}#sbo-rt-content p.noindent2{font-size:100%;text-indent:0;margin-top:1.5em;margin-bottom:1em}#sbo-rt-content p.noindent3{font-size:100%;text-indent:0;margin-top:.8em;margin-bottom:.2em;margin-left:0;margin-right:0;text-align:center}#sbo-rt-content p.noindent4{font-size:100%;text-indent:0;margin-top:.8em;margin-bottom:.2em;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content span.listing{font-weight:bold}#sbo-rt-content p.indent{font-size:100%;text-indent:1.2em;margin-top:.1em;margin-bottom:.1em;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.indent1{font-size:100%;text-indent:1.2em;margin-top:0;margin-bottom:0;margin-left:0;margin-right:0;text-align:left}#sbo-rt-content p.indent1a{font-size:100%;text-indent:1.5em;margin-top:0;margin-bottom:0;margin-left:0;margin-right:4.5em;text-align:right}#sbo-rt-content p.indent2{font-size:100%;margin-top:.8em;margin-bottom:.8em;margin-left:2.4em;margin-right:2.4em;text-align:justify;font-style:italic}#sbo-rt-content p.indent3{font-size:100%;text-indent:1em;margin-top:.8em;margin-bottom:.8em;margin-left:1.8em;margin-right:1.8em;text-align:left}#sbo-rt-content p.indent4{font-size:100%;text-indent:1.3em;margin-top:.5em;margin-bottom:.5em;margin-left:2em;margin-right:0;text-align:left}#sbo-rt-content .blockquote{font-size:100%;text-indent:.2em;margin-top:1em;margin-left:3em;margin-right:2em;margin-bottom:1em;font-style:italic}#sbo-rt-content .blockquote1{font-size:100%;text-indent:.2em;margin-top:1em;margin-left:3em;margin-bottom:0;font-style:italic}#sbo-rt-content p.Heading1{font-weight:bold;font-size:2em;text-indent:0;margin-top:1.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2{font-size:1.6em;text-indent:0;margin-top:1.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2_2{font-size:1.6em;text-indent:0;margin-top:.3em;margin-bottom:.3em}#sbo-rt-content p.Heading2a{font-size:1.5em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;font-weight:bold}#sbo-rt-content p.Heading3{font-weight:bold;font-size:1.45em;text-indent:0;margin-top:1.2em;margin-bottom:.1em}#sbo-rt-content p.Heading3a{font-weight:normal;font-size:1.25em;text-indent:0;margin-top:1.2em;margin-bottom:.1em}#sbo-rt-content p.Heading4{font-size:1.3em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;text-align:left}#sbo-rt-content .img{max-width:100%;margin-top:10pt}#sbo-rt-content .img1{text-align:left}#sbo-rt-content .img1a{text-align:right;margin-right:5em;margin-top:5em}#sbo-rt-content .img2{text-align:left}#sbo-rt-content div.Figure{font-size:small;margin-top:1.5em;margin-bottom:1.5em}#sbo-rt-content .para-1{font-size:100%;margin-top:1em;text-indent:1.5em;margin-bottom:0;text-align:left}#sbo-rt-content .para-2{font-size:.9em;text-indent:-1.4em;margin-left:2.4em;margin-top:.5em;margin-bottom:0}#sbo-rt-content .figurecaption{font-size:small;margin-top:0;margin-bottom:0;text-align:justify}#sbo-rt-content .image{text-align:center}#sbo-rt-content .codecaption{font-size:100%;margin-top:.6em;margin-bottom:.6em;text-align:justify;font-style:italic}#sbo-rt-content .PCode{font-size:small;margin-top:1em;margin-bottom:1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-1{font-size:small;margin-top:1em;margin-bottom:.1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-2{font-size:small;margin-top:0;margin-bottom:0;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode-3{font-size:small;margin-top:0;margin-bottom:1em;margin-left:0;text-align:left;font-family:monospace}#sbo-rt-content div.singlethin{border-bottom:solid 3px;margin-left:1em;margin-right:1em;margin-bottom:1em}#sbo-rt-content div.singlethin1{margin-left:2em;margin-right:2em}#sbo-rt-content .inlinecode{font-family:monospace}#sbo-rt-content div.notepara{font-size:110%;text-indent:0;margin-top:1em;border-top:solid 1px;border-bottom:solid 1px;margin-bottom:1em;text-align:justify}#sbo-rt-content span.pink-box{font-weight:bold;padding-left:1.3em;padding-right:1.3em;border:1.1px solid black;font-size:1.5em;margin-top:.5em;margin-bottom:.5em;text-indent:0;text-align:justify}#sbo-rt-content span.courier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%}#sbo-rt-content div.courier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%;margin-top:1em;margin-bottom:1em}#sbo-rt-content div.boxcourier{font-family:Courier New;font-weight:normal;font-style:normal;font-size:100%;margin-top:1em;margin-bottom:1em;margin-left:1.5em;margin-right:1.5em;text-align:left}#sbo-rt-content span.courier1{font-family:Courier New;font-weight:normal;font-style:normal;font-size:95%}#sbo-rt-content .boxhead{font-size:1.25em;font-weight:bold;padding-left:.1em;padding-bottom:.1em;padding-top:.1em;margin-top:0;text-indent:0;text-align:center;border:3px solid black}#sbo-rt-content div.box{margin-top:1em;margin-bottom:1em}#sbo-rt-content .boxpara{font-size:110%;text-indent:0;margin-left:1.5em;margin-right:1.5em;margin-top:.5em;margin-bottom:.5em;text-align:left}#sbo-rt-content .alpha{font-size:1.2em;font-weight:bold;margin-left:.2em;margin-top:1em;margin-bottom:.3em;text-align:left}#sbo-rt-content .index{font-size:small;margin-left:.2em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .index1{font-size:small;margin-left:1em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .index2{font-size:small;margin-left:2em;margin-top:0;margin-bottom:0;text-align:left}#sbo-rt-content .cover{text-align:center}#sbo-rt-content .top{border-top:1.1px solid black;border-bottom:2px solid black}#sbo-rt-content .bot{border-bottom:2px solid black}#sbo-rt-content table.bodytable,#sbo-rt-content table{border-collapse:collapse;margin-bottom:8px;font-size:small;margin-top:10pt;width:95%;border-top:0 solid black;border-bottom:0 solid black}#sbo-rt-content table.fmtable{margin-bottom:1em;font-size:1em;margin-left:4em;border-top:0 solid #FFF;border-bottom:0 solid #FFF}#sbo-rt-content table{margin-bottom:1em;border-top:1.1px solid black;border-bottom:1.1px solid black;border-collapse:collapse}#sbo-rt-content th{border-top:1px solid black;border-bottom:1px solid black;padding-right:1.5em}#sbo-rt-content td{font-size:small;vertical-align:top;padding-right:1.5em;margin-top:0;margin-bottom:1em}#sbo-rt-content .tablepara{font-size:small;text-indent:0;margin-top:0;margin-bottom:.5em;padding-right:1.5em}#sbo-rt-content .tablepara1{font-size:small;margin-left:2em;margin-top:0;margin-bottom:0;padding-right:1.5em}#sbo-rt-content .header{border-bottom:1.1px solid black;text-indent:0;text-align:left}#sbo-rt-content .TabCapt{font-style:italic;margin-left:0;text-indent:0}#sbo-rt-content .FigCapt{font-style:italic;font-size:.9em}#sbo-rt-content .CaptNr{font-weight:bold}#sbo-rt-content .ttitle{font-style:Italic;margin-bottom:1em}#sbo-rt-content p.paraaftertitle1{font-size:.9em;text-indent:0;margin-top:.5em;margin-bottom:.8em;text-align:left}#sbo-rt-content p.para{font-size:small;text-indent:20px;margin-top:0;margin-bottom:0;text-align:justify}#sbo-rt-content p.quote{font-style:italic;font-size:100%;margin-top:1.5em;margin-left:2.5em;margin-right:2.5em;margin-bottom:0}#sbo-rt-content p.quotesource{font-size:small;text-indent:0;margin-top:1em;margin-bottom:1em;text-align:right}#sbo-rt-content p.chaptersubtitle{font-size:x-large;text-indent:0;margin-top:0;margin-left:0;margin-bottom:0;text-align:left}#sbo-rt-content p.line{margin-top:.3em;border-bottom:1px solid black}#sbo-rt-content p.line1{margin-top:.3em;margin-bottom:1.5em;border-bottom:1px solid black}#sbo-rt-content p.line2{margin-top:5em;margin-bottom:5em;border-bottom:1px solid black;text-align:center;margin-left:15em;margin-right:15em}#sbo-rt-content li{margin-bottom:.5em;margin-top:.5em}#sbo-rt-content p.alpha{font-size:1.2em;font-weight:bold;margin-left:.2em;margin-top:1em;margin-bottom:.3em;text-align:left}#sbo-rt-content ul.bulleted{font-size:100%;text-align:justify;margin-left:2.5em;margin-right:3em;margin-top:1em;margin-bottom:1em;text-indent:0}#sbo-rt-content ol.OrderedList{font-size:100%;text-align:left;margin-left:2.5em;margin-right:3em;margin-top:1em;margin-bottom:1em}#sbo-rt-content ul.bulleted1{font-size:100%;text-align:left;margin-left:1em;margin-right:5em;margin-top:1em;margin-bottom:1em;list-style-type:none}#sbo-rt-content ul.bulleted1_a{font-size:100%;text-align:justify;margin-left:0;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0;list-style-type:none}#sbo-rt-content ul.bulleted2{font-size:100%;text-align:justify;margin-left:2.3em;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0}#sbo-rt-content ul.bulleted4{font-size:100%;text-align:center;margin-left:1.3em;margin-right:5em;margin-top:1em;margin-bottom:1em;text-indent:0;list-style-type:none}#sbo-rt-content .numbered{font-size:small;text-align:justify;margin-left:2em;margin-right:2em;margin-top:.5em;margin-bottom:.5em;text-indent:1em}#sbo-rt-content .bulletedin{font-size:100%;text-align:justify;margin-left:4em;margin-right:4em;margin-top:.5em;margin-bottom:.5em}#sbo-rt-content ul.None{font-size:.9em;text-align:justify;margin-left:3em;margin-right:2em;margin-top:.5em;margin-bottom:.5em;list-style-type:none}#sbo-rt-content .Listing{font-size:small;margin-bottom:0}#sbo-rt-content .PCode1{font-size:small;margin-top:.7em;margin-bottom:0;text-align:left;font-family:monospace}#sbo-rt-content .PCode2{font-size:small;margin-top:1em;margin-bottom:.1em;margin-left:2.2em;text-align:left;font-family:monospace}#sbo-rt-content .PCode3{font-size:small;margin-top:0;margin-left:2.2em;margin-bottom:.1em;text-align:left;font-family:monospace}#sbo-rt-content .NoteCaption{font-size:small;margin-top:1.3em;margin-left:5em;margin-right:5em;border:1.1px solid black;padding:.5em;margin-bottom:1.3em}#sbo-rt-content .Table{font-size:100%;margin-bottom:1em;margin-left:0}#sbo-rt-content .toc{font-size:1.1em;margin-top:.2em;margin-bottom:.2em;text-align:left;font-weight:bold}#sbo-rt-content .toca{font-size:1.1em;margin-top:.8em;margin-bottom:.4em;text-align:left;font-weight:bold}#sbo-rt-content .toc1{font-size:1.1em;margin-top:.4em;margin-bottom:.3em;text-align:left;text-indent:1.4em;font-weight:normal}#sbo-rt-content .toc2{font-size:1.2em;margin-top:.4em;margin-bottom:.3em;text-align:left;font-weight:bold}#sbo-rt-content .toc3{font-size:.9em;margin-top:.4em;margin-bottom:.3em;text-align:left;text-indent:3.5em;font-weight:normal}#sbo-rt-content .toc4{font-size:1.1em;margin-top:.2em;margin-bottom:.5em;text-align:left;font-weight:bold}#sbo-rt-content .tocch{font-size:1.3em;margin-top:.7em;margin-bottom:.7em;text-align:left;font-weight:bold}#sbo-rt-content .noborder{margin-bottom:1em;border-top:0 solid #FFF;border-bottom:0 solid #FFF}#sbo-rt-content .authurright{text-align:right;margin-top:0;margin-bottom:0}#sbo-rt-content .FormalPara{font-size:small;margin-bottom:.7em}#sbo-rt-content .FontName1{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content span.FontName2{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content span.FontName3{font-size:100%;font-family:"Courier New",Courier,monospace}#sbo-rt-content .rightarrow{margin-top:0}#sbo-rt-content div.thinline{margin-top:1em;margin-bottom:1em;border-top:solid 4px #AFAFB0;border-bottom:solid 4px #AFAFB0}#sbo-rt-content span.line{text-decoration:underline}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content div.box{border-top:solid 2px;border-bottom:solid 2px}#sbo-rt-content .app{font-size:150%;margin-left:.8em}#sbo-rt-content .page{text-decoration:none;color:#000}#sbo-rt-content .cXXX{text-decoration:none;color:#000}#sbo-rt-content .textindent{margin-left:1.7em;margin-top:1em;margin-bottom:1em;font-size:100%}#sbo-rt-content .textindent1{margin-left:1.7em;margin-top:0;margin-bottom:0;font-size:100%}#sbo-rt-content .textindent2{margin-left:1.7em;margin-top:0;margin-bottom:0;font-size:100%;text-indent:1em}#sbo-rt-content p.FootNote{margin-top:.8em;margin-bottom:0;font-size:85%;text-indent:0;text-align:left;margin-left:1.1em;margin-right:1.1em}#sbo-rt-content pre{margin-left:0;font-family:monospace;white-space:pre-wrap}#sbo-rt-content p.Heading4a{font-size:1.15em;font-weight:bold;text-indent:1em;margin-top:1.3em;margin-bottom:.3em;border-top:3px solid #4d4d4c;border-left:solid 3px #4d4d4c;border-right:solid 3px #4d4d4c;border-bottom:solid 3px #4d4d4c;text-align:center}#sbo-rt-content p.noindent8{font-size:100%;text-indent:0;margin-top:1em;margin-bottom:1em;text-align:center;font-weight:bold;color:#8A8A8A}#sbo-rt-content .tocb{font-size:1.4em;margin-top:.5em;margin-bottom:.2em;text-align:left;font-weight:bold}#sbo-rt-content .part{font-weight:normal;font-size:1em;margin-bottom:5px;text-align:left;padding-left:1.3em;padding-bottom:10em;padding-right:1.3em;border:1.1px solid black}#sbo-rt-content p.Heading5{font-size:1em;text-indent:0;margin-top:1.3em;margin-bottom:.3em;text-align:center}#sbo-rt-content p.noindent5s{font-size:100%;text-indent:0;margin-top:.1em;margin-bottom:.1em;margin-left:0;margin-right:0;text-align:right}#sbo-rt-content span.strike{text-decoration:line-through}
    </style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781430260585/chapter/9781430260585_Ch03.xhtml",
          "book_id": "9781430260585",
          "chapter_uri": "9781430260585_Ch03.xhtml",
          "position": 0,
          "user_uuid": "29525685-85c9-45c7-9eda-3c178d86398e",
          "next_chapter_uri": "/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch04.xhtml"
        
      },
      title: "Node.js Recipes: A Problem\u002DSolution Approach",
      author_list: "Cory Gackenheimer",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false,
      show_ios_app_teaser: false
    };
    // ]]></script><script src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/modernizr.js"></script><script>
    
      
        

        

        
          
            window.PUBLIC_ANNOTATIONS = true;
          
        

      

      
        window.MOBILE_PUBLIC_ANNOTATIONS = false;
      

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

    
      window.PRIVACY_CONTROL_SWITCH = true;
    

    
      window.PUBLISHER_PAGES = true;
    

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "https://www.safaribooksonline.com/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://www.safaribooksonline.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml"><meta name="description" content="CHAPTER 3 Using the File System In many instances within an application, you will want to work with the file system. Node.js makes this straightforward by creating a wrapper ... "><meta property="og:title" content="CHAPTER 3: Using the File System"><meta itemprop="isPartOf" content="/library/view/nodejs-recipes-a/9781430260585/"><meta itemprop="name" content="CHAPTER 3: Using the File System"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781430260585/"><meta property="og:description" itemprop="description" content="CHAPTER 3 Using the File System In many instances within an application, you will want to work with the file system. Node.js makes this straightforward by creating a wrapper ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Apress"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781430260585"><meta property="og:book:author" itemprop="author" content="Cory Gackenheimer"><meta property="og:book:tag" itemprop="about" content="JavaScript"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript>&lt;meta http-equiv="refresh" content="0; url=/library/no-js/" /&gt;</noscript><script type="text/javascript">
  (function(i,s,o,g,r,a,m) {
    i['GoogleAnalyticsObject']=r;
    i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
    a=s.createElement(o),m=s.getElementsByTagName(o)[0];
    a.async=1;
    a.src=g;
    m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

  if (matches && matches.length === 2) {
    user_uuid = matches[1];
  }


  ga('create', 'UA-39299553-7', {'userId': '29525685-85c9-45c7-9eda-3c178d86398e' });


ga('set', 'dimension1', 'Trial');
ga('set', 'dimension6', user_uuid);


  ga('set', 'dimension2', '29525685-85c9-45c7-9eda-3c178d86398e');
  






  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
</script><script defer="" src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/vendor.34024413b1d4.js"></script><script defer="" src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/reader.a05323b190d3.js"></script><script async="" src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/MathJax.js"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts subscribe-panel library">

    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/s/" class="t-queue-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>
              
                Queue
              
            </span></a></li><li class="search"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"></path></g></svg><span>Offers &amp; Deals</span></a><ul class="flyout"><li><a href="https://www.safaribooksonline.com/oreilly-newsletters/" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/001o00000169U9HAAU/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://www.safaribooksonline.com/public/support" class="l1 no-icon">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a><span class="l2 t-nag-notification" id="nav-nag"><strong class="trial-green">10</strong> days left in your trial.
  
  

  
    
      

<a class="" href="https://www.safaribooksonline.com/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.safaribooksonline.com/public/support" class="l2">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Node.js Recipes: A Problem-Solution Approach
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781430260585/chapter/9781430260585_Ch03.xhtml" data-for-analytics="9781430260585:9781430260585_Ch03.xhtml" aria-label="Add to Queue"><span>Add to Queue</span></button></li><li class="js-font-control-panel font-control-activator"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml&amp;text=Node.js%20Recipes%3A%20A%20Problem-Solution%20Approach&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%20CHAPTER%203%3A%20Using%20the%20File%20System&amp;body=https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml%0D%0Afrom%20Node.js%20Recipes%3A%20A%20Problem-Solution%20Approach%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
        
        



 <!--[if lt IE 9]>
  
<![endif]-->



  <script defer="" src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/djangoMessagesPage.845b17d78025.js"></script>


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch02.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">CHAPTER 2: Networking with Node.js</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch04.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">CHAPTER 4: Building a Web Server</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content" style="transform: none;"><div class="annotator-wrapper"><p class="ChapterNumber"><a id="Chap_3"></a>CHAPTER 3</p>
<p class="chapimage"><img src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/frontdot.jpg" alt="image" width="82" height="25" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/frontdot.jpg"></p>
<p class="ChapterTitle">Using the File System</p>
<div>
<p class="noindent">In many instances within an application, you will want to work with the file system. Node.js makes this straightforward by creating a wrapper around standard file I/O operations that are present on the operating system. In Node.js these capabilities are centered around one of the Node.js native modules, fs. This chapter will provide examples of how to utilize the file-system module in your Node.js application. In this chapter you will learn how to perform these actions:<a id="cXXX.172"></a></p>
<ul class="bulleted">
<li>Retrieve directory structures</li>
<li>Navigate directories</li>
<li>Manipulate directory structures</li>
<li>Watch directories for modifications</li>
<li>Read and write files</li>
<li>Move and link files</li>
<li>Alter file permissions</li>
<li>Watch files for modifications</li>
</ul>
<div class="notepara">
<p class="paraaftertitle1"><img src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/sq.jpg" alt="image" width="12" height="12" data-mfp-src="/library/view/nodejs-recipes-a/9781430260585/images/sq.jpg">&nbsp;<b>Note</b>&nbsp;&nbsp;&nbsp;The file-system module contains many methods that not only are asynchronous but also have a synchronous counterpart. These synchronous methods<a id="cXXX.173"></a> are included in many of the solutions in the chapter to demonstrate how they can be utilized. It should be noted, however, that unless absolutely necessary the synchronous versions should be avoided as it is generally not best practice to utilize them. This is because the synchronous versions will block the entire process until they have completed, which will potentially wreak all manner of havoc on your application.</p></div>
<p id="Sec1" class="Heading1">3-1. Retrieving Directory Structures<a id="cXXX.51j"></a></p>
<div>
<p id="Sec2" class="Heading2_2">Problem</p>
<p class="noindent">You want to access the structure of a directory, or a set of directories, from within your Node.js application.</p>
</div>
<div>
<p id="Sec3" class="Heading2">Solution</p>
<p class="noindent">To get a grasp of the Node.js utilities for retrieving a directory structure, you must first require the file-system module by using <span class="FontName1">require('fs')</span><a id="cXXX.174"></a> in your code. You then want to get some information about the directory that you are targeting. Let us assume you want to print all the information pertaining to the current directory from your Node.js application. First, you can target the current directory, the directory from which the Node.js script is executed, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list1" id="_list1">Listing 3-1</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list1" id="list1">Listing 3-1</a></i></b>.&nbsp;&nbsp;Target the Current Directory for Node.js<a id="cXXX.175"></a></p>
<pre><span class="FontName1">var fs = require('fs');</span><br><span class="FontName1">var out;</span><br>&nbsp;<br><span class="FontName1">console.log(__dirname);</span><br><span class="FontName1">//read current directory asynchronously</span><br><span class="FontName1">fs.realpath(__dirname, function(err, /* [cache], */ path) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('realpath async: ' + path);</span><br><span class="FontName1">});</span><br><span class="FontName1">out = fs.realpathSync(__dirname);</span><br><span class="FontName1">console.log('real path sync: ' + out);</span><br>&nbsp;<br><span class="FontName1">fs.stat(__dirname, function(err, stat) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) return;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var isDir = false;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.readdir(__dirname, function(err, contents) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) return;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">contents.forEach(function(f) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('contents: ' + f);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">//get list of what’s in the directory</span><br><span class="FontName1">out = fs.readdirSync(__dirname);</span><br><span class="FontName1">console.log('readdir sync: ' + out);</span></pre>
<p class="indent">What results does this solution present? It produces a list, based in the current working directory, of what is contained within that directory. This list looks like what follows in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list2" id="_list2">Listing 3-2</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list2" id="list2">Listing 3-2</a></i></b>.&nbsp;&nbsp;Output from <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list1">Listing 3-1</a></p>
<pre><span class="FontName1">$ node 3-1-1.js</span><br><span class="FontName1">/home/cgack/Dropbox/book/code/Ch03</span><br><span class="FontName1">real path sync: /home/cgack/Dropbox/book/code/Ch03</span><br><span class="FontName1">readdir sync: 3-1-1.js,3-1-2.js</span><br><span class="FontName1">contents: 3-1-1.js</span><br><span class="FontName1">contents: 3-1-2.js</span><br><span class="FontName1">realpath async: /home/cgack/Dropbox/book/code/Ch03</span></pre>
<p class="indent">While that solution is effective for running your code in an attempt to get the directory structure of where your application is instantiated, it makes it difficult to parse the structure of arbitrary directories and directories relative to where you invoke your Node.js script. This can be solved by refactoring <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list1">Listing 3-1</a> slightly to allow for a command-line parameter as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list3" id="_list3">Listing 3-3</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list3" id="list3">Listing 3-3</a></i></b>.&nbsp;&nbsp;Refactoring the Directory Digest<a id="cXXX.176"></a></p>
<pre><span class="FontName1">var fs = require('fs');</span><br><span class="FontName1">var out;</span><br><span class="FontName1">var args;</span><br><span class="FontName1">//Normalize the arguments</span><br><span class="FontName1">args = process.argv.splice(2);</span><br>&nbsp;<br><span class="FontName1">args.forEach(function(arg) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(arg);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//read current directory asynchronous</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.realpath(arg, function(err, /* [cache], */ path) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('realpath async: ' + path);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">out = fs.realpathSync(arg);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('real path sync: ' + out);</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.stat(arg, function(err, stat) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) return;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.readdir(arg, function(err, contents) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) return;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">contents.forEach(function(f) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('contents: ' + f);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//get list of what’s in the directory</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">out = fs.readdirSync(arg);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('readdir sync: ' + out);</span><br>&nbsp;<br><span class="FontName1">});</span></pre>
<p class="indent">You can see that this solution offers a little more. It takes a list of arguments, normalizes them, and then loops through the directories provided, producing an output.&nbsp;&nbsp;This means that you can pass two relative paths to your Node.js application, and it will loop through and produce a result similar to the output in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list4" id="_list4">Listing 3-4</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list4" id="list4">Listing 3-4</a></i></b>.&nbsp;&nbsp;Multiple Paths Output<a id="cXXX.177"></a></p>
<pre><span class="FontName1">$ node 3-1-2.js ...</span><br><span class="FontName1">.</span><br><span class="FontName1">real path sync: /home/cgack/Dropbox/book/code/Ch03</span><br><span class="FontName1">readdir sync: 3-1-1.js,3-1-2.js</span><br><span class="FontName1">..</span><br><span class="FontName1">real path sync: /home/cgack/Dropbox/book/code</span><br><span class="FontName1">readdir sync: 2-6-2.js,Ch01,Ch02,Ch03</span><br><span class="FontName1">contents: 3-1-1.js</span><br><span class="FontName1">contents: 3-1-2.js</span><br><span class="FontName1">contents: 2-6-2.js</span><br><span class="FontName1">contents: Ch01</span><br><span class="FontName1">contents: Ch02</span><br><span class="FontName1">contents: Ch03</span><br><span class="FontName1">realpath async: /home/cgack/Dropbox/book/code</span></pre>
</div>
<div>
<p id="Sec4" class="Heading2">How It Works</p>
<p class="noindent">Now you examine how all of this works. You see that, in general, the difference between calling on a static, hard-coded directory and allowing a command-line argument to be passed into your command is the added benefit of flexibility. Let’s start with the code that reads the directory information, and then you can examine the differences in implementation.</p>
<p class="indent">The Node.js file-system module presents a plethora of useful wrappers around the standard POSIX commands<a id="cXXX.178"></a>, which are semiubiquitous across platforms (some operating systems vary in implementation). The commands that are utilized in this section are <span class="FontName1">readdir</span>, <span class="FontName1">stat</span>, and <span class="FontName1">realpath</span>.</p>
<p class="indent">The Node.js implementation of <span class="FontName1">readdir</span> is a simple command to read a directory. You will note, however, that there are two separate calls of the <span class="FontName1">readdir</span> in the solution. One is to <span class="FontName1">readdir</span> ()<a id="cXXX.179"></a>and the other to <span class="FontName1">readdirSync</span> ()<a id="cXXX.180"></a>. The <span class="FontName1">readdirSync</span> is the synchronous implementation of the file-system directory read, implemented as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list5" id="_list5">Listing 3-5</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list5" id="list5">Listing 3-5</a></i></b>.&nbsp;&nbsp;readdirSync<a id="cXXX.181"></a></p>
<pre><span class="FontName1">fs.readdirSync = function(path) {</span><br>&nbsp;&nbsp;<span class="FontName1">nullCheck(path);</span><br>&nbsp;&nbsp;<b>return binding.readdir(pathModule._makeLong(path));</b><br><span class="FontName1">};</span></pre>
<p class="indent">This simply checks if the path exists, then returns that path. The alternative version of this call is asynchronous (<a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list6" id="_list6">Listing 3-6</a>) and accepts a callback, as you might expect. The callback accepts two arguments: an error parameter and another that holds the information of the path.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list6" id="list6">Listing 3-6</a></i></b>.&nbsp;&nbsp;readdir ()<a id="cXXX.182"></a></p>
<pre><span class="FontName1">fs.readdir = function(path, callback) {</span><br>&nbsp;&nbsp;<span class="FontName1">callback = makeCallback(callback);</span><br>&nbsp;&nbsp;<span class="FontName1">if (!nullCheck(path, callback)) return;</span><br>&nbsp;&nbsp;<b>binding.readdir(pathModule._makeLong(path), callback);</b><br><span class="FontName1">};</span></pre>
<p class="indent">Similar to <span class="FontName1">readdir</span>, the Node.js function named <span class="FontName1">realpath</span> has both synchronous and asynchronous forms. The <span class="FontName1">realpath</span> function returns the absolute pathname for the provided path. So this is essentially two ways to gather information of the current directory. The function <span class="FontName1">realpath</span> retrieves the absolute path, and <span class="FontName1">readdir</span> retrieves information about its contents. <span class="FontName1">Readdir</span> can only retrieve a list of files or directories that are present in a directory, so in order to find out more details about a directory you need something different. This different method is <span class="FontName1">stat</span> ()<a id="cXXX.183"></a>. <span class="FontName1">stat()</span><a id="cXXX.184"></a> will gather all the information it can about the named file and you will see it used in more detail in subsequent sections, but in this case it is used as an entry point before you <span class="FontName1">readdir</span> on a path.</p>
<p class="indent">Now what about the two different versions of the example provided? One was based on a static path, which was in fact a Node.js global variable called __<span class="FontName1">dirname</span><a id="cXXX.185"></a>.<a id="cXXX.186"></a> The __<span class="FontName1">dirname</span> variable is relative to each module, and it represents the path to the Node.js script that is currently executing. So when you use this in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list1">Listing 3-1</a>, you are telling Node.js, and the file-system modules you invoke, to utilize the path to the Node.js module as the path argument for each file-system invocation.</p>
<p class="indent">This is rather limiting, so you see that in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list3">Listing 3-3</a> the module was opened up to utilize a set of command-line arguments that are passed to the module Node.js. This is utilizing the global process object that contains a list of the arguments in the <span class="FontName1">argv</span> element. In the listing, you see that these arguments are normalized to remove the first two parameters<span class="FontName1">—'node &lt;file&gt;'—and then parse</span> the rest of the arguments as an array. This array is then utilized as the path arguments for each of the Node.js file-system methods, giving much more versatility to the initial implementation of the directory information retrieval code.</p>
</div>
<p id="Sec5" class="Heading1">3-2. Navigating Through Directories<a id="cXXX.55a"></a></p>
<div>
<p id="Sec6" class="Heading2_2">Problem</p>
<p class="noindent">In many applications in which you work with the file system, you may want to traverse the directory structure in some form or another.</p>
</div>
<div>
<p id="Sec7" class="Heading2">Solution</p>
<p class="noindent">Traversing the directory structure of your machine with your Node.js application is accomplished by using the <span class="FontName1">fs</span> module. This solution begins where the solution for Section 3-1 left off, in that it starts by reading a directory and then it will move throughout the directory accordingly. The parsing of the directory structure is recursive and results in an array containing the files and directories contained within. This Node.js application is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list7" id="_list7">Listing 3-7</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list7" id="list7">Listing 3-7</a></i></b>.&nbsp;&nbsp;Traversing Directories<a id="cXXX.187"></a></p>
<pre><span class="FontName1">var fs = require('fs');</span><br><span class="FontName1">var out;</span><br><span class="FontName1">var args;</span><br>&nbsp;<br><span class="FontName1">/**</span><br><span class="FontName1">* To parse directory structure given a starting point - recursive</span><br><span class="FontName1">*/</span><br><span class="FontName1">function traverseDirectory(startDir, usePath, callback) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (arguments.length === 2 &amp;&amp; typeof arguments[1] === 'function') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback = usePath;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">usePath = false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//Hold onto the array of items</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var parsedDirectory = [];</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//start reading a list of whats contained</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.readdir(startDir, function(err, dirList) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (usePath) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">startDir = fs.realpathSync(startDir);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return callback(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//keep track of how deep we need to go before callback</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var listlength = dirList.length;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!listlength) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return callback(null, parsedDirectory);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//loop through the directory list</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">dirList.forEach(function(file) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">file = startDir + '/' + file;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.stat(file, function(err, stat) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//note the directory or file</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">parsedDirectory.push(file);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//recursive if this is a directory</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (stat &amp;&amp; stat.isDirectory()) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//recurse</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">traverseDirectory(file, function(err, parsed) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// read this directory into our output</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">parsedDirectory = parsedDirectory.concat(parsed);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//check to see if we've exhausted our search</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!--listlength) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback(null, parsedDirectory);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//check to see if we've exhausted the search</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!--listlength) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback(null, parsedDirectory);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">}</span><br>&nbsp;<br><span class="FontName1">//Normalize the arguments</span><br><span class="FontName1">args = process.argv.splice(2);</span><br><span class="FontName1">//loop through the directories</span><br><span class="FontName1">args.forEach(function(arg) {</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// use provided path</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">traverseDirectory(arg, function(err, result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(result);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//use full path</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">traverseDirectory(arg, true, function(err, result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(result);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <br><span class="FontName1">});</span></pre>
<p class="indent">This traversal<a id="cXXX.188"></a> results in a console output that looks something like that shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list8" id="_list8">Listing 3-8</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list8" id="list8">Listing 3-8</a></i></b>.&nbsp;&nbsp;Output of Traversal</p>
<pre><span class="FontName1">gack∼/Dropbox/book/code/Ch03: node 3-2-1.js.</span><br><span class="FontName1">[ './3-1-1.js',</span><br>&nbsp;&nbsp;<span class="FontName1">'./3-1-2.js',</span><br>&nbsp;&nbsp;<span class="FontName1">'./3-2',</span><br>&nbsp;&nbsp;<span class="FontName1">'./3-2-1.js',</span><br>&nbsp;&nbsp;<span class="FontName1">'./3-2/file.txt',</span><br>&nbsp;&nbsp;<span class="FontName1">'./3-2/sub directory',</span><br>&nbsp;&nbsp;<span class="FontName1">'./3-2/sub directory/file.txt' ]</span><br><span class="FontName1">[ '/Users/gack/Dropbox/book/code/Ch03/3-1-1.js',</span><br>&nbsp;&nbsp;<span class="FontName1">'/Users/gack/Dropbox/book/code/Ch03/3-1-2.js',</span><br>&nbsp;&nbsp;<span class="FontName1">'/Users/gack/Dropbox/book/code/Ch03/3-2',</span><br>&nbsp;&nbsp;<span class="FontName1">'/Users/gack/Dropbox/book/code/Ch03/3-2-1.js',</span><br>&nbsp;&nbsp;<span class="FontName1">'/Users/gack/Dropbox/book/code/Ch03/3-2/file.txt',</span><br>&nbsp;&nbsp;<span class="FontName1">'/Users/gack/Dropbox/book/code/Ch03/3-2/sub directory',</span><br>&nbsp;&nbsp;<span class="FontName1">'/Users/gack/Dropbox/book/code/Ch03/3-2/sub directory/file.txt' ]</span></pre>
</div>
<div>
<p id="Sec8" class="Heading2">How It Works</p>
<p class="noindent">This solution works <a id="cXXX.189"></a>by first taking a lesson from Section 3-1 and providing the arguments via the command line, which are then normalized. This directs the application which paths to use when beginning the traversal of the directory structure, which is handled in the function <span class="FontName1">traverseDirectory</span>.</p>
<p class="indent">The <span class="FontName1">traverseDirectory</span> function accepts a path (or starting directory), an optional flag to translate the starting path to a full path, and a callback function. The optional <span class="FontName1">usePath</span> flag is determined by checking if there are only two parameters passed in and that the second parameter is a function, indicating that the callback was supplied.</p>
<pre><span class="FontName1">if (arguments.length === 2 &amp;&amp; typeof arguments[1] === 'function') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback = usePath;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">usePath = false;</span><br><span class="FontName1">}</span></pre>
<p class="indent">The <span class="FontName1">usePath</span> flag<a id="cXXX.190"></a> is an option that, if set, will then parse the directory provided to the <span class="FontName1">traverseDirectory</span> method<a id="cXXX.191"></a> using the <span class="FontName1">fs.realpath</span> function<a id="cXXX.192"></a>. So this would convert a path provided as ‘.’, representing the current working directory, to the actual path for your application (i.e. ‘/home/username/apps/’).</p>
<p class="indent">The actual traversal through the directory structure begins with a call to <span class="FontName1">fs.readdir</span>, which, as you saw in Section 3-1, provides a callback with a list of what resides in the directory. Then a check is made on this returned list to ensure that there is information in the directory available to parse. If no result exists, the function exits with the provided callback. Alternatively, if there are results in the directory listing, you store the length of that array (<span class="FontName1">listlength</span>) to keep track of the remaining items to be parsed from the directory tree.</p>
<p class="indent">You then loop through the directory list array, applying the function <span class="FontName1">fs.stat</span> to each item it contains. The <span class="FontName1">fs.stat</span> function<a id="cXXX.193"></a><a id="cXXX.194"></a> returns an <span class="FontName1">fs.stat</span> object detailing information about a file on the file system. The <span class="FontName1">traverseDirectory</span> function then stores the file (or directory) on which the <span class="FontName1">fs.stat</span> object was invoked into the output array <span class="FontName1">parsedDirectory.</span> The stat object is then checked to see if the result is a directory via the <span class="FontName1">stat.isDirectory</span> function. If the result is true, then the <span class="FontName1">traverseDirectory</span> function is called, passing in that directory<span class="FontName1">—</span>recursively parsing the directory. If the stat is not a directory, the function assumes it is a file, but, regardless if it is a file or not, the directory list length variable is decremented and checked to see if there are any entries remaining, <span class="FontName1">if (!—listlength)</span>. In the case where there are not any entries remaining, the function returns the callback passing the <span class="FontName1">parsedDirectory</span> array. The results are passed on to the callback function, which, in this example, logs them to the console.</p>
</div>
<p id="Sec9" class="Heading1">3-3. Manipulating the Directory Structure<a id="cXXX.58y"></a></p>
<div>
<p id="Sec10" class="Heading2_2">Problem</p>
<p class="noindent">You want to manipulate the structure of your directories by adding and removing directories via your Node.js application.</p>
</div>
<div>
<p id="Sec11" class="Heading2">Solution</p>
<p class="noindent">This solution takes two forms and will be described in two parts. The first part is the removal of directories. In Node.js this is as simple as calling the file-system module’s make directory or make directory synchronous functions, <span class="FontName1">fs.mkdir</span><a id="cXXX.195"></a> and fs.mkdirSync<a id="cXXX.196"></a>. Both of these functions are shown in a single example, <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list9" id="_list9">Listing 3-9</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list9" id="list9">Listing 3-9</a></i></b>.&nbsp;&nbsp;Creating Directory Synchronous and Asynchronous Functions<a id="cXXX.197"></a></p>
<pre><span class="FontName1">var fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">dirExists = false;</span><br>&nbsp;<br><span class="FontName1">//Normalize the arguments</span><br><span class="FontName1">args = process.argv.splice(2);</span><br><span class="FontName1">//loop through named args</span><br><span class="FontName1">args.forEach(function(arg) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//mkdirSync - manually handle errors</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">try {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.mkdirSync(arg);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} catch(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">handleError(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//mkdir async</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.mkdir(arg, function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) handleError(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">function handleError(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err.code === 'EEXIST') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('That directory already exists');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('An error occurred creating the directory');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">}</span></pre>
<p class="indent">The second part of the solution for manipulating the structure of your directories involves the Node.js methods for removing existing directories. The removal code (shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list10" id="_list10">Listing 3-10</a>) is essentially the reversal of the creation, with a slight difference in the handling of exceptions.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list10" id="list10">Listing 3-10</a></i></b>.&nbsp;&nbsp;Removing Directories<a id="cXXX.198"></a><a id="cXXX.199"></a></p>
<pre><span class="FontName1">var fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">dirExists = false;</span><br>&nbsp;<br><span class="FontName1">//Normalize the arguments</span><br><span class="FontName1">args = process.argv.splice(2);</span><br><span class="FontName1">//loop through named args</span><br><span class="FontName1">args.forEach(function(arg) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//rmdir sync</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">try {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.rmdirSync(dir);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} catch(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">handleError(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//rmdir async</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.rmdir(arg, function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) handleError(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">function handleError(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err.code === 'ENOENT') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('That directory does not exist');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else if (err.code === 'ENOTEMPTY') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('Cannot remove directory because it is not empty');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('An error occurred removing the directory');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">}</span></pre>
</div>
<div>
<p id="Sec12" class="Heading2">How It Works</p>
<p class="noindent">The creation of directories happens with the <span class="FontName1">mkdir</span> function. <a id="cXXX.200"></a>The <span class="FontName1">mkdir</span> function<a id="cXXX.201"></a> also accepts a callback function with an error argument only. The error thrown when the directory already exist has the code <span class="FontName1">EEXIST</span>, so in the example this is handled explicitly in the <span class="FontName1">handleError</span> function. The synchronous version of <span class="FontName1">mkdir</span> (i.e., <span class="FontName1">mkdirSync</span>) does not provide an error callback, so in the example you see that it is creating inside of a try-catch, where the catch provides the same error handler as the asynchronous callback. Both the synchronous and asynchronous functions <span class="FontName1">accept</span> an optional second argument that dictates the mode with which the directory will be created, defaulting to <span class="FontName1">0777</span>. If you want to restrict permissions you could alter the creation mode to anything (for example, <span class="FontName1">0755)</span>, restricting all but the user to read and execute permissions on the directory.</p>
<p class="indent">The removal of directories is similar to creation. The removal asynchronous function, <span class="FontName1">rmdir</span>, accepts a callback with an error argument. The common errors that are handled with this callback are <span class="FontName1">EONENT</span> and <span class="FontName1">ENOTEMPTY</span><a id="cXXX.202"></a>. <span class="FontName1">EONENT</span><a id="cXXX.203"></a> is thrown when the directory does not exist and you attempt to remove it from the directory structure. <span class="FontName1">ENOTEMPTY</span><a id="cXXX.204"></a> is thrown when you attempt to remove a directory that is not empty. These are both handled via the <span class="FontName1">handleError</span> function. Later in this chapter you will see how to move and rename files, which will be necessary if you want to remove a folder that is not empty.</p>
</div>
<p id="Sec13" class="Heading1">3-4. Watching a Directory for Modifications<a id="cXXX.60w"></a></p>
<div>
<p id="Sec14" class="Heading2_2">Problem</p>
<p class="noindent">You want to watch a directory for changes made to its structure during the process of running your Node.js application.</p>
</div>
<div>
<p id="Sec15" class="Heading2">Solution</p>
<p class="noindent">The solution to watching a directory structure follows the solution from Section 3-2, which traversed through a directory to read its contents into an array. For this solution you could do two things. One way could be to again traverse through the directory structure, caching the initial state of the directory and subdirectories. You will then set an interval for when you will check the directory structure again and compare the output of those two arrays. This is not the best solution because Node.js has a built-in utility within the file-system module that will create a file-system watcher object named <span class="FontName1">fs.watch</span><a id="cXXX.205"></a>
<span class="FontName1"></span>. The way in which this is implemented is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list11" id="_list11">Listing 3-11</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list11" id="list11">Listing 3-11</a></i></b>.&nbsp;&nbsp;Watching for Changes<a id="cXXX.206"></a></p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* Watching a directory</span><br><span class="FontName1">*/</span><br><span class="FontName1">var os = require('os'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">out,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">args;</span><br>&nbsp;<br><span class="FontName1">/**</span><br><span class="FontName1">* To parse directory structure given a starting point - recursive</span><br><span class="FontName1">*/</span><br><span class="FontName1">function traverseDirectory(startDir, usePath, callback) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (arguments.length === 2 &amp;&amp; typeof arguments[1] === 'function') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback = usePath;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">usePath = false;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//Hold onto the array of items</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var parsedDirectory = [];</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//start reading a list of what’s contained</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.readdir(startDir, function(err, dirList) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (usePath) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">startDir = fs.realpathSync(startDir);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return callback(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//keep track of how deep we need to go before callback</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var listlength = dirList.length;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!listlength) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return callback(null, parsedDirectory);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//loop through the directory list</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">dirList.forEach(function(file) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//WIndows is special</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">file = startDir + (os.platform() === 'win32' ? '\\' : '/') + file;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.stat(file, function(err, stat) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//note the directory or file</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">parsedDirectory.push(file);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//recursive if this is a directory</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (stat &amp;&amp; stat.isDirectory()) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//recurse</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">traverseDirectory(file, function(err, parsed) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// read this directory into our output</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">parsedDirectory = parsedDirectory.concat(parsed);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//check to see if we've exhausted our search</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!--listlength) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback(null, parsedDirectory);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//check if we've exhausted the search</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (!--listlength) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">callback(null, parsedDirectory);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">}</span><br><span class="FontName1">//Normalize the arguments</span><br><span class="FontName1">args = process.argv.splice(2);</span><br><span class="FontName1">//loop through the directories</span><br><span class="FontName1">args.forEach(function(arg) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<b>traverseDirectory(arg, true, function(err, result) {</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>result.forEach(function(i) {</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>fs.watch(i, filesystemListener);</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>});</b><br>&nbsp;&nbsp;&nbsp;&nbsp;<b>});</b><br>&nbsp;&nbsp;&nbsp;&nbsp; <br><span class="FontName1">});</span><br>&nbsp;<br><b>function filesystemListener(e, f) {</b><br>&nbsp;&nbsp;&nbsp;&nbsp;<b>console.log(f + ': ' + e);</b><br><b>}</b></pre>
<p class="indent">This solution is extremely powerful because it will also check the individual files for changes, with a call to a single function. However as you will see, the <span class="FontName1">fs.watch</span> method is unstable and may not perform as expected in your Node.js environment. Because of this, an alternative to watching for directory structure changes is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list12" id="_list12">Listing 3-12</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list12" id="list12">Listing 3-12</a></i></b>.&nbsp;&nbsp;Checking for Directory Structure Changes<a id="cXXX.207"></a></p>
<pre><span class="FontName1">function checkSame(err, result) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (initialDir.length === 0) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">initialDir = result;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">secondaryDir = result;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//let’s compare these</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (secondaryDir.length !== initialDir.length) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('directory structure changed');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">clearInterval(checkInt);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">secondaryDir.sort();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">initialDir.sort();</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">for (var i=0, ii = secondaryDir.length; i &lt; ii; i++) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (secondaryDir[i] !== initialDir[i]) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (secondaryDir.indexOf(initialDir[i]) &lt; 0) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(initialDir[i] + ' removed');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (initialDir.indexOf(secondaryDir[i]) &lt; 0) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(secondaryDir[i] + ' added');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">clearInterval(checkInt);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">}</span><br><span class="FontName1">var checkInt;</span><br><span class="FontName1">//Normalize the arguments</span><br><span class="FontName1">args = process.argv.splice(2);</span><br><span class="FontName1">//loop through the directories</span><br><span class="FontName1">args.forEach(function(arg) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">checkInt = setInterval(traverseDirectory, 2e3, arg, true, checkSame);</span><br><span class="FontName1">});</span></pre>
</div>
<div>
<p id="Sec16" class="Heading2">How It Works</p>
<p class="noindent">The example from <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list11">Listing 3-11</a> shows the traversal of the directory tree with the addition of a very important function. The <span class="FontName1">traverseDirectory</span> function results in an array of file names and directory names. You then loop through these results, invoking the <span class="FontName1">fs</span>.<span class="FontName1">watch</span> function on each path.&nbsp;&nbsp;The fs.watch function is part of the file-system watching capabilities, which are covered later in Section 3-10.</p>
<p class="indent">Be warned that the <span class="FontName1">fs.watch</span> functionality is not always available across platforms, and (as of Node.js version 0.10.5) is still considered “unstable.”&nbsp;&nbsp;Because of this the alternative implementation, shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list13" id="_list13">Listing 3-13</a>, is more reliable across platforms and only looks for changes to the structure of the file system. Again this system utilizes the <span class="FontName1">traverseDirectory</span> function, but does so on an interval. This interval will parse the directory structure every two seconds, but you may want to adjust the interval if you are parsing a large directory tree that will take longer than that to recursively parse. After the first iteration, the array from the original parsing is compared to the array of the current parsing within the <span class="FontName1">checkSame</span> function. If a change is detected it is logged.&nbsp;&nbsp;Changes are detected first if the lengths of the arrays are different, meaning that the underlying structure has been modified (i.e., file deletion). The arrays<a id="cXXX.208"></a> are then both sorted, and then each item is checked to see if it still exists within the other result set.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list13" id="list13">Listing 3-13</a></i></b>.&nbsp;&nbsp;Checking Directory Differences<a id="cXXX.209"></a></p>
<pre><span class="FontName1">if (</span><b>secondaryDir.length !== initialDir.length</b><span class="FontName1">) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('directory structure changed');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">clearInterval(checkInt);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">secondaryDir.sort();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">initialDir.sort();</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">for (var i=0, ii = secondaryDir.length; i &lt; ii; i++) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (</span><b>secondaryDir[i] !== initialDir[i]</b><span class="FontName1">) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (</span><b>secondaryDir.indexOf(initialDir[i]) &lt; 0</b><span class="FontName1">) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(initialDir[i] + ' removed');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (</span><b>initialDir.indexOf(secondaryDir[i]) &lt; 0</b><span class="FontName1">) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(secondaryDir[i] + ' added');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">clearInterval(checkInt);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span></pre>
<p class="indent">Using this method when watching a directory for changes will produce a result that looks similar to the output in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list14" id="_list14">Listing 3-14</a>, produced when changing a directory name from <span class="FontName1">"that"</span> to <span class="FontName1">"this"</span>:</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list14" id="list14">Listing 3-14</a></i></b>.&nbsp;&nbsp;Noting Directory Structure Changes</p>
<pre><span class="FontName1">$ node 3-4-1.js.</span><br><span class="FontName1">/home/cgack/book/code/Ch03/3-4/now/that</span> <b>removed</b><br><span class="FontName1">/home/cgack/book/code/Ch03/3-4/now/this</span> <b>added</b></pre>
</div>
<p id="Sec17" class="Heading1">3-5. Reading Files<a id="cXXX.64b"></a></p>
<div>
<p id="Sec18" class="Heading2_2">Problem</p>
<p class="noindent">In the process of building a Node.js application, you need to access and read a file from the file system.</p>
</div>
<div>
<p id="Sec19" class="Heading2">Solution</p>
<p class="noindent">Reading a file from the file system is fairly straightforward when utilizing the file-system module. The file-system module provides multiple ways in which you can read a file. In <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list15" id="_list15">Listing 3-15</a>, the solution displays the three main methods in which a file can be read in Node.js using the file system: <span class="FontName1">readFile</span><a id="cXXX.210"></a>, <span class="FontName1">readFileSync</span><a id="cXXX.211"></a>, and <span class="FontName1">createReadStream</span><a id="cXXX.212"></a>
<span class="FontName1"></span>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list15" id="list15">Listing 3-15</a></i></b>.&nbsp;&nbsp;Reading Files<a id="cXXX.213"></a></p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* Reading a file</span><br><span class="FontName1">*/</span><br><span class="FontName1">var fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">args;</span><br>&nbsp;<br><span class="FontName1">args = process.argv.splice(2);</span><br>&nbsp;<br><span class="FontName1">args.forEach(function(arg){</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//async read</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.readFile(arg, 'utf8', function(err, data) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) console.log(err);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(data);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//synchronicity</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var file = fs.readFileSync(arg, 'utf8');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(file);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//with a readable stream</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">var readstrm = fs.createReadStream(arg, {flag: 'r', encoding: 'utf8'});</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">readstrm.on('data', function(d) {</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(d);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">});</span></pre>
</div>
<div>
<p id="Sec20" class="Heading2">How It Works</p>
<p class="noindent">Reading a file in Node.js can take different forms. First, you can utilize the standard asynchronous function <span class="FontName1">fs.readFile</span>. This function will accept a file name (which is required), an optional options argument, and a callback (also required). The options argument is used to set the <span class="FontName1">encoding (</span>which will set the encoding for the file buffer as it is read), and added to the options object is the <span class="FontName1">flag</span>, which sets the flag with which the file is to be opened: this will always be ‘r’.</p>
<p class="indent">The <span class="FontName1">readFile</span> function<a id="cXXX.214"></a> at its core makes a call to the function <span class="FontName1">fs.open<a id="cXXX.65d"></a></span>, which will open the file. The flag option, which is always set to ‘r’, means the file is to be opened for reading. In the case of <span class="FontName1">readFile</span>, the open method shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list16" id="_list16">Listing 3-16</a> will get the size of the file and then create a buffer matching that size. This buffer is then read in the <span class="FontName1">read()</span> function.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list16" id="list16">Listing 3-16</a></i></b>.&nbsp;&nbsp;fs.open and read() inside of fs.readFile<a id="cXXX.215"></a></p>
<pre>&nbsp;<span class="FontName1">fs.open(path, flag, 438 /*=0666*/, function(er, fd_) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (er) return callback(er);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fd = fd_;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.fstat(fd, function(er, st) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (er) return callback(er);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">size = st.size;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (size === 0) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// the kernel lies about many files.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// Go ahead and try to read some bytes.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">buffers = [];</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return read();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">buffer = new Buffer(size);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">read();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">function read() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (size === 0) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">buffer = new Buffer(8192);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.read(fd, buffer, 0, 8192, -1, afterRead);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.read(fd, buffer, pos, size - pos, -1, afterRead);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;<span class="FontName1">}</span></pre>
<p class="indent">You can see that the <span class="FontName1">fs.readFile's</span> internal <span class="FontName1">read</span> () function<a id="cXXX.216"></a> makes a call to <span class="FontName1">fs.read</span>, pointing to the file descriptor and the buffer that was created to be the size of the opened file. The result is then finally sent to the <span class="FontName1">fs.readFile</span>’s callback function after executing the <span class="FontName1">afterRead</span> function and the file is closed. The close method is what actually sends the data from the buffer back to the callback.</p>
<p class="noindent2"><b><i>Listing 3-17</i></b>.&nbsp;&nbsp;Close Event Sending the readFile Data Back to the Caller<a id="cXXX.217"></a></p>
<pre><span class="FontName1">function close() {</span><br>&nbsp;<span class="FontName1">fs.close<a id="cXXX.65g"></a>(fd, function(er) {</span><br>&nbsp;&nbsp; <span class="FontName1">if (size === 0) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">// collected the data into the buffers list.</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">buffer = Buffer.concat(buffers, pos);</span><br>&nbsp;&nbsp; <span class="FontName1">} else if (pos &lt; size) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">buffer = buffer.slice(0, pos);</span><br>&nbsp;&nbsp; <span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp; <span class="FontName1">if (encoding) buffer = buffer.toString(encoding);</span><br>&nbsp;&nbsp; <span class="FontName1">return callback(er, buffer);</span><br>&nbsp;<span class="FontName1">});</span><br><span class="FontName1">}</span></pre>
<p class="indent">As you might imagine, the next method for reading a file, <span class="FontName1">fs.readFileSync</span>, follows a similar pattern to the <span class="FontName1">fs.readFile</span> function, but it only operates synchronously. This results not in a callback that contains the data read from the file, but the synchronous version returns the data directly, with the proper encoding applied.</p>
<pre><span class="FontName1">if (encoding) buffer = buffer.toString(encoding);</span><br><span class="FontName1">return buffer;</span></pre>
<p class="indent">Finally, in the solution for reading files with Node.js, you created a readable stream<a id="cXXX.218"></a> to parse the file. The readable stream is created using the <span class="FontName1">fs.createReadStream</span> function<a id="cXXX.219"></a> that does exactly as its name foretells: it creates a <span class="FontName1">ReadStream</span>. A <span class="FontName1">ReadStream</span> is a readable stream with an <span class="FontName1">open</span> event, which returns the file descriptor (<span class="FontName1">fd</span>) that is being used by the stream to read the file. The options passed into the readable stream is an object that has the following defaults:</p>
<pre><span class="FontName1">{ flags: 'r',&nbsp;&nbsp; encoding: null,&nbsp;&nbsp; fd: null,&nbsp;&nbsp; mode: 0666,&nbsp;&nbsp; bufferSize: 64 * 1024,&nbsp;&nbsp; autoClose: true }</span></pre>
<p class="indent">There are two extra options that can be passed: start and end. These specify a particular slice of the file you wish to read.</p>
<p class="indent">The <span class="FontName1">ReadStream</span> is created with these options set, and then the stream is opened. Opening the stream makes a call to <span class="FontName1">fs.open</span>, allowing the file to be opened and read, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list18" id="_list18">Listing 3-18</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list18" id="list18">Listing 3-18</a></i></b>.&nbsp;&nbsp;ReadStream Calling fs.open and Reading the File</p>
<pre><span class="FontName1">ReadStream.prototype.open = function() {</span><br>&nbsp;&nbsp;<span class="FontName1">var self = this;</span><br>&nbsp;&nbsp;<span class="FontName1">fs.open(this.path, this.flags, this.mode, function(er, fd) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (er) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (this.autoClose) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.destroy();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.emit('error', er);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.fd = fd;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.emit('open', fd);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// start the flow of data.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.read();</span><br>&nbsp;&nbsp;<span class="FontName1">});</span><br><span class="FontName1">};</span></pre>
</div>
<p id="Sec21" class="Heading1">3-6. Writing Files<a id="cXXX.67q"></a></p>
<div>
<p id="Sec22" class="Heading2_2">Problem</p>
<p class="noindent">You want to utilize Node.js to write content or data to files in your application.</p>
</div>
<div>
<p id="Sec23" class="Heading2">Solution<a id="cXXX.220"></a></p>
<p class="noindent">The solution for writing files from Node.js is similar to the methods addressed in Section 3-5. Just as with reading files there are several methods for writing files in Node.js. There is the typical asynchronous approach (<span class="FontName1">fs.writeFile</span><a id="cXXX.221"></a>), a synchronous version of that function (<span class="FontName1">fs.writeFileSync</span><a id="cXXX.222"></a>
<span class="FontName1">)</span>, and a stream version of writing a file (<span class="FontName1">createWriteStream</span><a id="cXXX.223"></a>
<span class="FontName1">)</span>. There is another method, which is used to append data to a file called <span class="FontName1">fs.appendFile</span><a id="cXXX.224"></a>. These functions are shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list19" id="_list19">Listing 3-19</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list19" id="list19">Listing 3-19</a></i></b>.&nbsp;&nbsp;Writing Files</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* Writing files</span><br><span class="FontName1">*/</span><br><span class="FontName1">var fs = require('fs');</span><br><span class="FontName1">//initial write</span><br><span class="FontName1">fs.writeFile('write.txt', 'This is the contents!', function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('huzzah');</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">try {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">fs.writeFileSync('./doesnotexist/newfile.txt', 'content');</span><br><span class="FontName1">} catch(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('unable to create a file in a non existent sub directory');</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(err);</span><br><span class="FontName1">}</span><br><span class="FontName1">//appending</span><br><span class="FontName1">fs.appendFile('write.txt', 'More content', function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('appended');</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">var ws = fs.createWriteStream('write.txt');</span><br><span class="FontName1">ws.write('new content\r\n', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('write stream hath written.');</span><br><span class="FontName1">});</span></pre>
<p class="indent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list19">Listing 3-19</a> shows how to go about writing a file in Node.js by using three different methods. The synchronous method is purposefully targeting a file in a nonexistent subdirectory in order to demonstrate the error handling of this situation and to observe that writing a file will not create a directory. The output from executing this solution will look like the example shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list20" id="_list20">Listing 3-20</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list20" id="list20">Listing 3-20</a></i></b>.&nbsp;&nbsp;Writing files output<a id="cXXX.225"></a></p>
<pre><span class="FontName1">gack∼/Dropbox/book/code/Ch03: node 3-6-1.js</span><br><span class="FontName1">unable to create a file in a non existent sub directory</span><br><span class="FontName1">{ [Error: ENOENT, no such file or directory './doesnotexist/newfile.txt']</span><br>&nbsp;&nbsp;<span class="FontName1">errno: 34,</span><br>&nbsp;&nbsp;<span class="FontName1">code: 'ENOENT',</span><br>&nbsp;&nbsp;<span class="FontName1">path: './doesnotexist/newfile.txt',</span><br>&nbsp;&nbsp;<span class="FontName1">syscall: 'open' }</span><br><span class="FontName1">write stream hath written.</span><br><span class="FontName1">appended</span><br><span class="FontName1">huzzah</span></pre>
</div>
<div>
<p id="Sec24" class="Heading2">How It Works</p>
<p class="noindent">Let’s examine how files are written in Node.js by starting with the asynchronous <span class="FontName1">fs.writeFile</span>. <span class="FontName1">fs.writeFile</span> accepts up to four arguments<a id="cXXX.226"></a>: path, data, options, and a callback. The path points to the file you wish to write. The file does not need to exist, as it will be created if not. However, if you are targeting a directory that does not exist, the <span class="FontName1">writeFile</span> function will not automatically create the directory for you. The data argument is the data that you wish to write to the file and can be in the form of a string or a buffer. The options object contains the encoding, the mode, and the flag for the file access. Just like with the <span class="FontName1">readFile</span> method, encoding is the only configurable option as the settings for the mode and flag are set to <span class="FontName1">mode: 438 /*=0666*/ and flag: 'w'</span>. The callback will pass on any errors in order to handle them.</p>
<p class="indent">Once the defaults have been set within the <span class="FontName1">writeFile</span> function, <span class="FontName1">fs.open</span> is called. Since this is called with the <span class="FontName1">'w'</span> flag set, it will either create the file or truncate the file. The data will then be written to the file as a buffer, and a string will be converted to a buffer if that is the data type provided as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list21" id="_list21">Listing 3-21</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list21" id="list21">Listing 3-21</a></i></b>.&nbsp;&nbsp;writeFile<span class="FontName1">—</span>Open and Write Data<a id="cXXX.227"></a></p>
<pre><span class="FontName1">var flag = options.flag || 'w';</span><br>&nbsp;<span class="FontName1">fs.open(path, options.flag || 'w', options.mode, function(openErr, fd) {</span><br>&nbsp;&nbsp; <span class="FontName1">if (openErr) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">if (callback) callback(openErr);</span><br>&nbsp;&nbsp; <span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">var buffer = Buffer.isBuffer(data) ? data : new Buffer('' + data,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">options.encoding || 'utf8');</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">var position = /a/.test(flag) ? null : 0;</span><br>&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">writeAll(fd, buffer, 0, buffer.length, position, callback);</span><br>&nbsp;&nbsp; <span class="FontName1">}</span><br>&nbsp;<span class="FontName1">});</span></pre>
<p class="indent">The <span class="FontName1">writeAll</span> function<a id="cXXX.228"></a> wraps the <span class="FontName1">fs.write</span> function and will write the buffer in its entirety to the file. Similar to the <span class="FontName1">readFile</span> and <span class="FontName1">readFileSync</span> functions, the <span class="FontName1">writeFileSync</span> functions in the same way as <span class="FontName1">writeFile</span> with the exception that all the functions are synchronous, throwing any errors that are encountered along the way. This is the reason why this code in the example was written within a try-catch block in order to gracefully catch the error thrown when the directory did not exist.</p>
<p class="indent">In many cases, you may not want to create or truncate a file as you are writing data to it. This is where the <span class="FontName1">fs.appendFile</span> function is useful. This function is a utility to write a file, only appending data to the file instead of writing the data fresh. It does this by simply altering the flag option for <span class="FontName1">fs.writeFile</span> and then invoking that function as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list22" id="_list22">Listing 3-22</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list22" id="list22">Listing 3-22</a></i></b>.&nbsp;&nbsp;Altering the flag option<a id="cXXX.229"></a></p>
<pre><span class="FontName1">if (!options.flag)</span><br>&nbsp;&nbsp;<span class="FontName1">options = util._extend({ flag: 'a' }, options);</span><br><span class="FontName1">fs.writeFile(path, data, options, callback);</span></pre>
<p class="indent">As shown, this will open the file with <span class="FontName1">fs.open</span>. Setting the flag to ‘a’ will open the file for appending, allowing it to be created if the file does not exist.</p>
<p class="indent">The streaming method <a id="cXXX.230"></a>is <span class="FontName1">fs.createWriteStream</span><a id="cXXX.231"></a>, which creates a writable stream. The <span class="FontName1">createWriteStream</span> method will take a path and options. The options that can be set are <span class="FontName1">fd</span> (a file descriptor), flags, mode, and start. The fd will point to a file handle to write data to. The flag default is <span class="FontName1">w,</span> in order to open the file for writing.&nbsp;&nbsp;The mode option defaults to <span class="FontName1">0666</span>, or read and write permissions. The start option tells where in the file to start writing data. It should be noted that if you specify a start position that exceeds the end of a file length, you will end up with a mess of buffer output in your file, instead of the intended data or text.</p>
<p class="indent">A <span class="FontName1">WriteStream</span> is written by first opening the file, then calling an internal _<span class="FontName1">write</span> function<a id="cXXX.232"></a>. The function will ensure the data to be written are sound and that the file is indeed open. Once that is confirmed, the file will be written using the <span class="FontName1">fs.write</span> method, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list23" id="_list23">Listing 3-23</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list23" id="list23">Listing 3-23</a></i></b>.&nbsp;&nbsp;WriteStream’s _write Method<a id="cXXX.233"></a><a id="cXXX.234"></a></p>
<pre><span class="FontName1">WriteStream.prototype._write = function(data, encoding, cb) {</span><br>&nbsp;&nbsp;<span class="FontName1">if (!Buffer.isBuffer(data))</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return this.emit('error', new Error('Invalid data'));</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">if (typeof this.fd !== 'number')</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return this.once('open', function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this._write(data, encoding, cb);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">var self = this;</span><br>&nbsp;&nbsp;<span class="FontName1">fs.write(this.fd, data, 0, data.length, this.pos, function(er, bytes) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (er) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.destroy();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return cb(er);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.bytesWritten += bytes;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">cb();</span><br>&nbsp;&nbsp;<span class="FontName1">});</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">if (this.pos !== undefined)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this.pos += data.length;</span><br><span class="FontName1">};</span></pre>
</div>
<p id="Sec25" class="Heading1">3-7. Moving Files<a id="cXXX.69z"></a></p>
<div>
<p id="Sec26" class="Heading2_2">Problem</p>
<p class="noindent">You want to be able to move files within your directory structure from your Node.js application. You will more likely than not encounter a situation where you will need to change the location of a file for one reason or another. Perhaps you are storing a temporary cache of files in your Node.js application that you wish to move to a more permanent location. You then have a user who indicates he would like to store his favorite animated .gif file in a more permanent location.</p>
</div>
<div>
<p id="Sec27" class="Heading2">Solution</p>
<p class="noindent">Moving files around is important when you are building an application that accesses the file system. In the situation outlined in this problem you would move the file using Node.js, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list22">Listing 3-22</a>.</p>
<p class="indent"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list24" id="_list24">Listing 3-24</a> is an example of a file, awesome.gif, that your user has cached.&nbsp;&nbsp;This file is in a temporary directory, <span class="FontName1">3-7/tmp/</span>, in the file system and needs to be moved to a save folder, <span class="FontName1">3-7/save/</span>.&nbsp;&nbsp;To demonstrate this you will see like many things with Node.js there are multiple methods for accomplishing this. Two of these utilize the file-system module, incorporating the rename and <span class="FontName1">renameSync</span> functions to move a file.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list24" id="list24">Listing 3-24</a></i></b>.&nbsp;&nbsp;Moving a File: Starting from the Command Line<a id="cXXX.235"></a></p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* Moving files</span><br><span class="FontName1">*/</span><br><span class="FontName1">var fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">origPath,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">newPath,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">args = process.argv;</span><br>&nbsp;<br><span class="FontName1">if (args.length !== 4) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">throw new Error('Invalid Arguments');</span><br><span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">origPath = args[2];</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">newPath = args[3];</span><br><span class="FontName1">}</span><br><span class="FontName1">// move file asynchronously from tmp to save</span><br><span class="FontName1">fs.rename(origPath, newPath, function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br><span class="FontName1">});</span></pre>
<p class="indent">You will start with an example using the command line, and you’ll then see two other methods for accomplishing the same task of moving a file in Node.js.</p>
<p class="indent">This is accomplished by providing a command-line argument like the following:</p>
<pre><span class="FontName1">$&nbsp;&nbsp;node 3-7-1.js 3-7/tmp/awesome.gif 3-7/save/awesome.gif</span></pre>
<p class="indent">Aside from setting this up through the command line, you could also implement the <span class="FontName1">fs.rename</span> function<a id="cXXX.236"></a> directly within your application. This could also be set up to run synchronously, as in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list25" id="_list25">Listing 3-25</a>, or via a child process, as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list26" id="_list26">Listing 3-26</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list25" id="list25">Listing 3-25</a></i></b>.&nbsp;&nbsp;Synchronous File Move<a id="cXXX.237"></a><a id="cXXX.238"></a></p>
<pre><span class="FontName1">//Synchronous</span><br><span class="FontName1">fs.renameSync(origPath, newPath);</span></pre>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list26" id="list26">Listing 3-26</a></i></b>.&nbsp;&nbsp;Using a Child Process to Move a File<a id="cXXX.239"></a></p>
<pre><span class="FontName1">// Child process =&gt; more in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch05.xhtml">Chapter 5</a></span><br><span class="FontName1">var child = require('child_process');</span><br><span class="FontName1">child.exec('mv 3-7/tmp/awesome.gif 3-7/save/awesome.gif', function(err, stdout, stderr) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log('out: ' + stdout);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (stderr) throw stderr;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br><span class="FontName1">});</span></pre>
</div>
<div>
<p id="Sec28" class="Heading2">How It Works</p>
<p class="noindent">When you begin to examine how this works, you first look to the file-system module. The <span class="FontName1">fs.rename</span> function performs a standard POSIX rename, defined below.</p>
<div class="blockquote">
<p class="noindent"><i>The rename( ) function</i><a id="cXXX.240"></a><a id="cXXX.241"></a> <i>shall change the name of a file. The old argument points to the pathname of the file to be renamed. The new argument points to the new pathname of the file.</i></p>
<p class="noindent"><i>If either the old or new argument names a symbolic link, rename( ) shall operate on the symbolic link itself, and it shall not resolve the last component of the argument. If the old argument and the new argument resolve to the same existing file, rename( ) shall return successfully and perform no other action.</i></p>
</div>
<p class="indent">This means that you are leveraging the operating system’s ability to change the location of a file by altering its pathname. As you look at the solution you can start to understand precisely how this works.</p>
<p class="indent">First, you see that for the sake of this example, the arguments passed to the Node.js process are used.&nbsp;&nbsp;You will utilize these arguments to tell your Node.js application which pathnames to use when moving files. This means that in addition to the standard first two arguments, <span class="FontName1">node &lt;app.js&gt;</span>, you will need to have two other parameters.</p>
<p class="indent">In order to validate these additional parameters, and prevent your move functions from immediately throwing an error with the wrong number of arguments, you need to ensure you have provided the proper number of arguments. This is accomplished by checking the number of arguments passed and throwing an appropriate error if an invalid number is encountered.</p>
<pre><span class="FontName1">if (args.length !== 4) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">throw new Error('Invalid Arguments');</span><br><span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">origPath = args[2];</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">newPath = args[3];</span><br><span class="FontName1">}</span></pre>
<p class="indent">Following this sanity check, if you have the proper number of arguments, then you assign the original path and new path variables, which will be passed to your <span class="FontName1">fs.rename</span> function. This function takes an original path and a new path argument, as well as a callback.&nbsp;&nbsp;The callback function <a id="cXXX.242"></a>will accept an error object only if the rename process fails for whatever reason. Examining the Node.js source for <span class="FontName1">fs.rename</span><a id="cXXX.243"></a> in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list27" id="_list27">Listing 3-27</a>, you will see that the module just wraps the native rename functionality of the operating system.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list27" id="list27">Listing 3-27</a></i></b>.&nbsp;&nbsp;fs.rename Source<a id="cXXX.244"></a></p>
<pre><span class="FontName1">fs.rename = function(oldPath, newPath, callback) {</span><br>&nbsp;&nbsp;<span class="FontName1">callback = makeCallback(callback);</span><br>&nbsp;&nbsp;<span class="FontName1">if (!nullCheck(oldPath, callback)) return;</span><br>&nbsp;&nbsp;<span class="FontName1">if (!nullCheck(newPath, callback)) return;</span><br>&nbsp;&nbsp;<span class="FontName1">binding.rename(pathModule._makeLong(oldPath),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">pathModule._makeLong(newPath),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">callback);</span><br><span class="FontName1">};</span></pre>
<p class="indent">You can see from the source that the original pathname and new pathname must be present or the <span class="FontName1">nullCheck</span> function<a id="cXXX.245"></a> will prevent a rename. You must also provide an existing path to the file. The file itself need not be present for the rename to operate, but if you provide a path that does not exist an error will be thrown (see <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list28" id="_list28">Listing 3-28</a>).</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list28" id="list28">Listing 3-28</a></i></b>.&nbsp;&nbsp;Path does not exist</p>
<pre><span class="FontName1">$ node 3-7-1.js 3-7/tmp/awesome.gif 3-7/save/does/not/exist/awesome.gif</span><br>&nbsp;<br><span class="FontName1">/Users/gack/Dropbox/book/code/Ch03/3-7-1.js:18</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="FontName1">^</span><br><span class="FontName1">Error: ENOENT, rename '3-7/tmp/awesome.gif'</span></pre>
<p class="indent">The next example in the solution implemented the synchronous version of <span class="FontName1">fs.rename</span>, <span class="FontName1">fs.renameSync</span>. This is the same functionality as <span class="FontName1">fs.rename</span>, with the alteration that the function waits until the rename occurs, and then returns (see <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list29" id="_list29">Listing 3-29</a>).</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list29" id="list29">Listing 3-29</a></i></b>.&nbsp;&nbsp;Synchronous rename <a id="cXXX.246"></a></p>
<pre><span class="FontName1">fs.renameSync = function(oldPath, newPath) {</span><br>&nbsp;&nbsp;<span class="FontName1">nullCheck(oldPath);</span><br>&nbsp;&nbsp;<span class="FontName1">nullCheck(newPath);</span><br>&nbsp;&nbsp;<span class="FontName1">return binding.rename(pathModule._makeLong(oldPath),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">pathModule._makeLong(newPath));</span><br><span class="FontName1">};</span></pre>
<p class="indent">In the solution for moving files, these two examples are perhaps the most common methods in Node.js. You also saw in the solution a method that utilizes the standard terminal command to execute a file move:</p>
<pre><span class="FontName1">'mv 3-7/tmp/awesome.gif 3-7/save/awesome.gif'</span></pre>
<p class="indent">This is accomplished by utilizing the Node.js child process module. The details of utilizing the Node.js child process module will be discussed further in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch05.xhtml">Chapter 5</a>. You can see, however, that you can execute commands directly through this module.</p>
</div>
<p id="Sec29" class="Heading1">3-8. Symbolically Linking Files<a id="cXXX.72k"></a></p>
<div>
<p id="Sec30" class="Heading2_2">Problem</p>
<p class="noindent">When building a Node.js application, you want to utilize symbolic links or links for files in your file system.</p>
</div>
<div>
<p id="Sec31" class="Heading2">Solution</p>
<p class="noindent">In this solution you can imagine that your Node.js application has just downloaded an executable file, which you then want to make available through the file system via the use of symbolic links. To do this there are many methods in which to build the symbolic links. Of course, you must start with the file-system module being imported via <span class="FontName1">require('fs')</span>. Then you will see that there are multiple versions of how to link to files in the file system and subsequently to read them and know to where they are linked.</p>
<p class="noindent2"><b><i>Listing 3-30</i></b>.&nbsp;&nbsp;Symbolically Linking Files</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* symbolic links</span><br><span class="FontName1">*/</span><br><span class="FontName1">var fs = require('fs');</span><br>&nbsp;<br><span class="FontName1">fs.link('/opt/Sublime Text 2/sublime_text', '/usr/bin/sublime', function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br><span class="FontName1">});</span><a id="cXXX.247"></a><br>&nbsp;<br><span class="FontName1">fs.linkSync('/opt/Sublime Text 2/sublime_text', '/usr/bin/sublime');</span><a id="cXXX.248"></a><br>&nbsp;<br><span class="FontName1">fs.symlink('/opt/Sublime Text 2/sublime_text', '/usr/bin/sublime', function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><a id="cXXX.249"></a><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">fs.symlinkSync('/opt/Sublime Text 2/sublime_text', '/usr/bin/sublime');</span><a id="cXXX.250"></a><br>&nbsp;<br><span class="FontName1">fs.readlink('/usr/bin/sublime', function(err, string) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(string);</span><a id="cXXX.251"></a><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">var rls = fs.readlinkSync('/usr/bin/sublime');</span><a id="cXXX.252"></a><br><span class="FontName1">console.log(rls);</span></pre>
<p class="indent">There are four functions for creating links, with two different varieties. First are <span class="FontName1">fs.link</span> and <span class="FontName1">fs.linkSync</span>. The other two are <span class="FontName1">fs.symlink</span> and <span class="FontName1">fs.symlinkSync</span>.&nbsp;&nbsp;These are complemented with the methods for reading the links via <span class="FontName1">fs.readlink</span> and <span class="FontName1">fs.readlinkSync</span>.</p>
</div>
<div>
<p id="Sec32" class="Heading2">How It Works</p>
<p class="noindent">Symbolically linking files and linking files in the file system behave just like many other items in the file-system module<a id="cXXX.73u"></a> in Node.js. That is to say, these functions are wrappers for the standard operating system commands.</p>
<p class="indent">First let’s examine the function <span class="FontName1">fs.link</span>. This function is not a function to create a symbolic link itself; rather, it is a function that will wrap the POSIX link command. This command will create a link, or what is commonly known as a hard link, to an existing file. The link function takes <a id="cXXX.253"></a>three arguments: original path, new path, and a callback that will accept an error if one occurs. This function, like others in the file-system module, has a synchronous relative, <span class="FontName1">fs.linkSync</span>. <span class="FontName1">linkSync</span>, aside from being fun to say out loud, performs the same hard linking operation that <span class="FontName1">fs.link</span> does; only it returns the result instead of using a callback.</p>
<p class="indent">Symbolically linking files operates in the similar manner as <span class="FontName1">fs.link</span>. The function to link a file is <span class="FontName1">fs.symlink</span>. A symbolic link is a soft link, as opposed to a hard link. A symbolic link represents a link to another file or directory, just like the hard link with two distinct differences. First, a symbolic link is valid across volumes, not only to the local volume as the hard link. Second, the symbolic link can point to an arbitrary path, where the hard link must link to an existing file on the file system.</p>
<p class="indent">Aside from the differences in symbolic versus hard link implementation on the operating system, the Node.js implementation is very similar. The function <span class="FontName1">fs.symlink</span> accepts three arguments: the original path, a new path, and a callback that accepts any error that occurs. This is the same signature as the function <span class="FontName1">fs.link</span>. Just as <span class="FontName1">fs.link</span> had a synchronous counterpart, so does <span class="FontName1">fs.symlink</span> with <span class="FontName1">fs.symlinkSync</span>. The synchronous version returns the result directly instead of utilizing the callback.</p>
<p class="indent">The <span class="FontName1">fs.symlink</span> and <span class="FontName1">fs.symlinkSync</span> functions do perform a singular check before making the symbolic link on the file system. This check is a preprocess function; <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list31" id="_list31">Listing 3-31</a> shows how the system makes sure that symbolic links made in a Windows environment utilize the proper protocol for resolving the file path.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list31" id="list31">Listing 3-31</a></i></b>.&nbsp;&nbsp;Symbolic Link Preprocess<a id="cXXX.254"></a><a id="cXXX.255"></a></p>
<pre><span class="FontName1">function preprocessSymlinkDestination(path, type) {</span><br>&nbsp;&nbsp;<span class="FontName1">if (!isWindows) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// No preprocessing is needed on Unix.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return path;</span><br>&nbsp;&nbsp;<span class="FontName1">} else if (type === 'junction') {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// Junctions paths need to be absolute and \\?\-prefixed.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return pathModule._makeLong(path);</span><br>&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">// Windows symlinks don't tolerate forward slashes.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">return ('' + path).replace(/\//g, '\\');</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">}</span></pre>
<p class="indent">Once a symbolic or hard link is made in the file system, you can utilize Node.js to read the link. Reading a link on the file system will resolve to where the link actually is linked. This is done with the <span class="FontName1">fs.readlink</span> function. The <span class="FontName1">fs.readlink</span> function accepts two arguments: a path for the symbolic link and a callback. The callback will contain two arguments: an error if one occurred and the string for the file path that the symbolic or hard link resolves. As with the other methods there is a synchronous version of this function that returns the error or resulting string directly, without the use of the callback function.</p>
</div>
<p id="Sec33" class="Heading1">3-9. Altering File Permissions<a id="cXXX.74v"></a></p>
<div>
<p id="Sec34" class="Heading2_2">Problem</p>
<p class="noindent">Within your Node.js application, you need to control the access and permissions levels on files and directories on your file system.</p>
</div>
<div>
<p id="Sec35" class="Heading2">Solution</p>
<p class="noindent">In order to change the permissions for a file, you must utilize the same set of functions that your operating system uses in order to do the same. The standard sets of rules for files are determined by the access level, which is granted via the mode that the file is registered to have on the file system, and the ownership of the file. Say, for example, that you have a file that is used in your application; you may wish to make it readable by only individuals on the operating system. This can be done easily as shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list32" id="_list32">Listing 3-32</a>. Other examples shown in this solution highlight a few of the various modes for individual access to the files. Later you will see all the various possibilities available for you to alter the modes of files.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list32" id="list32">Listing 3-32</a></i></b>.&nbsp;&nbsp;Changing File Permissions in Node.js</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* Altering file permissions</span><br><span class="FontName1">*/</span><br>&nbsp;<br><span class="FontName1">var fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">file = '3-9/file.txt';</span><br>&nbsp;<br><span class="FontName1">//CHANGING MODES chmod</span><a id="cXXX.256"></a><br><span class="FontName1">//hidden file</span><br><span class="FontName1">//-rwSr-S--T 1 cgack cgack 4 May&nbsp;&nbsp;5 11:50 file.txt</span><br><span class="FontName1">fs.chmod(file, 4000, function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br><span class="FontName1">});</span><br><span class="FontName1">//individual write</span><br><span class="FontName1">//--w------- 1 cgack cgack 4 May&nbsp;&nbsp;5 11:50 file.txt</span><br><span class="FontName1">fs.chmod(file, 0200, function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br><span class="FontName1">});</span><br><span class="FontName1">//individual execute</span><br><span class="FontName1">//---x------ 1 cgack cgack 4 May&nbsp;&nbsp;5 11:50 file.txt</span><br><span class="FontName1">fs.chmod(file, 0100, function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br><span class="FontName1">});</span><br><span class="FontName1">//individual write + execute</span><br><span class="FontName1">//--wx------ 1 cgack cgack 4 May&nbsp;&nbsp;5 11:50 file.txt</span><br><span class="FontName1">fs.chmod(file, 0300, function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">//CHANGING OWNERS chown</span><a id="cXXX.257"></a><br><span class="FontName1">// requires root access</span><br><span class="FontName1">//--wx------ 1 root root 4 May&nbsp;&nbsp;5 11:50 file.txt</span><br><span class="FontName1">fs.chown(file, 0 /* root */, 0, function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">//--wx------ 1 cgack cgack 4 May&nbsp;&nbsp;5 11:50 file.txt</span><br><span class="FontName1">fs.chown(file, 1000, 1000, function(err) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (err) throw err;</span><br><span class="FontName1">});</span></pre>
<p class="indent">Also shown in the listing is the ability to change the owner of the file. You can see that the ownership of the file was transferred to root, then back to my personal user easily, with the use of the <span class="FontName1">fs.chown</span> function.</p>
</div>
<div>
<p id="Sec36" class="Heading2">How It Works</p>
<p class="noindent">When you aim to alter permissions on a file or directory, you first might want to change ownership. In Node.js, ownership on the file system is dictated by the <span class="FontName1">fs.chown</span> function and its synchronous counterpart <span class="FontName1">fs.chownSync</span>. The <span class="FontName1">fs.chown</span> function<a id="cXXX.258"></a> accepts four arguments. First, you must provide the function for the file on which you wish to perform the ownership alteration. Second, you must provide the integer of the user ID on your system. Third, you add the integer of the group ID to which that user belongs. Finally, the function accepts a callback function, which will pass on any errors that occur.</p>
<p class="indent">The file name should be obvious to you, as you likely will know the target, or provide a file within your Node.js application that requires the ownership change. But what might not be something that you have memorized is the user ID or group IDs of all the users to which you wish to grant access. If you want to get these ID numbers, you can use the following commands in the terminal.</p>
<p class="noindent2"><b><i>Listing 3-33</i></b>.&nbsp;&nbsp;Determine the User and Group ID Numbers via the Terminal<a id="cXXX.259"></a></p>
<pre><span class="FontName1">$ id –u &lt;username&gt; #username user id</span><br><span class="FontName1">$ id –g &lt;username&gt; #username group id</span></pre>
<p class="indent">The use of <span class="FontName1">chown</span> will directly change the owner of the file on the file system. You see that changing the owner to the root user in the file.txt as described by <span class="FontName1">$ ls –l</span> shows that the file was changed to be owned by root: <span class="FontName1">//--wx------ 1 root root 4 May&nbsp;&nbsp;5 11:50 file.txt</span>. The same is, of course, true for the ownership change back to my user cgack.&nbsp;&nbsp;It should be noted that to change ownership of the file, you are required to operate under root access. This means that in this example you should run the application file as <span class="FontName1">$ sudo node 3-9-1.js</span>. Without this level of permission you will encounter a permissions error: <span class="FontName1">Error: EPERM, chown '3-9/file.txt'</span>.</p>
<p class="indent">Once you have changed ownership of a file, you still may want to explicitly set the permissions associated with the file. In the solution, you saw the file in the example was altered from a hidden file to be accessed as individual write, individual execute, and then a combined individual write + execute permissions. Setting these is quite simple, because the <span class="FontName1">fs.chmod</span> function will change the access mode of the file. This function, <span class="FontName1">fs.chmod</span>,<a id="cXXX.260"></a> accepts three arguments: the file name, the integer value of the octal permission code, and a callback to pass back any errors that occur.</p>
<p class="indent">The octal codes that determine the permissions are split into sections. The first digit represents permissions granted to the “other” set of users. The second digit represents group level access. The third and fourth represent individual user access and system level access, respectively. With the exception of the system level access, which represents whether the file is hidden, archived, or a system file, the possible values are 1 (for execute), 2 (for write),&nbsp;&nbsp;and 4 (for read). The full list is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list34" id="_list34">Listing 3-34</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list34" id="list34">Listing 3-34</a></i></b>.&nbsp;&nbsp;File Access Settings<a id="cXXX.261"></a></p>
<pre><span class="FontName1">4000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hidden file</span><br><span class="FontName1">2000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System file</span><br><span class="FontName1">1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Archive bit</span><br><span class="FontName1">0400&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Individual read</span><br><span class="FontName1">0200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Individual write</span><br><span class="FontName1">0100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Individual execute</span><br><span class="FontName1">0040&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Group read</span><br><span class="FontName1">0020&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Group write</span><br><span class="FontName1">0010&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Group execute</span><br><span class="FontName1">0004&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Other read</span><br><span class="FontName1">0002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Other write</span><br><span class="FontName1">0001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Other execute</span></pre>
<p class="indent">These values can all be combined together, as you saw in the solution where both individual write and execute were granted by utilizing <span class="FontName1">0300 = 0200 and 0100</span>.&nbsp;&nbsp;As such, full access to an individual would be set at <span class="FontName1">0700 = 0400 and 0200 and 0100</span>.&nbsp;&nbsp;You can see then that the full extent of this functionality, granting full access of read, write, and execute to all users&nbsp;&nbsp;and groups, would be <span class="FontName1">0777</span>.</p>
<p class="indent">Armed with these tools, you should be able to alter access levels and file level ownership in Node.js.</p>
</div>
<p id="Sec37" class="Heading1">3-10. Watching Files for Modifications<a id="cXXX.76x"></a></p>
<div>
<p id="Sec38" class="Heading2_2">Problem</p>
<p class="noindent">You want to monitor a file for all modifications within Node.js.</p>
</div>
<div>
<p id="Sec39" class="Heading2">Solution</p>
<p class="noindent">If you want to be able to gain as much information as possible and consider changes to files in the file system, then the file-system module of Node.js has a set of solutions that might just work. There are two approaches to this file-system monitoring. One is to use the <span class="FontName1">fs.watchFile</span> method, which will return the entire file stat object for previous and current files you are watching. The second is a newer method, mentioned briefly in Section 3-4: <span class="FontName1">fs.watch</span>. To see these two options in action, watching for changes to an arbitrary file, look no farther than <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list35" id="_list35">Listing 3-35</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list35" id="list35">Listing 3-35</a></i></b>.&nbsp;&nbsp;Two Methods for Watching for File Alterations</p>
<pre><span class="FontName1">/**</span><br><span class="FontName1">* Watching files for modifications</span><br><span class="FontName1">*/</span><br><span class="FontName1">var fs = require('fs'),</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">path = '3-10/file.txt';</span><br>&nbsp;<br><span class="FontName1">fs.watchFile(path, function(current, previous)</span><a id="cXXX.262"></a><span class="FontName1">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">for (var key in current) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (current[key] !== previous[key]) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(key + ' altered. prev: ' + previous[key] + ' curr: ' + current[key]);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">});</span><br>&nbsp;<br><span class="FontName1">fs.watch(path, function(event, filename)</span><a id="cXXX.263"></a><span class="FontName1">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (filename) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(filename + ' : ' + event);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">//Macs don't pass the filename</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(path + ' : ' + event);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">});</span></pre>
<p class="indent">This will produce a result, if you are altering the contents of the file to some simplistic degree, that will look similar to the console output that is shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list36" id="_list36">Listing 3-36</a>.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list36" id="list36">Listing 3-36</a></i></b>.&nbsp;&nbsp;Watching a file</p>
<pre><span class="FontName1">$ node 3-10-1.js</span><br><span class="FontName1">3-10/file.txt : change</span><br><span class="FontName1">3-10/file.txt : change</span><br><span class="FontName1">size altered. prev: 14 curr: 19</span><br><span class="FontName1">atime altered. prev: Sun May 05 2013 14:04:37 GMT-0400 (EDT) curr: Sun May 05 2013 14:07:23 GMT-0400 (EDT)</span><br><span class="FontName1">mtime altered. prev: Sun May 05 2013 14:04:37 GMT-0400 (EDT) curr: Sun May 05 2013 14:07:22 GMT-0400 (EDT)</span><br><span class="FontName1">ctime altered. prev: Sun May 05 2013 14:04:37 GMT-0400 (EDT) curr: Sun May 05 2013 14:07:22 GMT-0400 (EDT)</span></pre>
</div>
<div>
<p id="Sec40" class="Heading2">How It Works</p>
<p class="noindent">First, you see the <span class="FontName1">fs.watchFile</span> function. This function takes a path argument and a callback that will provide the current and previous states of the file you are watching. Performing a long-polling <span class="FontName1">fs.stat</span> call on the file does this. This is configured by an optional second argument, which is an options object, defaulting to <span class="FontName1">{ persistent: true, interval: 5007 }</span> and allowing for a continual or persistent interval to poll.</p>
<p class="indent">The <span class="FontName1">fs.watchFile</span> function creates a new <span class="FontName1">StatWatcher</span> object (<a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list37" id="_list37">Listing 3-37</a>), which polls the stat object of the file on the set interval. These stats are returned in the listener callback if a change occurs on the <span class="FontName1">StatWatcher</span>. This will return previous and current versions of the file stat. Even if the file previously did not exist, it will show up with an add date, <span class="FontName1">stat.atime</span>, with the value: Wed Dec 31 1969 19:00:00 GMT-0500 (EST) (the beginning of the UNIX epoch).</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list37" id="list37">Listing 3-37</a></i></b>.&nbsp;&nbsp;StatWatcher EventEmitter<a id="cXXX.264"></a><a id="cXXX.265"></a></p>
<pre><span class="FontName1">function StatWatcher() {</span><br>&nbsp;&nbsp;<span class="FontName1">EventEmitter.call(this);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">var self = this;</span><br>&nbsp;&nbsp;<span class="FontName1">this._handle = new binding.StatWatcher();</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">// uv_fs_poll is a little more powerful than ev_stat but we curb it for</span><br>&nbsp;&nbsp;<span class="FontName1">// the sake of backwards compatibility</span><br>&nbsp;&nbsp;<span class="FontName1">var oldStatus = -1;</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this._handle.onchange = function(current, previous, newStatus) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (oldStatus === -1 &amp;&amp;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">newStatus === -1 &amp;&amp;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">current.nlink === previous.nlink) return;</span><br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">oldStatus = newStatus;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.emit('change', current, previous);</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">this._handle.onstop = function() {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self.emit('stop');</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br><span class="FontName1">}</span><br><span class="FontName1">util.inherits(StatWatcher, EventEmitter);</span><br>&nbsp;<br><span class="FontName1">StatWatcher.prototype.start = function(filename, persistent, interval) {</span><br>&nbsp;&nbsp;<span class="FontName1">nullCheck(filename);</span><br>&nbsp;&nbsp;<span class="FontName1">this._handle.start(pathModule._makeLong(filename), persistent, interval);</span><br><span class="FontName1">};</span><br>&nbsp;<br><span class="FontName1">StatWatcher.prototype.stop = function() {</span><br>&nbsp;&nbsp;<span class="FontName1">this._handle.stop();</span><br><span class="FontName1">};</span></pre>
<p class="indent">In the solution you see that for each time the listener files, the current stat is traversed and compared against the previous. Then for each key in the current object that is different from that in the previous stat of the file (see <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list38" id="_list38">Listing 3-38</a>).</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list38" id="list38">Listing 3-38</a></i></b>.&nbsp;&nbsp;Traversing through the files to find altered state.</p>
<pre><span class="FontName1">for (var key in current) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (current[key] !== previous[key]) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">console.log(key + ' altered. prev: ' + previous[key] + ' curr: ' + current[key]);</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">}</span></pre>
<p class="indent">The option to choose between this, <span class="FontName1">fs.watchFile</span>, and <span class="FontName1">fs.watch</span> is not clear-cut. Both of these solutions are still considered unstable. While <span class="FontName1">fs.watchFile</span> can return a full stat detail of the file being watched, it is limited to the polling functionality and thus is much slower to return that <span class="FontName1">fs.watch</span>, which you will see next.</p>
<p class="indent">The <span class="FontName1">fs.watch</span> function creates an <span class="FontName1">FSWatcher</span>, shown in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list39" id="_list39">Listing 3-39</a>, which is a Node.js <span class="FontName1">EventEmitter</span>, which is similar to the <span class="FontName1">StatWatcher EventEmitter</span> in that it will produce and emit a change event when a file modification is detected.</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list39" id="list39">Listing 3-39</a></i></b>.&nbsp;&nbsp;Creating a New FSWatcher<a id="cXXX.266"></a></p>
<pre><span class="FontName1">watcher = new FSWatcher();</span><br><span class="FontName1">watcher.start(filename, options.persistent);</span><br>&nbsp;<br><span class="FontName1">if (listener) {</span><br>&nbsp;&nbsp;<span class="FontName1">watcher.addListener('change', listener);</span><br><span class="FontName1">}</span></pre>
<p class="indent">
<span class="FontName1">FSWatcher</span><a id="cXXX.267"></a> creates a new <span class="FontName1">FSEvent</span> handle on a file or directory. The <span class="FontName1">FSWatcher</span> then binds to this handle’s ‘<span class="FontName1">change</span>’ event (see <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list40" id="_list40">Listing 3-40</a>).</p>
<p class="noindent2"><b><i><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#_list40" id="list40">Listing 3-40</a></i></b>.&nbsp;&nbsp;FSWatcher</p>
<pre><span class="FontName1">function FSWatcher() {</span><br>&nbsp;&nbsp;<span class="FontName1">EventEmitter.call(this);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">var self = this;</span><br>&nbsp;&nbsp;<span class="FontName1">var FSEvent = process.binding('fs_event_wrap').FSEvent;</span><br>&nbsp;&nbsp;<span class="FontName1">this._handle = new FSEvent();</span><br>&nbsp;&nbsp;<span class="FontName1">this._handle.owner = this;</span><br>&nbsp;<br>&nbsp;&nbsp;<b>this._handle.onchange = function(status, event, filename) {</b><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">if (status) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">self._handle.close();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>self.emit('error', errnoException(process._errno, 'watch'));</b><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">} else {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>self.emit('change', event, filename);</b><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">}</span><br>&nbsp;&nbsp;<span class="FontName1">};</span><br><span class="FontName1">}</span><br><span class="FontName1">util.inherits(FSWatcher, EventEmitter);</span><br>&nbsp;<br><span class="FontName1">FSWatcher.prototype.start = function(filename, persistent) {</span><br>&nbsp;&nbsp;<span class="FontName1">nullCheck(filename);</span><br>&nbsp;&nbsp;<span class="FontName1">var r = this._handle.start(pathModule._makeLong(filename), persistent);</span><br>&nbsp;<br>&nbsp;&nbsp;<span class="FontName1">if (r) {</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">this._handle.close();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="FontName1">throw errnoException(process._errno, 'watch');</span><br>&nbsp;&nbsp;<span class="FontName1">}</span><br><span class="FontName1">};</span></pre>
<p class="indent">The <span class="FontName1">FSWatcher</span> that is created by calling the <span class="FontName1">fs.watch</span> function on a file or directory will emit one of two events: error, or change. The change event is what your listener function is bound to in <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#list40">Listing 3-40</a>. This callback provides an event and a file name (or directory), which had that event happen to it. The event can be <span class="FontName1">"changed"</span> or <span class="FontName1">"renamed"</span>.&nbsp;&nbsp;This is lacking information from the fs.watchFile function that, as you saw, provides an entire stat object for the changed file.</p>
</div>
</div>
<div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#">Add Highlight</a></li>
		<li class="add-note"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#">
			
				Add Note
			
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch02.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">CHAPTER 2: Networking with Node.js</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch04.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">CHAPTER 4: Building a Web Server</div>
        </a>
    
  
  </div>


        
    </section>
    <div class="reading-controls-bottom">
      <ul class="interface-controls js-bitlist">
        <li class="queue-control">
            <button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781430260585/chapter/9781430260585_Ch03.xhtml" data-for-analytics="9781430260585:9781430260585_Ch03.xhtml" aria-label="Add to Queue">
      <span>Add to Queue</span>
  </button>
        </li>
      </ul>
    </div>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  





    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel  collapsed slideUp">
        <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" class="js-toggle-nag ss-navigateup" title="Toggle open or close footer"></a>
        <div class="sample-message">
          <p class="usage-data t-collapsed-text">Enjoy Safari?
            <a class="ga-active-trial-subscribe-nag" href="https://www.safaribooksonline.com/subscribe/">
              Subscribe Today
              
            </a>
          </p>
          

        <div class="expanded">
          <h2>You have 10 days left in your trial, Raviguru0007. </h2>
          <p class="t-expanded-text">Safari is your trusted guide for building a remarkable career. We hope you've been enjoying your trial—ready to join?</p>
          <a href="https://www.safaribooksonline.com/subscribe/" class="button-primary">
            Subscribe Today
            
          </a>
          
          <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" class="icon-up" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/contact/">Contact Us</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
    </ul>
    <span class="copyright">© 2017 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/membership-agreement/">Membership Agreement</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>

        </div>
      </div>
    </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" class="icon-up" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li><a class="t-queue-footer" href="https://www.safaribooksonline.com/s/">Queue</a></li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2017 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"applicationTime":371,"agent":"","applicationID":"3275661","errorBeacon":"bam.nr-data.net","beacon":"bam.nr-data.net","queueTime":0,"transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","licenseKey":"510f1a6865"}</script>


    

    <script src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/saved_resource" charset="utf-8"></script>
    <script src="./CHAPTER 3_ Using the File System - Node.js Recipes_ A Problem-Solution Approach_files/saved_resource(1)" charset="utf-8"></script>
  

<div class="annotator-notice">Sorry we could not read the annotations from the store</div><div class="font-flyout" style="top: 200.003px; left: 1217px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://www.safaribooksonline.com/library/view/nodejs-recipes-a/9781430260585/9781430260585_Ch03.xhtml#">Reset</a>
</div>
</div></body></html>